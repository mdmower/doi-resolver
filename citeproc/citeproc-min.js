if(!Array.indexOf){Array.prototype.indexOf=function(c){var b,a;for(b=0,a=this.length;b<a;b+=1){if(this[b]===c){return b}}return -1}}var CSL={PROCESSOR_VERSION:"1.0.551",CONDITION_LEVEL_TOP:1,CONDITION_LEVEL_BOTTOM:2,PLAIN_HYPHEN_REGEX:/(?:[^\\]-|\u2013)/,LOCATOR_LABELS_REGEXP:new RegExp("^((art|ch|Ch|subch|col|fig|l|n|no|op|p|pp|para|subpara|pt|r|sec|subsec|Sec|sv|sch|tit|vrs|vol)\\.)\\s+(.*)"),STATUTE_SUBDIV_GROUPED_REGEX:/((?:^| )(?:art|ch|Ch|subch|p|pp|para|subpara|pt|r|sec|subsec|Sec|sch|tit)\.)/g,STATUTE_SUBDIV_PLAIN_REGEX:/(?:(?:^| )(?:art|ch|Ch|subch|p|pp|para|subpara|pt|r|sec|subsec|Sec|sch|tit)\.)/,STATUTE_SUBDIV_STRINGS:{"art.":"article","bk.":"book","ch.":"chapter","Ch.":"Chapter","subch.":"subchapter","p.":"page","pp.":"page","para.":"paragraph","subpara.":"subparagraph","pt.":"part","r.":"rule","sec.":"section","subsec.":"subsection","Sec.":"Section","sch.":"schedule","tit.":"title","col.":"column","fig.":"figure","fol.":"folio","l.":"line","n.":"note","no.":"issue","op.":"opus","sv.":"sub-verbo","vrs.":"verse","vol.":"volume"},STATUTE_SUBDIV_STRINGS_REVERSE:{article:"art.",book:"bk.",chapter:"ch.",Chapter:"Ch.",subchapter:"subch.",page:"p.",paragraph:"para.",subparagraph:"subpara.",part:"pt.",rule:"r.",section:"sec.",subsection:"subsec.",Section:"Sec.",schedule:"sch.",title:"tit.",column:"col.",figure:"fig.",folio:"fol.",line:"l.",note:"n.",issue:"no.",opus:"op.","sub-verbo":"sv.","sub verbo":"sv.",verse:"vrs.",volume:"vol."},LOCATOR_LABELS_MAP:{art:"article",bk:"book",ch:"chapter",Ch:"Chapter",subch:"subchapter",col:"column",fig:"figure",fol:"folio",l:"line",n:"note",no:"issue",op:"opus",p:"page",pp:"page",para:"paragraph",subpara:"subparagraph",pt:"part",r:"rule",sec:"section",subsec:"subsection",Sec:"Section",sv:"sub-verbo",sch:"schedule",tit:"title",vrs:"verse",vol:"volume"},NestedBraces:[["(","["],[")","]"]],checkNestedBraceOpen:new RegExp(".*\\("),checkNestedBraceClose:new RegExp(".*\\)"),LangPrefsMap:{title:"titles","title-short":"titles","container-title":"journals","collection-title":"journals",publisher:"publishers",authority:"publishers","publisher-place":"places","event-place":"places",number:"number",edition:"number",issue:"number",volume:"number"},AbbreviationSegments:function(){this["container-title"]={};this["collection-title"]={};this["institution-entire"]={};this["institution-part"]={};this.nickname={};this.number={};this.title={};this.place={};this.hereinafter={};this.classic={};this["container-phrase"]={};this["title-phrase"]={}},GENDERS:["masculine","feminine"],ERROR_NO_RENDERED_FORM:1,PREVIEW:"Just for laughs.",ASSUME_ALL_ITEMS_REGISTERED:2,START:0,END:1,SINGLETON:2,SEEN:6,SUCCESSOR:3,SUCCESSOR_OF_SUCCESSOR:4,SUPPRESS:5,SINGULAR:0,PLURAL:1,LITERAL:true,BEFORE:1,AFTER:2,DESCENDING:1,ASCENDING:2,ONLY_FIRST:1,ALWAYS:2,ONLY_LAST:3,FINISH:1,POSITION_FIRST:0,POSITION_SUBSEQUENT:1,POSITION_IBID:2,POSITION_IBID_WITH_LOCATOR:3,MARK_TRAILING_NAMES:true,POSITION_TEST_VARS:["position","first-reference-note-number","near-note"],AREAS:["citation","citation_sort","bibliography","bibliography_sort"],MULTI_FIELDS:["event","publisher","publisher-place","event-place","title","container-title","collection-title","authority","edition","genre","title-short","medium","jurisdiction","archive","archive-place"],CITE_FIELDS:["first-reference-note-number","locator","locator-revision"],MINIMAL_NAME_FIELDS:["literal","family"],SWAPPING_PUNCTUATION:[".","!","?",":",","],TERMINAL_PUNCTUATION:[":",".",";","!","?"," "],NONE:0,NUMERIC:1,POSITION:2,COLLAPSE_VALUES:["citation-number","year","year-suffix"],DATE_PARTS:["year","month","day"],DATE_PARTS_ALL:["year","month","day","season"],DATE_PARTS_INTERNAL:["year","month","day","year_end","month_end","day_end"],NAME_PARTS:["family","given","dropping-particle","non-dropping-particle","suffix","literal"],DECORABLE_NAME_PARTS:["given","family","suffix"],DISAMBIGUATE_OPTIONS:["disambiguate-add-names","disambiguate-add-givenname","disambiguate-add-year-suffix"],GIVENNAME_DISAMBIGUATION_RULES:["all-names","all-names-with-initials","primary-name","primary-name-with-initials","by-cite"],NAME_ATTRIBUTES:["and","delimiter-precedes-last","delimiter-precedes-et-al","initialize-with","initialize","name-as-sort-order","sort-separator","et-al-min","et-al-use-first","et-al-subsequent-min","et-al-subsequent-use-first","form","prefix","suffix","delimiter"],PARALLEL_MATCH_VARS:["container-title"],PARALLEL_TYPES:["bill","gazette","regulation","legislation","legal_case","treaty","article-magazine","article-journal"],PARALLEL_COLLAPSING_MID_VARSET:["volume","issue","container-title","section","collection-number"],LOOSE:0,STRICT:1,TOLERANT:2,PREFIX_PUNCTUATION:/[.;:]\s*$/,SUFFIX_PUNCTUATION:/^\s*[.;:,\(\)]/,NUMBER_REGEXP:/(?:^\d+|\d+$)/,NAME_INITIAL_REGEXP:/^([A-Z\u0590-\u05ff\u0080-\u017f\u0400-\u042f\u0600-\u06ff\u0370\u0372\u0376\u0386\u0388-\u03ab\u03e2\u03e4\u03e6\u03e8\u03ea\u03ec\u03ee\u03f4\u03f7\u03fd-\u03ff])([a-zA-Z\u0080-\u017f\u0400-\u052f\u0600-\u06ff\u0370-\u03ff\u1f00-\u1fff]*|)/,ROMANESQUE_REGEXP:/[-0-9a-zA-Z\u0590-\u05d4\u05d6-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/,ROMANESQUE_NOT_REGEXP:/[^a-zA-Z\u0590-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/g,STARTSWITH_ROMANESQUE_REGEXP:/^[&a-zA-Z\u0590-\u05d4\u05d6-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/,ENDSWITH_ROMANESQUE_REGEXP:/[.;:&a-zA-Z\u0590-\u05d4\u05d6-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]$/,ALL_ROMANESQUE_REGEXP:/^[a-zA-Z\u0590-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]+$/,VIETNAMESE_SPECIALS:/[\u00c0-\u00c3\u00c8-\u00ca\u00cc\u00cd\u00d2-\u00d5\u00d9\u00da\u00dd\u00e0-\u00e3\u00e8-\u00ea\u00ec\u00ed\u00f2-\u00f5\u00f9\u00fa\u00fd\u0101\u0103\u0110\u0111\u0128\u0129\u0168\u0169\u01a0\u01a1\u01af\u01b0\u1ea0-\u1ef9]/,VIETNAMESE_NAMES:/^(?:(?:[.AaBbCcDdEeGgHhIiKkLlMmNnOoPpQqRrSsTtUuVvXxYy \u00c0-\u00c3\u00c8-\u00ca\u00cc\u00cd\u00d2-\u00d5\u00d9\u00da\u00dd\u00e0-\u00e3\u00e8-\u00ea\u00ec\u00ed\u00f2-\u00f5\u00f9\u00fa\u00fd\u0101\u0103\u0110\u0111\u0128\u0129\u0168\u0169\u01a0\u01a1\u01af\u01b0\u1ea0-\u1ef9]{2,6})(\s+|$))+$/,NOTE_FIELDS_REGEXP:/\{:(?:[\-_a-z]+|[A-Z]+):[^\}]+\}/g,NOTE_FIELD_REGEXP:/\{:([\-_a-z]+|[A-Z]+):\s*([^\}]+)\}/,DISPLAY_CLASSES:["block","left-margin","right-inline","indent"],NAME_VARIABLES:["author","editor","translator","contributor","collection-editor","composer","container-author","director","editorial-director","interviewer","original-author","recipient"],NUMERIC_VARIABLES:["call-number","chapter-number","collection-number","edition","page","issue","locator","number","number-of-pages","number-of-volumes","volume","citation-number"],DATE_VARIABLES:["locator-date","issued","event-date","accessed","container","original-date","publication-date","original-date","available-date","submitted"],TAG_ESCAPE:function(h){var l,d,f,j,c,b,a,k,g,e;l=h.match(/((?:\"|\')|(?:(?:<span\s+class=\"no(?:case|decor)\">).*?(?:<\/span>|<\/?(?:i|sc|b)>)))/g);d=h.split(/(?:(?:\"|\')|(?:(?:<span\s+class=\"no(?:case|decor)\">).*?(?:<\/span>|<\/?(?:i|sc|b)>)))/g);e=[d[0]];for(j=1,f=d.length;j<f;j+=1){e.push(l[j-1]);e.push(d[j])}d=e.slice();return d},TAG_USEALL:function(e){var c,b,d,a;c=[""];b=e.indexOf("<");d=e.indexOf(">");while(b>-1&&d>-1){if(b>d){a=b+1}else{a=d+1}if(b<d&&e.slice(b+1,d).indexOf("<")===-1){c[c.length-1]+=e.slice(0,b);c.push(e.slice(b,d+1));c.push("");e=e.slice(a)}else{c[c.length-1]+=e.slice(0,d+1);e=e.slice(a)}b=e.indexOf("<");d=e.indexOf(">")}c[c.length-1]+=e;return c},SKIP_WORDS:["about","above","across","afore","after","against","along","alongside","amid","amidst","among","amongst","anenst","apropos","apud","around","as","aside","astride","at","athwart","atop","barring","before","behind","below","beneath","beside","besides","between","beyond","but","by","circa","despite","down","during","except","for","forenenst","from","given","in","inside","into","lest","like","modulo","near","next","notwithstanding","of","off","on","onto","out","over","per","plus","pro","qua","sans","since","than","through"," thru","throughout","thruout","till","to","toward","towards","under","underneath","until","unto","up","upon","versus","vs.","v.","vs","v","via","vis-à-vis","with","within","without","according to","ahead of","apart from","as for","as of","as per","as regards","aside from","back to","because of","close to","due to","except for","far from","inside of","instead of","near to","next to","on to","out from","out of","outside of","prior to","pursuant to","rather than","regardless of","such as","that of","up to","where as","or","yet","so","for","and","nor","a","an","the","de","d'","von","van","c","et","ca"],FORMAT_KEY_SEQUENCE:["@strip-periods","@font-style","@font-variant","@font-weight","@text-decoration","@vertical-align","@quotes"],INSTITUTION_KEYS:["font-style","font-variant","font-weight","text-decoration","text-case"],SUFFIX_CHARS:"a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z",ROMAN_NUMERALS:[["","i","ii","iii","iv","v","vi","vii","viii","ix"],["","x","xx","xxx","xl","l","lx","lxx","lxxx","xc"],["","c","cc","ccc","cd","d","dc","dcc","dccc","cm"],["","m","mm","mmm","mmmm","mmmmm"]],CREATORS:["author","editor","contributor","translator","recipient","interviewer","composer","original-author","container-author","collection-editor"],LANGS:{"af-ZA":"Afrikaans","ar-AR":"Arabic","bg-BG":"Bulgarian","ca-AD":"Catalan","cs-CZ":"Czech","da-DK":"Danish","de-AT":"Austrian","de-CH":"German (CH)","de-DE":"German (DE)","el-GR":"Greek","en-GB":"English (GB)","en-US":"English (US)","es-ES":"Spanish","et-EE":"Estonian",eu:"European","fa-IR":"Persian","fi-FI":"Finnish","fr-CA":"French (CA)","fr-FR":"French (FR)","he-IL":"Hebrew","hr-HR":"Croatian","hu-HU":"Hungarian","is-IS":"Icelandic","it-IT":"Italian","ja-JP":"Japanese","km-KH":"Khmer","ko-KR":"Korean","lt-LT":"Lithuanian","lv-LV":"Latvian","mn-MN":"Mongolian","nb-NO":"Norwegian (Bokmål)","nl-NL":"Dutch","nn-NO":"Norwegian (Nynorsk)","pl-PL":"Polish","pt-BR":"Portuguese (BR)","pt-PT":"Portuguese (PT)","ro-RO":"Romanian","ru-RU":"Russian","sk-SK":"Slovak","sl-SI":"Slovenian","sr-RS":"Serbian","sv-SE":"Swedish","th-TH":"Thai","tr-TR":"Turkish","uk-UA":"Ukranian","vi-VN":"Vietnamese","zh-CN":"Chinese (CN)","zh-TW":"Chinese (TW)"},LANG_BASES:{af:"af_ZA",ar:"ar_AR",bg:"bg_BG",ca:"ca_AD",cs:"cs_CZ",da:"da_DK",de:"de_DE",el:"el_GR",en:"en_US",es:"es_ES",et:"et_EE",eu:"eu",fa:"fa_IR",fi:"fi_FI",fr:"fr_FR",he:"he_IL",hu:"hu_HU",is:"is_IS",it:"it_IT",ja:"ja_JP",km:"km_KH",ko:"ko_KR",lt:"lt_LT",mn:"mn_MN",nb:"nb_NO",nl:"nl_NL",nn:"nn-NO",pl:"pl_PL",pt:"pt_PT",ro:"ro_RO",ru:"ru_RU",sk:"sk_SK",sl:"sl_SI",sr:"sr_RS",sv:"sv_SE",th:"th_TH",tr:"tr_TR",uk:"uk_UA",vi:"vi_VN",zh:"zh_CN"},SUPERSCRIPTS:{"\u00AA":"\u0061","\u00B2":"\u0032","\u00B3":"\u0033","\u00B9":"\u0031","\u00BA":"\u006F","\u02B0":"\u0068","\u02B1":"\u0266","\u02B2":"\u006A","\u02B3":"\u0072","\u02B4":"\u0279","\u02B5":"\u027B","\u02B6":"\u0281","\u02B7":"\u0077","\u02B8":"\u0079","\u02E0":"\u0263","\u02E1":"\u006C","\u02E2":"\u0073","\u02E3":"\u0078","\u02E4":"\u0295","\u1D2C":"\u0041","\u1D2D":"\u00C6","\u1D2E":"\u0042","\u1D30":"\u0044","\u1D31":"\u0045","\u1D32":"\u018E","\u1D33":"\u0047","\u1D34":"\u0048","\u1D35":"\u0049","\u1D36":"\u004A","\u1D37":"\u004B","\u1D38":"\u004C","\u1D39":"\u004D","\u1D3A":"\u004E","\u1D3C":"\u004F","\u1D3D":"\u0222","\u1D3E":"\u0050","\u1D3F":"\u0052","\u1D40":"\u0054","\u1D41":"\u0055","\u1D42":"\u0057","\u1D43":"\u0061","\u1D44":"\u0250","\u1D45":"\u0251","\u1D46":"\u1D02","\u1D47":"\u0062","\u1D48":"\u0064","\u1D49":"\u0065","\u1D4A":"\u0259","\u1D4B":"\u025B","\u1D4C":"\u025C","\u1D4D":"\u0067","\u1D4F":"\u006B","\u1D50":"\u006D","\u1D51":"\u014B","\u1D52":"\u006F","\u1D53":"\u0254","\u1D54":"\u1D16","\u1D55":"\u1D17","\u1D56":"\u0070","\u1D57":"\u0074","\u1D58":"\u0075","\u1D59":"\u1D1D","\u1D5A":"\u026F","\u1D5B":"\u0076","\u1D5C":"\u1D25","\u1D5D":"\u03B2","\u1D5E":"\u03B3","\u1D5F":"\u03B4","\u1D60":"\u03C6","\u1D61":"\u03C7","\u2070":"\u0030","\u2071":"\u0069","\u2074":"\u0034","\u2075":"\u0035","\u2076":"\u0036","\u2077":"\u0037","\u2078":"\u0038","\u2079":"\u0039","\u207A":"\u002B","\u207B":"\u2212","\u207C":"\u003D","\u207D":"\u0028","\u207E":"\u0029","\u207F":"\u006E","\u2120":"\u0053\u004D","\u2122":"\u0054\u004D","\u3192":"\u4E00","\u3193":"\u4E8C","\u3194":"\u4E09","\u3195":"\u56DB","\u3196":"\u4E0A","\u3197":"\u4E2D","\u3198":"\u4E0B","\u3199":"\u7532","\u319A":"\u4E59","\u319B":"\u4E19","\u319C":"\u4E01","\u319D":"\u5929","\u319E":"\u5730","\u319F":"\u4EBA","\u02C0":"\u0294","\u02C1":"\u0295","\u06E5":"\u0648","\u06E6":"\u064A"},SUPERSCRIPTS_REGEXP:new RegExp("[\u00AA\u00B2\u00B3\u00B9\u00BA\u02B0\u02B1\u02B2\u02B3\u02B4\u02B5\u02B6\u02B7\u02B8\u02E0\u02E1\u02E2\u02E3\u02E4\u1D2C\u1D2D\u1D2E\u1D30\u1D31\u1D32\u1D33\u1D34\u1D35\u1D36\u1D37\u1D38\u1D39\u1D3A\u1D3C\u1D3D\u1D3E\u1D3F\u1D40\u1D41\u1D42\u1D43\u1D44\u1D45\u1D46\u1D47\u1D48\u1D49\u1D4A\u1D4B\u1D4C\u1D4D\u1D4F\u1D50\u1D51\u1D52\u1D53\u1D54\u1D55\u1D56\u1D57\u1D58\u1D59\u1D5A\u1D5B\u1D5C\u1D5D\u1D5E\u1D5F\u1D60\u1D61\u2070\u2071\u2074\u2075\u2076\u2077\u2078\u2079\u207A\u207B\u207C\u207D\u207E\u207F\u2120\u2122\u3192\u3193\u3194\u3195\u3196\u3197\u3198\u3199\u319A\u319B\u319C\u319D\u319E\u319F\u02C0\u02C1\u06E5\u06E6]","g"),locale:{},locale_opts:{},locale_dates:{}};if(typeof require!=="undefined"&&typeof module!=="undefined"&&"exports" in module){var CSL_IS_NODEJS=true;var CSL_NODEJS=require("./csl_nodejs_jsdom").CSL_NODEJS_JSDOM;exports.CSL=CSL}CSL.TERMINAL_PUNCTUATION_REGEXP=new RegExp("^(["+CSL.TERMINAL_PUNCTUATION.slice(0,-1).join("")+"])(.*)");CSL.CLOSURES=new RegExp(".*[\\]\\)]");if("object"===typeof console&&"function"===typeof console.log){CSL.debug=function(a){console.log("CSL: "+a)};CSL.error=function(a){console.log("CSL error: "+a)}}else{CSL.debug=function(){};CSL.error=function(a){throw"CSL error: "+a}}var XML_PARSING;if("undefined"!==typeof CSL_IS_NODEJS){XML_PARSING=CSL_NODEJS}else{if("undefined"!==typeof CSL_E4X){XML_PARSING=CSL_E4X}else{if("undefined"!==typeof CSL_JSON){XML_PARSING=CSL_JSON}else{XML_PARSING=CSL_CHROME}}}CSL.System={};CSL.System.Xml={Parsing:XML_PARSING};CSL.getSortCompare=function(c){if(CSL.stringCompare){return CSL.stringCompare}var e;var b={sensitivity:"base",ignorePunctuation:true,numeric:true};if(!c){c="en-US"}e=function(j,h){return j.toLocaleLowerCase().localeCompare(h.toLocaleLowerCase(),c,b)};var f=function(h){return h.replace(/^[\[\]\'\"]*/g,"")};var g=function(){if(!e("[x","x")){return false}else{return function(j,h){return e(f(j),f(h))}}};var a=g();var d=function(j,h){if(a){return a(j,h)}else{return e(j,h)}};return d};CSL.ambigConfigDiff=function(e,d){var f,j,c,g,h;if(e.names.length!==d.names.length){return 1}else{for(j=0,c=e.names.length;j<c;j+=1){if(e.names[j]!==d.names[j]){return 1}else{for(g=0,h=e.givens[j];g<h;g+=1){if(e.givens[j][g]!==d.givens[j][g]){return 1}}}}}if(e.disambiguate!=d.disambiguate){return 1}if(e.year_suffix!==d.year_suffix){return 1}return 0};CSL.cloneAmbigConfig=function(b,o,f){var g,a,e,n,d,l,c;var h={};h.names=[];h.givens=[];h.year_suffix=false;h.disambiguate=false;for(g=0,a=b.names.length;g<a;g+=1){c=b.names[g];h.names[g]=c}for(g=0,a=b.givens.length;g<a;g+=1){c=[];for(e=0,n=b.givens[g].length;e<n;e+=1){c.push(b.givens[g][e])}h.givens.push(c)}if(o){h.year_suffix=o.year_suffix;h.disambiguate=o.disambiguate}else{h.year_suffix=b.year_suffix;h.disambiguate=b.disambiguate}return h};CSL.getAmbigConfig=function(){var b,a;b=this.tmp.disambig_request;if(!b){b=this.tmp.disambig_settings}a=CSL.cloneAmbigConfig(b);return a};CSL.getMaxVals=function(){return this.tmp.names_max.mystack.slice()};CSL.getMinVal=function(){return this.tmp["et-al-min"]};CSL.tokenExec=function(c,d,k){var g,b,e,j,h,a;a=false;g=c.next;b=false;var f=function(l){if(l){this.tmp.jump.replace("succeed");return c.succeed}else{this.tmp.jump.replace("fail");return c.fail}};if(c.test){g=f.call(this,c.test(d,k))}h=c.execs.length;for(j=0;j<h;j+=1){e=c.execs[j];b=e.call(c,this,d,k);if(b){g=b}}return g};CSL.expandMacro=function(j){var d,e,p,g,k,a,c,o,h,b;d=j.postponed_macro;if(this.build.macro_stack.indexOf(d)>-1){throw'CSL processor error: call to macro "'+d+'" would cause an infinite loop'}else{this.build.macro_stack.push(d)}var n=false;var l=false;a=this.sys.xml.getNodesByName(this.cslXml,"macro",d);if(a.length){l=this.sys.xml.getAttributeValue(a[0],"cslid");n=this.sys.xml.getAttributeValue(a[0],"macro-has-date")}if(n){b=function(r,q){if(r.tmp.extension){r.tmp["doing-macro-with-date"]=true}};j.execs.push(b)}j.tokentype=CSL.START;j.cslid=l;CSL.Node.group.build.call(j,this,this[this.build.area].tokens,true);if(!this.sys.xml.getNodeValue(a)){throw'CSL style error: undefined macro "'+d+'"'}var f=CSL.makeBuilder(this);f(a[0]);h=new CSL.Token("group",CSL.END);if(j.decorations){h.decorations=j.decorations.slice()}if(n){b=function(r,q){if(r.tmp.extension){r.tmp["doing-macro-with-date"]=false}};h.execs.push(b)}CSL.Node.group.build.call(h,this,this[this.build.area].tokens,true);this.build.macro_stack.pop()};CSL.XmlToToken=function(a,j){var b,h,c,g,d,f,n,l;b=a.sys.xml.nodename(this);if(a.build.skip&&a.build.skip!==b){return}if(!b){h=a.sys.xml.content(this);if(h){a.build.text=h}return}if(!CSL.Node[a.sys.xml.nodename(this)]){throw'Undefined node name "'+b+'".'}c=[];g=a.sys.xml.attributes(this);d=CSL.setDecorations.call(this,a,g);f=new CSL.Token(b,j);if(j!==CSL.END||b==="if"||b==="else-if"||b==="layout"){for(n in g){if(g.hasOwnProperty(n)){if(j===CSL.END&&n!=="@language"&&n!=="@locale"){continue}if(g.hasOwnProperty(n)){if(CSL.Attributes[n]){try{CSL.Attributes[n].call(f,a,""+g[n])}catch(k){CSL.error(k);throw"CSL processor error, "+n+" attribute: "+k}}else{CSL.debug('warning: undefined attribute "'+n+'" in style')}}}}f.decorations=d}else{if(j===CSL.END&&g["@variable"]){f.hasVariable=true}}l=a[a.build.area].tokens;CSL.Node[b].build.call(f,a,l)};CSL.DateParser=function(){var k,w,t,l,p,r,g,C,E,D,u,d,y,q,o,A,b,n,h,f,B,s,x,a,c,z,v,e,j;k=[["\u660E\u6CBB",1867],["\u5927\u6B63",1911],["\u662D\u548C",1925],["\u5E73\u6210",1988]];w={};v=k.length;for(g=0;g<v;g+=1){C=k[g][0];E=k[g][1];w[C]=E}e=[];for(g=0;g<v;g+=1){E=k[g][0];e.push(E)}e=e.join("|");t="(?:"+e+")(?:[0-9]+)";t=new RegExp(t);j="(?:"+e+")(?:[0-9]+)";j=new RegExp(j,"g");p=/(\u6708|\u5E74)/g;l=/\u65E5/;r=/\u301c/g;D="(?:[?0-9]{1,2}%%NUMD%%){0,2}[?0-9]{4}(?![0-9])";u="[?0-9]{4}(?:%%NUMD%%[?0-9]{1,2}){0,2}(?![0-9])";d="[?0-9]{1,3}";y="[%%DATED%%]";q="[?~]";o="[a-zA-Z]+";A="("+u+"|"+D+"|"+d+"|"+y+"|"+q+"|"+o+")";b=new RegExp(A.replace(/%%NUMD%%/g,"-").replace(/%%DATED%%/g,"-"));n=new RegExp(A.replace(/%%NUMD%%/g,"-").replace(/%%DATED%%/g,"/"));h=new RegExp(A.replace(/%%NUMD%%/g,"/").replace(/%%DATED%%/g,"-"));f=[];B=[];v=f.length;for(g=0;g<v;g+=1){z=new RegExp(f[g]+".*");B.push(z)}this.mstrings="january february march april may june july august september october november december spring summer fall winter spring summer";this.mstrings=this.mstrings.split(" ");this.setOrderDayMonth=function(){this.monthguess=1;this.dayguess=0};this.setOrderMonthDay=function(){this.monthguess=0;this.dayguess=1};this.setOrderMonthDay();this.resetMonths=function(){var I,H,G,F;this.msets=[];for(I=0,H=this.mstrings.length;I<H;I+=1){this.msets.push([this.mstrings[I]])}this.mabbrevs=[];for(I=0,H=this.msets.length;I<H;I+=1){this.mabbrevs.push([]);for(G=0,F=this.msets[I].length;G<F;G+=1){this.mabbrevs[I].push(this.msets[I][0].slice(0,3))}}this.mrexes=[];for(I=0,H=this.mabbrevs.length;I<H;I+=1){this.mrexes.push(new RegExp("(?:"+this.mabbrevs[I].join("|")+")"))}};this.resetMonths();this.addMonths=function(N){var M,G,L,S,J,P,H,T;if("string"===typeof N){N=N.split(/\s+/)}if(N.length!==12&&N.length!==16){CSL.debug("month [+season] list of "+N.length+", expected 12 or 16. Ignoring.");return}var I=[];var F=[];for(M=0,G=N.length;M<G;M+=1){var K=false;var Q=false;var R=3;var O={};for(L=0,S=this.mabbrevs.length;L<S;L+=1){O[L]={};if(L===M){for(J=0,P=this.mabbrevs[M].length;J<P;J+=1){if(this.mabbrevs[M][J]===N[M].slice(0,this.mabbrevs[M][J].length)){Q=true;break}}}else{for(J=0,P=this.mabbrevs[L].length;J<P;J+=1){K=this.mabbrevs[L][J].length;if(this.mabbrevs[L][J]===N[M].slice(0,K)){while(this.msets[L][J].slice(0,K)===N[M].slice(0,K)){if(K>N[M].length||K>this.msets[L][J].length){CSL.debug("unable to disambiguate month string in date parser: "+N[M]);break}else{K+=1}}R=K;O[L][J]=K}}}for(H in O){if(O.hasOwnProperty(H)){for(T in O[H]){if(O[H].hasOwnProperty(T)){K=O[H][T];H=parseInt(H,10);T=parseInt(T,10);this.mabbrevs[H][T]=this.msets[H][T].slice(0,K)}}}}}if(!Q){this.msets[M].push(N[M]);this.mabbrevs[M].push(N[M].slice(0,R))}}this.mrexes=[];for(M=0,G=this.mabbrevs.length;M<G;M+=1){this.mrexes.push(new RegExp("(?:"+this.mabbrevs[M].join("|")+")"))}};this.parse=function(U){var W,S,P,Z,Y,H,J,Q,F,L,R,ak,X,K,O,M,ai,G,ah,aj,I,af,T,ae,ad,N,ac,V,ab,aa;if(U){U=""+U;U=U.replace(/\s*[0-9]{2}:[0-9]{2}(?::[0-9]+)/,"");Y=U.match(p);if(Y){U=U.replace(/\s+/,"","g");U=U.replace(l,"","g");U=U.replace(p,"-","g");U=U.replace(r,"/","g");U=U.replace("-/","/","g");U=U.replace(/-$/,"","g");T=U.split(t);P=[];af=U.match(j);if(af){var ag=[];for(g=0,v=af.length;g<v;g+=1){ag=ag.concat(af[g].match(/([^0-9]+)([0-9]+)/).slice(1))}for(g=0,v=T.length;g<v;g+=1){P.push(T[g]);if(g!==(v-1)){ae=(g*2);P.push(ag[ae]);P.push(ag[ae+1])}}}else{P=T}Z=P.length;for(g=1;g<Z;g+=3){P[g+1]=w[P[g]]+parseInt(P[g+1],10);P[g]=""}U=P.join("");U=U.replace(/\s*-\s*$/,"").replace(/\s*-\s*\//,"/");U=U.replace(/\.\s*$/,"");U=U.replace(/\.(?! )/,"");W=U.indexOf("/");S=U.indexOf("-")}}U=U.replace(/([A-Za-z])\./g,"$1");H="";J="";Q={};if(U.slice(0,1)==='"'&&U.slice(-1)==='"'){Q.literal=U.slice(1,-1);return Q}if(W>-1&&S>-1){F=U.split("/");if(F.length>3){L="-";R="/";P=U.split(h)}else{L="/";R="-";P=U.split(n)}}else{U=U.replace("/","-");L="-";R="-";P=U.split(b)}ak=[];v=P.length;for(g=0;g<v;g+=1){ah=P[g];Y=ah.match(/^\s*([\-\/]|[a-zA-Z]+|[\-~?0-9]+)\s*$/);if(Y){ak.push(Y[1])}}X=ak.indexOf(L);K=[];O=false;if(X>-1){K.push([0,X]);K.push([(X+1),ak.length]);O=true}else{K.push([0,ak.length])}M="";for(ad=0,N=K.length;ad<N;ad+=1){aj=K[ad];ai=ak.slice(aj[0],aj[1]);for(ac=0,V=ai.length;ac<V;ac+=1){I=ai[ac];if(I.indexOf(R)>-1){this.parseNumericDate(Q,R,M,I);continue}if(I.match(/[0-9]{4}/)){Q[("year"+M)]=I.replace(/^0*/,"");continue}G=false;for(ab=0,aa=this.mrexes.length;ab<aa;ab+=1){if(I.toLocaleLowerCase().match(this.mrexes[ab])){Q[("month"+M)]=""+(parseInt(ab,10)+1);G=true;break}if(G){continue}if(I.match(/^[0-9]+$/)){H=parseInt(I,10)}if(I.toLocaleLowerCase().match(/^bc/)&&H){Q[("year"+M)]=""+(H*-1);H="";continue}if(I.toLocaleLowerCase().match(/^ad/)&&H){Q[("year"+M)]=""+H;H="";continue}}G=false;for(ab=0,aa=B.length;ab<aa;ab+=1){if(I.toLocaleLowerCase().match(B[ab])){Q[("season"+M)]=""+(parseInt(ab,10)+1);G=true;break}}if(G){continue}if(I==="~"||I==="?"||I==="c"||I.match(/^cir/)){Q.circa=""+1;continue}if(I.toLocaleLowerCase().match(/(?:mic|tri|hil|eas)/)&&!Q[("season"+M)]){J=I;continue}}if(H){Q[("day"+M)]=H;H=""}if(J&&!Q[("season"+M)]){Q[("season"+M)]=J;J=""}M="_end"}if(O){for(ac=0,V=CSL.DATE_PARTS_ALL.length;ac<V;ac+=1){ah=CSL.DATE_PARTS_ALL[ac];if(Q[ah]&&!Q[(ah+"_end")]){Q[(ah+"_end")]=Q[ah]}else{if(!Q[ah]&&Q[(ah+"_end")]){Q[ah]=Q[(ah+"_end")]}}}}if(!Q.year){Q={literal:U}}if(this.use_array){this.toArray(Q)}return Q};this.returnAsArray=function(){this.use_array=true};this.returnAsKeys=function(){this.use_array=false};this.toArray=function(J){var H,G,F;J["date-parts"]=[];J["date-parts"].push([]);var I=0;for(H=0,G=3;H<G;H+=1){F=["year","month","day"][H];if(!J[F]){break}I+=1;J["date-parts"][0].push(J[F]);delete J[F]}J["date-parts"].push([]);for(H=0,G=I;H<G;H+=1){F=["year_end","month_end","day_end"][H];if(!J[F]){break}J["date-parts"][1].push(J[F]);delete J[F]}if(J["date-parts"][0].length!==J["date-parts"][1].length){J["date-parts"].pop()}};this.parseNumericDate=function(I,L,H,G){var F,K,J;F=G.split(L);for(K=0,J=F.length;K<J;K+=1){if(F[K].length===4){I[("year"+H)]=F[K].replace(/^0*/,"");if(!K){F=F.slice(1)}else{F=F.slice(0,K)}break}}for(K=0,J=F.length;K<J;K+=1){F[K]=parseInt(F[K],10)}if(F.length===1||(F.length===2&&!F[1])){I[("month"+H)]=""+F[0]}else{if(F.length===2){if(F[this.monthguess]>12){I[("month"+H)]=""+F[this.dayguess];I[("day"+H)]=""+F[this.monthguess]}else{I[("month"+H)]=""+F[this.monthguess];I[("day"+H)]=""+F[this.dayguess]}}}}};CSL.Engine=function(g,b,c,a){var f,j,h,e;this.processor_version=CSL.PROCESSOR_VERSION;this.csl_version="1.0";this.sys=g;if(g.variableWrapper){CSL.VARIABLE_WRAPPER_PREPUNCT_REX=new RegExp("^(["+[" "].concat(CSL.SWAPPING_PUNCTUATION).join("")+"]*)(.*)")}this.sys.xml=new CSL.System.Xml.Parsing();if("undefined"===typeof CSL_JSON&&"string"!==typeof b){b=""}if(CSL.getAbbreviation){this.sys.getAbbreviation=CSL.getAbbreviation}if(this.sys.stringCompare){CSL.stringCompare=this.sys.stringCompare}this.sys.AbbreviationSegments=CSL.AbbreviationSegments;this.parallel=new CSL.Parallel(this);this.transform=new CSL.Transform(this);this.setParseNames=function(k){this.opt["parse-names"]=k};this.opt=new CSL.Engine.Opt();this.tmp=new CSL.Engine.Tmp();this.build=new CSL.Engine.Build();this.fun=new CSL.Engine.Fun(this);this.configure=new CSL.Engine.Configure();this.citation_sort=new CSL.Engine.CitationSort();this.bibliography_sort=new CSL.Engine.BibliographySort();this.citation=new CSL.Engine.Citation(this);this.bibliography=new CSL.Engine.Bibliography();this.output=new CSL.Output.Queue(this);this.dateput=new CSL.Output.Queue(this);this.cslXml=this.sys.xml.makeXml(b);if(this.opt.development_extensions.csl_reverse_lookup_support||this.sys.csl_reverse_lookup_support){this.build.cslNodeId=0;this.setCslNodeIds=function(p,k){var o=this.sys.xml.children(p);this.sys.xml.setAttribute(p,"cslid",this.build.cslNodeId);this.opt.nodenames.push(k);this.build.cslNodeId+=1;for(var n=0,l=this.sys.xml.numberofnodes(o);n<l;n+=1){k=this.sys.xml.nodename(o[n]);if(k){this.setCslNodeIds(o[n],k)}}};this.setCslNodeIds(this.cslXml,"style")}this.sys.xml.addMissingNameNodes(this.cslXml);this.sys.xml.addInstitutionNodes(this.cslXml);this.sys.xml.insertPublisherAndPlace(this.cslXml);this.sys.xml.flagDateMacros(this.cslXml);f=this.sys.xml.attributes(this.cslXml);if("undefined"===typeof f["@sort-separator"]){this.sys.xml.setAttribute(this.cslXml,"sort-separator",", ")}this.opt["initialize-with-hyphen"]=true;this.setStyleAttributes();this.opt.xclass=g.xml.getAttributeValue(this.cslXml,"class");this.opt.styleID=this.sys.xml.getStyleId(this.cslXml);this.opt.styleName=this.sys.xml.getStyleId(this.cslXml,true);if(CSL.getSuppressJurisdictions){this.opt.suppressJurisdictions=CSL.getSuppressJurisdictions(this.opt.styleID)}if(this.opt.version.slice(0,4)==="1.1m"){this.opt.development_extensions.static_statute_locator=true;this.opt.development_extensions.handle_parallel_articles=true;this.opt.development_extensions.main_title_from_short_title=true;this.opt.development_extensions.strict_page_numbers=true;this.opt.development_extensions.rtl_support=true;this.opt.development_extensions.expect_and_symbol_form=true;this.opt.development_extensions.require_explicit_legal_case_title_short=true}if(c){c=c.replace("_","-")}if(this.opt["default-locale"][0]){this.opt["default-locale"][0]=this.opt["default-locale"][0].replace("_","-")}if(c&&a){this.opt["default-locale"]=[c]}if(c&&!a&&this.opt["default-locale"][0]){c=this.opt["default-locale"][0]}if(this.opt["default-locale"].length===0){if(!c){c="en-US"}this.opt["default-locale"].push("en-US")}if(!c){c=this.opt["default-locale"][0]}j=CSL.localeResolve(c);this.opt.lang=j.best;this.opt["default-locale"][0]=j.best;this.locale={};if(!this.opt["default-locale-sort"]){this.opt["default-locale-sort"]=this.opt["default-locale"][0]}this.localeConfigure(j);function d(k){var k=k.slice();var l=new RegExp("((?:[?!:]*\\s+|-|^)(?:"+k.join("|")+")(?=[!?:]*\\s+|-|$))");return l}this.locale[this.opt.lang].opts["skip-words-regexp"]=d(this.locale[this.opt.lang].opts["skip-words"]);this.output.adjust=new CSL.Output.Queue.adjust(this.getOpt("punctuation-in-quote"));this.registry=new CSL.Registry(this);this.buildTokenLists("citation");this.buildTokenLists("bibliography");this.configureTokenLists();this.disambiguate=new CSL.Disambiguation(this);this.splice_delimiter=false;this.fun.dateparser=new CSL.DateParser();this.fun.flipflopper=new CSL.Util.FlipFlopper(this);this.setCloseQuotesArray();this.fun.ordinalizer.init(this);this.fun.long_ordinalizer.init(this);this.fun.page_mangler=CSL.Util.PageRangeMangler.getFunction(this,"page");this.fun.year_mangler=CSL.Util.PageRangeMangler.getFunction(this,"year");this.setOutputFormat("html")};CSL.Engine.prototype.setCloseQuotesArray=function(){var a;a=[];a.push(this.getTerm("close-quote"));a.push(this.getTerm("close-inner-quote"));a.push('"');a.push("'");this.opt.close_quotes_array=a};CSL.makeBuilder=function(e){function b(f){CSL.XmlToToken.call(f,e,CSL.START)}function d(f){CSL.XmlToToken.call(f,e,CSL.END)}function c(f){CSL.XmlToToken.call(f,e,CSL.SINGLETON)}function a(h){var j,g;if(e.sys.xml.numberofnodes(e.sys.xml.children(h))){g=h;b(g);for(var f=0;f<e.sys.xml.numberofnodes(e.sys.xml.children(g));f+=1){h=e.sys.xml.children(g)[f];if(e.sys.xml.nodename(h)===null){continue}if(e.sys.xml.nodename(h)==="date"){CSL.Util.fixDateNode.call(e,g,f,h);h=e.sys.xml.children(g)[f]}a(h,b,d,c)}d(g)}else{c(h)}}return a};CSL.Engine.prototype.buildTokenLists=function(c){var a=CSL.makeBuilder(this);var b;b=this.sys.xml.getNodesByName(this.cslXml,c);if(!this.sys.xml.getNodeValue(b)){return}this.build.area=c;var d=b[0];a(d)};CSL.Engine.prototype.setStyleAttributes=function(){var g,a,e,b,f;g={};var d=this.cslXml;var c=this.cslXml.tagName?(""+this.cslXml.tagName).toLowerCase():"";if(c!=="style"&&c!=="cslstyle"){if(this.cslXml.getElementsByTagName){var d=this.cslXml.getElementsByTagName("style")[0]}}g.name=this.sys.xml.nodename(d);b=this.sys.xml.attributes(d);for(f in b){if(b.hasOwnProperty(f)){CSL.Attributes[f].call(g,this,b[f])}}};CSL.Engine.prototype.getTerm=function(c,f,b,e,h,d){if(c&&c.match(/[A-Z]/)&&c===c.toUpperCase()){CSL.debug("Warning: term key is in uppercase form: "+c);c=c.toLowerCase()}var g;if(d){g=this.opt["default-locale"][0]}else{g=this.opt.lang}var a=CSL.Engine.getField(CSL.LOOSE,this.locale[g].terms,c,f,b,e);if(!a&&c==="range-delimiter"){a="\u2013"}if(typeof a==="undefined"){if(h===CSL.STRICT){throw'Error in getTerm: term "'+c+'" does not exist.'}else{if(h===CSL.TOLERANT){a=""}}}if(a){this.tmp.cite_renders_content=true}return a};CSL.Engine.prototype.getDate=function(b,a){var c;if(a){c=this.opt["default-locale"]}else{c=this.opt.lang}if(this.locale[c].dates[b]){return this.locale[c].dates[b]}else{return false}};CSL.Engine.prototype.getOpt=function(a){if("undefined"!==typeof this.locale[this.opt.lang].opts[a]){return this.locale[this.opt.lang].opts[a]}else{return false}};CSL.Engine.prototype.getVariable=function(c,a,d,b){return CSL.Engine.getField(CSL.LOOSE,c,a,d,b)};CSL.Engine.prototype.getDateNum=function(b,a){if("undefined"===typeof b){return 0}else{return b[a]}};CSL.Engine.getField=function(e,d,c,b,o,n){var k,a,h,l,g,j;k="";if("undefined"===typeof d[c]){if(e===CSL.STRICT){throw'Error in getField: term "'+c+'" does not exist.'}else{return undefined}}if(n&&d[c][n]){j=d[c][n]}else{j=d[c]}a=[];if(b==="symbol"){a=["symbol","short"]}else{if(b==="verb-short"){a=["verb-short","verb"]}else{if(b!=="long"){a=[b]}}}a=a.concat(["long"]);g=a.length;for(l=0;l<g;l+=1){h=a[l];if("string"===typeof j||"number"===typeof j){k=j}else{if("undefined"!==typeof j[h]){if("string"===typeof j[h]||"number"===typeof j[h]){k=j[h]}else{if("number"===typeof o){k=j[h][o]}else{k=j[h][0]}}break}}}return k};CSL.Engine.prototype.configureTokenLists=function(){var h,b,j,d,a,c,f,k,g,e,l;h=["year","month","day"];g=CSL.AREAS.length;for(j=0;j<g;j+=1){b=CSL.AREAS[j];e=this[b].tokens.length-1;for(f=e;f>-1;f+=-1){d=this[b].tokens[f];if("date"===d.name&&CSL.END===d.tokentype){a=[]}if("date-part"===d.name&&d.strings.name){l=h.length;for(k=0;k<l;k+=1){c=h[k];if(c===d.strings.name){a.push(d.strings.name)}}}if("date"===d.name&&CSL.START===d.tokentype){a.reverse();d.dateparts=a}d.next=(f+1);if(d.name&&CSL.Node[d.name].configure){CSL.Node[d.name].configure.call(d,this,f)}}}this.version=CSL.version;return this.state};CSL.Engine.prototype.retrieveItems=function(e){var b,f,a;b=[];for(var d=0,c=e.length;d<c;d+=1){b.push(this.retrieveItem(""+e[d]))}return b};CSL.ITERATION=0;CSL.Engine.prototype.retrieveItem=function(u){var d,x,f,B,C;if(this.opt.development_extensions.normalize_lang_keys_to_lowercase&&"boolean"===typeof this.opt.development_extensions.normalize_lang_keys_to_lowercase){for(var z=0,o=this.opt["default-locale"].length;z<o;z+=1){this.opt["default-locale"][z]=this.opt["default-locale"][z].toLowerCase()}for(var z=0,o=this.opt["locale-translit"].length;z<o;z+=1){this.opt["locale-translit"][z]=this.opt["locale-translit"][z].toLowerCase()}for(var z=0,o=this.opt["locale-translat"].length;z<o;z+=1){this.opt["locale-translat"][z]=this.opt["locale-translat"][z].toLowerCase()}this.opt.development_extensions.normalize_lang_keys_to_lowercase=100}CSL.ITERATION+=1;d=this.sys.retrieveItem(""+u);if(this.opt.development_extensions.normalize_lang_keys_to_lowercase){if(d.multi){if(d.multi._keys){for(var c in d.multi._keys){for(var E in d.multi._keys[c]){if(E!==E.toLowerCase()){d.multi._keys[c][E.toLowerCase()]=d.multi._keys[c][E];delete d.multi._keys[c][E]}}}}if(d.multi.main){for(var c in d.multi.main){d.multi.main[c]=d.multi.main[c].toLowerCase()}}}for(var z=0,o=CSL.CREATORS.length;z>o;z+=1){var e=CSL.CREATORS[z];if(d[e]&&d[e].multi){for(var y=0,t=d[e].length;y<t;y+=1){var l=d[e][y];if(l.multi){if(l.multi._key){for(var E in l.multi._key){if(E!==E.toLowerCase()){l.multi._key[E.toLowerCase()]=l.multi._key[E];delete l.multi._key[E]}}}if(l.multi.main){l.multi.main=l.multi.main.toLowerCase()}}}}}}if(d.page){d["page-first"]=d.page;var h=""+d.page;x=h.split(/\s*(?:&|,|-|\u2013)\s*/);if(x[0].slice(-1)!=="\\"){d["page-first"]=x[0]}}if(this.opt.development_extensions.field_hack&&d.note){x=d.note.match(CSL.NOTE_FIELDS_REGEXP);if(x){var s={};for(f=0,B=x.length;f<B;f+=1){C=x[f].match(CSL.NOTE_FIELD_REGEXP);if(!d[C[1]]&&CSL.DATE_VARIABLES.indexOf(C[1])>-1){d[C[1]]={raw:C[2]}}else{if(!d[C[1]]&&CSL.NAME_VARIABLES.indexOf(C[1])>-1){if(!d[C[1]]){d[C[1]]=[]}var n=C[2].split(/\s*\|\|\s*/);if(n.length===1){d[C[1]].push({family:n[0],isInstitution:true})}else{if(n.length===2){d[C[1]].push({family:n[0],given:n[1]})}}}else{if(!d[C[1]]||C[1]==="type"){d[C[1]]=C[2].replace(/^\s+/,"").replace(/\s+$/,"")}}}d.note.replace(CSL.NOTE_FIELD_REGEXP,"")}}}for(var z=1,o=CSL.DATE_VARIABLES.length;z<o;z+=1){var a=d[CSL.DATE_VARIABLES[z]];if(a){if(this.opt.development_extensions.raw_date_parsing){if(a.raw){a=this.fun.dateparser.parse(a.raw)}}d[CSL.DATE_VARIABLES[z]]=this.dateParseArray(a)}}if(this.opt.development_extensions.static_statute_locator){if(d.type&&["bill","gazette","legislation","treaty"].indexOf(d.type)>-1){var b;var r=["type","title","jurisdiction","genre","volume","container-title"];var k=[];for(z=0,o=r.length;z<o;z+=1){b=r[z];if(d[b]){k.push(d[b])}}r=["original-date","issued"];for(z=0,r.length;z<o;z+=1){b=r[z];if(d[b]&&d[b].year){var w=d[b].year;k.push(w);break}}d.legislation_id=k.join("::")}}if(!d["title-short"]){d["title-short"]=d.shortTitle}if(this.opt.development_extensions.main_title_from_short_title){d["title-main"]=d.title;d["title-sub"]=false;if(d.title&&d["title-short"]){var v=d["title-short"];offset=v.length;if(d.title.slice(0,offset)===v&&d.title.slice(offset).match(/^\s*:/)){d["title-main"]=d.title.slice(0,offset).replace(/\s+$/,"");d["title-sub"]=d.title.slice(offset).replace(/^\s*:\s*/,"");if(this.opt.development_extensions.uppercase_subtitles&&d["title-sub"]){var g=d["title-sub"];for(var z=0,o=g.length;z<o;z++){if(g.charAt(z).toLowerCase()!==g.charAt(z).toUpperCase()){d["title-sub"]=g.slice(0,z)+g.charAt(z).toUpperCase()+g.slice(z+1);break}}}var A=offset+d.title.length-d["title-main"].length-d["title-sub"].length;d.title=d.title.slice(0,A)+d["title-sub"]}}}var q=["legal_case","legislation","gazette","regulation"].indexOf(d.type)>-1;if(!q&&d.title&&this.sys.getAbbreviation){var D=false;if(!d.jurisdiction){D=true}var p=this.transform.loadAbbreviation(d.jurisdiction,"title",d.title,d.type,true);if(this.transform.abbrevs[p].title){if(this.transform.abbrevs[p].title[d.title]){d["title-short"]=this.transform.abbrevs[p].title[d.title]}}}d["container-title-short"]=d.journalAbbreviation;if(d["container-title"]&&this.sys.getAbbreviation){var p=this.transform.loadAbbreviation(d.jurisdiction,"container-title",d["container-title"]);if(this.transform.abbrevs[p]["container-title"]){if(this.transform.abbrevs[p]["container-title"][d["container-title"]]){d["container-title-short"]=this.transform.abbrevs[p]["container-title"][d["container-title"]]}}}return d};CSL.Engine.prototype.setOpt=function(b,a,c){if(b.name==="style"||b.name==="cslstyle"){this.opt[a]=c}else{if(["citation","bibliography"].indexOf(b.name)>-1){this[b.name].opt[a]=c}else{if(["name-form","name-delimiter","names-delimiter"].indexOf(a)===-1){b.strings[a]=c}}}};CSL.Engine.prototype.fixOpt=function(b,a,c){if(["citation","bibliography"].indexOf(b.name)>-1){if(!this[b.name].opt[a]&&"undefined"!==typeof this.opt[a]){this[b.name].opt[a]=this.opt[a]}}if("name"===b.name||"names"===b.name){if("undefined"===typeof b.strings[c]&&"undefined"!==typeof this[this.build.root].opt[a]){b.strings[c]=this[this.build.root].opt[a]}}};CSL.Engine.prototype.remapSectionVariable=function(b){for(var h=0,c=b.length;h<c;h+=1){var e=b[h][0];var q=b[h][1];var d=0;var g=false;var o=false;if(["bill","gazette","legislation","treaty"].indexOf(e.type)>-1){q.force_pluralism=0;if(!q.label){q.label="page"}var p=["section","","",""];var k;if(this.opt.development_extensions.static_statute_locator&&e.section){l=e.section.replace(/^\s+/,"").replace(/\s+$/,"").split(/\s+/);if(CSL.STATUTE_SUBDIV_STRINGS[l[0]]){p[0]=" "+l[0]+" ";p[1]=l.slice(1).join(" ")}else{p[0]=" sec. ";p[1]=l.slice(0).join(" ")}}else{if(this.opt.development_extensions.clobber_locator_if_no_statute_section){q.locator=undefined;q.label=undefined}}if(q.locator){var l=q.locator.replace(/^\s+/,"").replace(/\s+$/,"").split(/\s+/);if(CSL.STATUTE_SUBDIV_STRINGS[l[0]]){p[2]=" "+l[0]+" ";p[3]=l.slice(1).join(" ")}else{if(q.label){p[2]=" "+CSL.STATUTE_SUBDIV_STRINGS_REVERSE[q.label]+" ";p[3]=l.slice(0).join(" ")}else{p[3]=l.join(" ")}}if(p[3]&&p[3].slice(0,1)==="&"){p[3]=" "+p[3]}}if(!p[2]){p[2]=p[0]}if(p[3]){if(p[3].match(/^[^0-9a-zA-Z]/)){var a=p[3].split(/\s+/);if(p[0]===p[2]&&a[1]&&!CSL.STATUTE_SUBDIV_STRINGS[a[1].replace(/\s+/,"").replace(/\s+/,"")]){q.force_pluralism=1}p[2]=""}}else{p[2]=""}if(!p[1]){p[0]=""}var o=p.join("");o=o.replace(/^\s+/,"").replace(/\s+$/,"");if(o){l=o.split(/\s+/);if(CSL.STATUTE_SUBDIV_STRINGS[l[0]]){var n=false;for(var f=l.length-2;f>0;f+=-2){if(l[f]===l[0]){q.force_pluralism=1;l=l.slice(0,f).concat(l.slice(f+1))}}q.label=CSL.STATUTE_SUBDIV_STRINGS[l[0]];q.locator=l.slice(1).join(" ");if(q.force_pluralism===0){delete q.force_pluralism}}else{q.locator=l.slice(0).join(" ")}}}}};CSL.Engine.prototype.setNumberLabels=function(b){if(b.number&&["bill","gazette","legislation","treaty"].indexOf(b.type)>-1&&this.opt.development_extensions.static_statute_locator&&!this.tmp.shadow_numbers.number){this.tmp.shadow_numbers.number={};this.tmp.shadow_numbers.number.values=[];this.tmp.shadow_numbers.number.plural=0;this.tmp.shadow_numbers.number.numeric=false;this.tmp.shadow_numbers.number.label=false;var k=""+b.number;k=k.replace("\\","","g");var f=k.split(/\s/)[0];var e=CSL.STATUTE_SUBDIV_STRINGS[f];if(e){var a=k.match(CSL.STATUTE_SUBDIV_GROUPED_REGEX);var h=k.split(CSL.STATUTE_SUBDIV_PLAIN_REGEX);if(h.length>1){var d=[];for(var c=1,l=h.length;c<l;c+=1){var g=a[c-1].replace(/^\s*/,"");d.push(g.replace("sec.","Sec.").replace("ch.","Ch."));d.push(h[c].replace(/\s*$/,"").replace(/^\s*/,""))}k=d.join(" ")}else{k=h[0]}this.tmp.shadow_numbers.number.values.push(["Blob",k,false]);this.tmp.shadow_numbers.number.numeric=false}else{this.tmp.shadow_numbers.number.values.push(["Blob",k,false]);this.tmp.shadow_numbers.number.numeric=true}}};CSL.substituteOne=function(a){return function(c,b){if(!b){return""}else{return a.replace("%%STRING%%",b)}}};CSL.substituteTwo=function(a){return function(c){var b=a.replace("%%PARAM%%",c);return function(e,d){if(!d){return""}else{return b.replace("%%STRING%%",d)}}}};CSL.Mode=function(g){var a,f,e,c,d,b;a={};f=CSL.Output.Formats[g];for(e in f){if(true){if("@"!==e.slice(0,1)){a[e]=f[e];continue}c=false;d=f[e];b=e.split("/");if(typeof d==="string"&&d.indexOf("%%STRING%%")>-1){if(d.indexOf("%%PARAM%%")>-1){c=CSL.substituteTwo(d)}else{c=CSL.substituteOne(d)}}else{if(typeof d==="boolean"&&!d){c=CSL.Output.Formatters.passthrough}else{if(typeof d==="function"){c=d}else{throw"CSL.Compiler: Bad "+g+" config entry for "+e+": "+d}}}if(b.length===1){a[b[0]]=c}else{if(b.length===2){if(!a[b[0]]){a[b[0]]={}}a[b[0]][b[1]]=c}}}}return a};CSL.setDecorations=function(d,a){var b,c,e;b=[];for(e in CSL.FORMAT_KEY_SEQUENCE){if(true){c=CSL.FORMAT_KEY_SEQUENCE[e];if(a[c]){b.push([c,a[c]]);delete a[c]}}}return b};CSL.Engine.prototype.normalDecorIsOrphan=function(c,e){if(e[1]==="normal"){var a=false;var d;if(this.tmp.area==="citation"){d=[this.citation.opt.layout_decorations].concat(c.alldecor)}else{d=c.alldecor}for(var b=d.length-1;b>-1;b+=-1){for(var f=d[b].length-1;f>-1;f+=-1){if(d[b][f][0]===e[0]){if(d[b][f][1]!=="normal"){a=true}}}}if(!a){return true}}return false};CSL.Engine.prototype.getCitationLabel=function(f){var q="";var g=this.getTrigraphParams();var d=g[0];var s=this.getTerm("reference","short",0);if("undefined"===typeof s){s="reference"}s=s.replace(".","");s=s.slice(0,1).toUpperCase()+s.slice(1);for(var k=0,b=CSL.CREATORS.length;k<b;k+=1){var c=CSL.CREATORS[k];if(f[c]){var p=f[c];if(p.length>g.length){d=g[g.length-1]}else{d=g[p.length-1]}for(var h=0,r=p.length;h<r;h+=1){if(h===d.authors.length){break}var l=this.nameOutput.getName(p[h],"locale-translit",true);var a=l.name;if(a&&a.family){s=a.family;s=s.replace(/^([ \'\u2019a-z]+\s+)/,"")}else{if(a&&a.literal){s=a.literal}}var e=s.toLowerCase().match(/^(a\s+|the\s+|an\s+)/);if(e){s=s.slice(e[1].length)}s=s.replace(CSL.ROMANESQUE_NOT_REGEXP,"","g");if(!s){break}s=s.slice(0,d.authors[h]);if(s.length>1){s=s.slice(0,1).toUpperCase()+s.slice(1).toLowerCase()}else{if(s.length===1){s=s.toUpperCase()}}q+=s}break}}var o="0000";if(f.issued){if(f.issued.year){o=""+f.issued.year}}o=o.slice((d.year*-1));q=q+o;return q};CSL.Engine.prototype.getTrigraphParams=function(){var h=[];var f=this.opt.trigraph.split(":");if(!this.opt.trigraph||this.opt.trigraph.slice(0,1)!=="A"){throw"Bad trigraph definition: "+this.opt.trigraph}for(var e=0,d=f.length;e<d;e+=1){var g=f[e];var c={authors:[],year:0};for(var b=0,a=g.length;b<a;b+=1){switch(g.slice(b,b+1)){case"A":c.authors.push(1);break;case"a":c.authors[c.authors.length-1]+=1;break;case"0":c.year+=1;break;default:throw"Invalid character in trigraph definition: "+this.opt.trigraph}}h.push(c)}return h};CSL.Engine.prototype.setOutputFormat=function(a){this.opt.mode=a;this.fun.decorate=CSL.Mode(a);if(!this.output[a]){this.output[a]={};this.output[a].tmp={}}};CSL.Engine.prototype.getSortFunc=function(){return function(d,c){d=d.split("-");c=c.split("-");if(d.length<c.length){return 1}else{if(d.length>c.length){return -1}else{d=d.slice(-1)[0];c=c.slice(-1)[0];if(d.length<c.length){return 1}else{if(d.length>c.length){return -1}else{return 0}}}}}};CSL.Engine.prototype.setLangTagsForCslSort=function(a){var c,b;if(a){this.opt["locale-sort"]=[];for(c=0,b=a.length;c<b;c+=1){this.opt["locale-sort"].push(a[c])}}this.opt["locale-sort"].sort(this.getSortFunc())};CSL.Engine.prototype.setLangTagsForCslTransliteration=function(a){var c,b;this.opt["locale-translit"]=[];if(a){for(c=0,b=a.length;c<b;c+=1){this.opt["locale-translit"].push(a[c])}}this.opt["locale-translit"].sort(this.getSortFunc())};CSL.Engine.prototype.setLangTagsForCslTranslation=function(a){var c,b;this.opt["locale-translat"]=[];if(a){for(c=0,b=a.length;c<b;c+=1){this.opt["locale-translat"].push(a[c])}}this.opt["locale-translat"].sort(this.getSortFunc())};CSL.Engine.prototype.setLangPrefsForCites=function(e,p){var a=this.opt["cite-lang-prefs"];if(!p){p=function(j){return j.toLowerCase()}}var g=["Persons","Institutions","Titles","Journals","Publishers","Places"];for(var f=0,b=g.length;f<b;f+=1){var k=p(g[f]);var n=g[f].toLowerCase();if(!e[k]){continue}var h=[];while(e[k].length>1){h.push(e[k].pop())}var l={orig:1,translit:2,translat:3};if(h.length===2&&l[h[0]]<l[h[1]]){h.reverse()}while(h.length){e[k].push(h.pop())}var d=a[n];while(d.length){d.pop()}for(var c=0,o=e[k].length;c<o;c+=1){d.push(e[k][c])}}};CSL.Engine.prototype.setLangPrefsForCiteAffixes=function(h){if(h&&h.length===48){var g=this.opt.citeAffixes;var f=0;var c=["persons","institutions","titles","journals","publishers","places"];var a=["translit","orig","translit","translat"];var k;for(var e=0,b=c.length;e<b;e+=1){for(var d=0,l=a.length;d<l;d+=1){k="";if((f%8)===4){if(!g[c[e]]["locale-"+a[d]].prefix&&!g[c[e]]["locale-"+a[d]].suffix){k=h[f]?h[f]:"";g[c[e]]["locale-"+a[d]].prefix=k;k=h[f]?h[f+1]:"";g[c[e]]["locale-"+a[d]].suffix=k}}else{k=h[f]?h[f]:"";g[c[e]]["locale-"+a[d]].prefix=k;k=h[f]?h[f+1]:"";g[c[e]]["locale-"+a[d]].suffix=k}f+=2}}this.opt.citeAffixes=g}};CSL.Engine.prototype.setAutoVietnameseNamesOption=function(a){if(a){this.opt["auto-vietnamese-names"]=true}else{this.opt["auto-vietnamese-names"]=false}};CSL.Engine.prototype.setAbbreviations=function(a){if(this.sys.setAbbreviations){this.sys.setAbbreviations(a)}};CSL.Engine.prototype.setSuppressTrailingPunctuation=function(a){this.citation.opt.suppressTrailingPunctuation=!!a};CSL.Output={};CSL.Output.Queue=function(b){this.levelname=["top"];this.state=b;this.queue=[];this.empty=new CSL.Token("empty");var a={};a.empty=this.empty;this.formats=new CSL.Stack(a);this.current=new CSL.Stack(this.queue)};CSL.Output.Queue.prototype.pop=function(){var a=this.current.value();if(a.length){return a.pop()}else{return a.blobs.pop()}};CSL.Output.Queue.prototype.getToken=function(b){var a=this.formats.value()[b];return a};CSL.Output.Queue.prototype.mergeTokenStrings=function(f,a){var b,d,c,e;b=this.formats.value()[f];d=this.formats.value()[a];c=b;if(d){if(!b){b=new CSL.Token(f,CSL.SINGLETON);b.decorations=[]}c=new CSL.Token(f,CSL.SINGLETON);e="";for(e in b.strings){if(b.strings.hasOwnProperty(e)){c.strings[e]=b.strings[e]}}for(e in d.strings){if(d.strings.hasOwnProperty(e)){c.strings[e]=d.strings[e]}}c.decorations=b.decorations.concat(d.decorations)}return c};CSL.Output.Queue.prototype.addToken=function(d,c,e){var b,a;b=new CSL.Token("output");if("string"===typeof e){e=this.formats.value()[e]}if(e&&e.strings){for(a in e.strings){if(e.strings.hasOwnProperty(a)){b.strings[a]=e.strings[a]}}b.decorations=e.decorations}if("string"===typeof c){b.strings.delimiter=c}this.formats.value()[d]=b};CSL.Output.Queue.prototype.pushFormats=function(a){if(!a){a={}}a.empty=this.empty;this.formats.push(a)};CSL.Output.Queue.prototype.popFormats=function(a){this.formats.pop()};CSL.Output.Queue.prototype.startTag=function(a,b){var c={};if(this.state.tmp["doing-macro-with-date"]&&this.state.tmp.extension){b=this.empty;a="empty"}c[a]=b;this.pushFormats(c);this.openLevel(a)};CSL.Output.Queue.prototype.endTag=function(a){this.closeLevel();this.popFormats()};CSL.Output.Queue.prototype.openLevel=function(c,f){var b,e,a,d;if("object"===typeof c){b=new CSL.Blob(undefined,c)}else{if("undefined"===typeof c){b=new CSL.Blob(undefined,this.formats.value().empty,"empty")}else{if(!this.formats.value()||!this.formats.value()[c]){throw'CSL processor error: call to nonexistent format token "'+c+'"'}b=new CSL.Blob(undefined,this.formats.value()[c],c)}}if(this.nestedBraces){b.strings.prefix=b.strings.prefix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]);b.strings.prefix=b.strings.prefix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1]);b.strings.suffix=b.strings.suffix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]);b.strings.suffix=b.strings.suffix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1])}e=this.current.value();e.push(b);this.current.push(b)};CSL.Output.Queue.prototype.closeLevel=function(a){if(a&&a!==this.current.value().levelname){CSL.error("Level mismatch error:  wanted "+a+" but found "+this.current.value().levelname)}this.current.pop()};CSL.Output.Queue.prototype.append=function(g,h,f,e,b){var c,a,k;var j=true;if(f){e=true}if(this.state.tmp["doing-macro-with-date"]&&!f){if(h!=="macro-with-date"){return false}if(h==="macro-with-date"){h="empty"}}if("undefined"===typeof g){return false}if("number"===typeof g){g=""+g}if(!f&&this.state.tmp.element_trace&&this.state.tmp.element_trace.value()==="suppress-me"){return false}a=false;if(!h){c=this.formats.value().empty}else{if(h==="literal"){c=true;j=false}else{if("string"===typeof h){c=this.formats.value()[h]}else{c=h}}}if(!c){throw"CSL processor error: unknown format token name: "+h}if(c.strings&&"undefined"===typeof c.strings.delimiter){c.strings.delimiter=""}if("string"===typeof g&&g.length){g=g.replace(/ ([:;?!\u00bb])/g,"\u202f$1").replace(/\u00ab /g,"\u00ab\u202f");this.last_char_rendered=g.slice(-1);g=g.replace(/\s+'/g,"  '").replace(/^'/g," '");if(!e){this.state.tmp.term_predecessor=true}else{if(f){this.state.tmp.term_predecessor_name=true}}}a=new CSL.Blob(g,c);if(this.nestedBraces){a.strings.prefix=a.strings.prefix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]);a.strings.prefix=a.strings.prefix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1]);a.strings.suffix=a.strings.suffix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]);a.strings.suffix=a.strings.suffix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1])}k=this.current.value();if("undefined"===typeof k&&this.current.mystack.length===0){this.current.mystack.push([]);k=this.current.value()}if("string"===typeof a.blobs){if(!e){this.state.tmp.term_predecessor=true}else{if(f){this.state.tmp.term_predecessor_name=true}}}if(!f){this.state.parallel.AppendBlobPointer(k)}if("string"===typeof g){k.push(a);if(a.strings["text-case"]){a.blobs=CSL.Output.Formatters[a.strings["text-case"]](this.state,g)}if(this.state.tmp.strip_periods&&!b){a.blobs=a.blobs.replace(/\.([^a-z]|$)/g,"$1")}for(var d=a.decorations.length-1;d>-1;d+=-1){if(a.decorations[d][0]==="@quotes"&&a.decorations[d][1]==="true"){a.punctuation_in_quote=this.state.getOpt("punctuation-in-quote")}if(!a.blobs.match(CSL.ROMANESQUE_REGEXP)){if(a.decorations[d][0]==="@font-style"){a.decorations=a.decorations.slice(0,d).concat(a.decorations.slice(d+1))}}}this.state.fun.flipflopper.init(g,a);this.state.fun.flipflopper.processTags()}else{if(j){k.push(a)}else{k.push(g)}}return true};CSL.Output.Queue.prototype.string=function(f,e,a){var r,k,q,n,v;var w=CSL.getSafeEscape(this.state);var t=e.slice();var x=[];if(t.length===0){return x}var c="";if(a){c=a.strings.delimiter}else{f.tmp.count_offset_characters=false;f.tmp.offset_characters=0}if(a&&a.new_locale){a.old_locale=f.opt.lang;f.opt.lang=a.new_locale}var y,o,d,u;for(r=0,k=t.length;r<k;r+=1){y=t[r];if(y.strings.first_blob){f.tmp.count_offset_characters=y.strings.first_blob}if("string"===typeof y.blobs){if("number"===typeof y.num){x.push(y)}else{if(y.blobs){v=w(y.blobs);var h=v.length;if(!f.tmp.suppress_decorations){for(q=0,n=y.decorations.length;q<n;q+=1){u=y.decorations[q];if(u[0]==="@showid"){continue}if(f.normalDecorIsOrphan(y,u)){continue}v=f.fun.decorate[u[0]][u[1]].call(y,f,v,u[2])}}if(v&&v.length){v=w(y.strings.prefix,f.tmp.nestedBraces)+v+w(y.strings.suffix,f.tmp.nestedBraces);if((f.opt.development_extensions.csl_reverse_lookup_support||f.sys.csl_reverse_lookup_support)&&!f.tmp.suppress_decorations){for(q=0,n=y.decorations.length;q<n;q+=1){u=y.decorations[q];if(u[0]==="@showid"){v=f.fun.decorate[u[0]][u[1]].call(y,f,v,u[2])}}}x.push(v);if(f.tmp.count_offset_characters){f.tmp.offset_characters+=(h+y.strings.suffix.length+y.strings.prefix.length)}}}}}else{if(y.blobs.length){var s=f.output.string(f,y.blobs,y);x=x.concat(s)}}if(y.strings.first_blob){f.registry.registry[y.strings.first_blob].offset=f.tmp.offset_characters;f.tmp.count_offset_characters=false}}for(r=0,k=x.length-1;r<k;r+=1){if("number"===typeof x[r].num&&"number"===typeof x[r+1].num&&!x[r+1].UGLY_DELIMITER_SUPPRESS_HACK){x[r].strings.suffix=x[r].strings.suffix+(c?c:"");x[r+1].successor_prefix="";x[r+1].UGLY_DELIMITER_SUPPRESS_HACK=true}}var l=0;for(r=0,k=x.length;r<k;r+=1){if("string"===typeof x[r]){l=(parseInt(r,10)+1);if(r<x.length-1&&"object"===typeof x[r+1]){if(c&&!x[r+1].UGLY_DELIMITER_SUPPRESS_HACK){x[r]+=w(c)}x[r+1].UGLY_DELIMITER_SUPPRESS_HACK=true}}}if(a&&(a.decorations.length||a.strings.suffix||a.strings.prefix)){l=x.length}var g=f.output.renderBlobs(x.slice(0,l),c,true,a);if(g&&a&&(a.decorations.length||a.strings.suffix||a.strings.prefix)){if(!f.tmp.suppress_decorations){for(r=0,k=a.decorations.length;r<k;r+=1){u=a.decorations[r];if(["@cite","@bibliography","@display","@showid"].indexOf(u[0])>-1){continue}if(f.normalDecorIsOrphan(y,u)){continue}if("string"===typeof g){g=f.fun.decorate[u[0]][u[1]].call(a,f,g,u[2])}}}v=g;o=a.strings.suffix;if(v&&v.length){d=a.strings.prefix;v=w(d,f.tmp.nestedBraces)+v+w(o,f.tmp.nestedBraces);if(f.tmp.count_offset_characters){f.tmp.offset_characters+=(d.length+o.length)}}g=v;if(!f.tmp.suppress_decorations){for(r=0,k=a.decorations.length;r<k;r+=1){u=a.decorations[r];if(["@cite","@bibliography","@display","@showid"].indexOf(u[0])===-1){continue}if("string"===typeof g){g=f.fun.decorate[u[0]][u[1]].call(a,f,g,u[2])}}}}var p=x.slice(l,x.length);if(!p.length&&g){x=[g]}else{if(p.length&&!g){x=p}else{if(g&&p.length){x=[g].concat(p)}}}if("undefined"===typeof a){this.queue=[];this.current.mystack=[];this.current.mystack.push(this.queue);if(f.tmp.suppress_decorations){x=f.output.renderBlobs(x,undefined,true)}}else{if("boolean"===typeof a){x=f.output.renderBlobs(x,undefined,true)}}if(a&&a.new_locale){f.opt.lang=a.old_locale}return x};CSL.Output.Queue.prototype.clearlevel=function(){var b,c,a;b=this.current.value();a=b.blobs.length;for(c=0;c<a;c+=1){b.blobs.pop()}};CSL.Output.Queue.prototype.renderBlobs=function(v,y,b,j){var f,z,h,q,s,c,g,t,A,u,d,l,B,p,w,x;x=CSL.getSafeEscape(this.state);if(!y){y=""}f=this.state;z="";h=[];q="";t=v.length;if(this.state.tmp.area==="citation"&&!this.state.tmp.just_looking&&t===1&&typeof v[0]==="object"&&j){v[0].strings.prefix=j.strings.prefix+v[0].strings.prefix;v[0].strings.suffix=v[0].strings.suffix+j.strings.suffix;v[0].decorations=v[0].decorations.concat(j.decorations);v[0].params=j.params;return v[0]}var e=true;for(g=0;g<t;g+=1){if(v[g].checkNext){v[g].checkNext(v[(g+1)],e);e=false}else{e=true}}var n=true;for(g=v.length-1;g>0;g+=-1){if(v[g].checkLast){if(n&&v[g].checkLast(v[g-1])){n=false}}else{n=true}}t=v.length;for(g=0;g<t;g+=1){c=v[g];if(z){q=y}if("string"===typeof c){z+=x(q);z+=c;if(f.tmp.count_offset_characters){f.tmp.offset_characters+=(q.length)}}else{if(c.status!==CSL.SUPPRESS){p=c.formatter.format(c.num,c.gender);var k=p.replace(/<[^>]*>/g,"").length;this.append(p,"empty",true);var o=this.pop();var r=f.tmp.count_offset_characters;p=this.string(f,[o],false);f.tmp.count_offset_characters=r;if(c.strings["text-case"]){p=CSL.Output.Formatters[c.strings["text-case"]](this.state,p)}if(p&&this.state.tmp.strip_periods){p=p.replace(/\.([^a-z]|$)/g,"$1")}if(!f.tmp.suppress_decorations){u=c.decorations.length;for(A=0;A<u;A+=1){w=c.decorations[A];if(f.normalDecorIsOrphan(c,w)){continue}p=f.fun.decorate[w[0]][w[1]].call(c,f,p,w[2])}}p=x(c.strings.prefix)+p+x(c.strings.suffix);var a="";if(c.status===CSL.END){a=x(c.range_prefix)}else{if(c.status===CSL.SUCCESSOR){a=x(c.successor_prefix)}else{if(c.status===CSL.START){a=""}else{if(c.status===CSL.SEEN){a=x(c.splice_prefix)}}}}z+=a;z+=p;if(f.tmp.count_offset_characters){f.tmp.offset_characters+=(a.length+c.strings.prefix.length+k+c.strings.suffix.length)}}}}return z};CSL.Output.Queue.purgeEmptyBlobs=function(c){if("object"!==typeof c||"object"!==typeof c.blobs||!c.blobs.length){return}for(var b=c.blobs.length-1;b>-1;b--){CSL.Output.Queue.purgeEmptyBlobs(c.blobs[b]);var d=c.blobs[b];if(!d||!d.blobs||!d.blobs.length){var a=[];while((c.blobs.length-1)>b){a.push(c.blobs.pop())}c.blobs.pop();while(a.length){c.blobs.push(a.pop())}}}};CSL.Output.Queue.adjust=function(j){var u={";":true,":":true};var e={".":true,"!":true,"?":true};this.upward=h;this.leftward=a;this.downward=t;this.fix=l;var s={"!":{".":"!","?":"!?",":":"!",",":"!,",";":"!;"},"?":{"!":"?!",".":"?",":":"?",",":"?,",";":"?;"},".":{"!":".!","?":".?",":":".:",",":".,",";":".;"},":":{"!":"!","?":"?",".":":",",":":,",";":":;"},",":{"!":",!","?":",?",":":",:",".":",.",";":",;"},";":{"!":"!","?":"?",":":";",",":";,",".":";"}};var y={};var w={};var c={};var d={};for(var z in s){c[z]=true;d[z]=true;if(!u[z]){y[z]=true}if(!e[z]){w[z]=true}}d[" "]=true;d[" "]=true;var n={};for(var z in s){for(var v in s[z]){if(!n[v]){n[v]={}}n[v][z]=s[z][v]}}function p(A){return("number"===typeof A.num||(A.blobs&&A.blobs.length===1&&"number"===typeof A.blobs[0].num))}function k(A){if("number"===typeof A.num){return true}if(!A.blobs||"object"!==typeof A.blobs){return false}if(k(A.blobs[A.blobs.length-1])){return true}}function q(A,E){var B=false;var F=["@font-style","@font-variant","@font-weight","@text-decoration","@vertical-align"];if(E){F.push("@quotes")}if(A.decorations){for(var D=0,C=A.decorations.length;D<C;D++){if(F.indexOf(A.decorations[D][0])>-1){B=true;break}}}return B}function g(A){if(A.decorations){for(var C=0,B=A.decorations.length;C<B;C++){if(A.decorations[C][0]==="@quotes"){return true}}}if("object"!==typeof A.blobs){return false}if(g(A.blobs[A.blobs.length-1])){return true}return false}function o(D,C){var B=C.strings.suffix.slice(-1);if(!B&&"string"===typeof C.blobs){B=C.blobs.slice(-1)}var A=n[D][B];if(A&&A.length===1){return true}if("object"!==typeof C.blobs){return false}if(o(D,C.blobs[C.blobs.length-1])){return true}return false}function f(B,C){if(!c[C]){return false}if("string"===typeof B.blobs){if(B.blobs.slice(-1)===C){return true}else{return false}}else{var D=B.blobs[B.blobs.length-1];if(D){var A=D.strings.suffix.slice(-1);if(!A){return f(D,C)}else{if(D.strings.suffix.slice(-1)==C){return true}else{return false}}}else{return false}}}function b(J,E,M,Q,S){FirstStrings="blobs"===E?J:J.strings;SecondStrings="blobs"===Q?M:M.strings;var P=FirstStrings[E].slice(-1);var L=SecondStrings[Q].slice(0,1);function G(){SecondStrings[Q]=SecondStrings[Q].slice(1)}function C(){FirstStrings[E]=FirstStrings[E].slice(0,-1)}function N(T){SecondStrings[Q]=T+SecondStrings[Q]}function B(T){FirstStrings[E]+=T}var R=S?C:G;function I(){return n[L]}function H(){return s[P]}var F=S?H:I;function A(){var T=s[P][L];if("string"===typeof T){C();G();N(T)}else{N(P);C()}}function K(){var T=n[L][P];if("string"===typeof T){C();G();B(T)}else{B(L);G()}}var D=S?A:K;var O=P===L;if(O){R()}else{if(F()){D()}}}function h(C){if(C.blobs&&"string"==typeof C.blobs){if(c[C.strings.suffix.slice(0,1)]&&C.strings.suffix.slice(0,1)===C.blobs.slice(-1)){C.strings.suffix=C.strings.suffix.slice(1)}return}else{if("object"!==typeof C||"object"!==typeof C.blobs||!C.blobs.length){return}}var F=q(C,true);for(var B=C.blobs.length-1;B>-1;B--){var D=B===(C.blobs.length-1);this.upward(C.blobs[B]);var E=C.strings;var G=C.blobs[B].strings;if(B===0){if(" "===E.prefix.slice(-1)&&" "===G.prefix.slice(0,1)){G.prefix=G.prefix.slice(1)}var A=G.prefix.slice(0,1);if(!F&&d[A]&&!E.prefix){E.prefix+=A;G.prefix=G.prefix.slice(1)}}if(B===(C.blobs.length-1)){var A=G.suffix.slice(-1);if(!F&&[" "].indexOf(A)>-1){if(E.suffix.slice(0,1)!==A){E.suffix=A+E.suffix}G.suffix=G.suffix.slice(0,-1)}}if(E.delimiter&&B>0){if(d[E.delimiter.slice(-1)]&&E.delimiter.slice(-1)===G.prefix.slice(0,1)){G.prefix=G.prefix.slice(1)}}}}function a(H){if("object"!==typeof H||"object"!==typeof H.blobs||!H.blobs.length){return}for(var F=H.blobs.length-1;F>-1;F--){this.leftward(H.blobs[F]);if((F<H.blobs.length-1)&&!H.strings.delimiter){var B=H.blobs[F];var J=B.strings.suffix.slice(-1);var I=H.blobs[F+1];var C=I.strings.prefix.slice(0,1);var D=q(B)||q(I);var E="number"===typeof J||"number"===typeof C;if(!D&&!E&&c[C]&&!E){var A=C===B.strings.suffix.slice(-1);var G=(!B.strings.suffix&&"string"===typeof B.blobs&&B.blobs.slice(-1)===C);if(!A&&!G){b(B,"suffix",I,"prefix")}else{I.strings.prefix=I.strings.prefix.slice(1)}}}}}function t(P,M){if(P.blobs&&"string"==typeof P.blobs){if(c[P.strings.suffix.slice(0,1)]&&P.strings.suffix.slice(0,1)===P.blobs.slice(-1)){P.strings.suffix=P.strings.suffix.slice(1)}return}else{if("object"!==typeof P||"object"!==typeof P.blobs||!P.blobs.length){return}}var G=P.strings;var A=false;for(var H=0,C=P.blobs.length;H<C;H++){if(p(P.blobs[H])){A=true;break}}if(!A){if(G.delimiter&&c[G.delimiter.slice(0,1)]){var O=G.delimiter.slice(0,1);for(var H=P.blobs.length-2;H>-1;H--){var L=P.blobs[H].strings;if(L.suffix.slice(-1)!==O){L.suffix+=O}}G.delimiter=G.delimiter.slice(1)}}var J=q(P,true);var E=p(P);for(var H=P.blobs.length-1;H>-1;H--){var B=P.blobs[H];var L=P.blobs[H].strings;var K=q(B,true);var N=p(B);if(H===(P.blobs.length-1)){if(true||!A){var F=G.suffix.slice(0,1);var D=g(B);if(!D&&c[F]){D=o(F,B)}if(D){if(c[F]){if(!k(B)){if("string"===typeof B.blobs){b(B,"blobs",P,"suffix")}else{b(B,"suffix",P,"suffix")}if(G.suffix.slice(0,1)==="."){L.suffix+=G.suffix.slice(0,1);G.suffix=G.suffix.slice(1)}}}}if(L.suffix.slice(-1)===" "&&G.suffix.slice(0,1)===" "){G.suffix=G.suffix.slice(1)}if(d[L.suffix.slice(0,1)]){if("string"===typeof B.blobs&&B.blobs.slice(-1)===L.suffix.slice(0,1)){L.suffix=L.suffix.slice(1)}if(L.suffix.slice(-1)===G.suffix.slice(0,1)){G.suffix=G.suffix.slice(0,-1)}}}if(f(P,P.strings.suffix.slice(0,1))){P.strings.suffix=P.strings.suffix.slice(1)}}else{if(G.delimiter){if(d[G.delimiter.slice(0,1)]&&G.delimiter.slice(0,1)===L.suffix.slice(-1)){P.blobs[H].strings.suffix=P.blobs[H].strings.suffix.slice(0,-1)}}else{var I=P.blobs[H+1].strings;if(!p(B)&&!K&&d[L.suffix.slice(-1)]&&L.suffix.slice(-1)===I.prefix.slice(0,1)){I.prefix=I.prefix.slice(1)}}}if(!N&&!K&&c[L.suffix.slice(0,1)]&&"string"===typeof B.blobs){b(B,"blobs",B,"suffix")}this.downward(P.blobs[H])}}function r(B){var A=B.strings.suffix.slice(0,1);if("string"===typeof B.blobs){while(y[A]){b(B,"blobs",B,"suffix");A=B.strings.suffix.slice(0,1)}}else{while(y[A]){b(B.blobs[B.blobs.length-1],"suffix",B,"suffix");A=B.strings.suffix.slice(0,1)}}}function x(B){if("string"===typeof B.blobs){var A=B.blobs.slice(-1);while(w[A]){b(B,"blobs",B,"suffix",true);A=B.blobs.slice(-1)}}else{var A=B.blobs[B.blobs.length-1].strings.suffix.slice(-1);while(w[A]){b(B.blobs[B.blobs.length-1],"suffix",B,"suffix",true);A=B.blobs[B.blobs.length-1].strings.suffix.slice(-1)}}}function l(F){if("object"!==typeof F||"object"!==typeof F.blobs||!F.blobs.length){return}var H;for(var D=0,B=F.blobs.length;D<B;D++){var A=F.blobs[D];var E=false;for(var C=0,I=A.decorations.length;C<I;C++){var G=A.decorations[C];if(G[0]==="@quotes"){E=true}}if(E){if(j){r(A)}else{x(A)}}H=this.fix(F.blobs[D]);if(A.blobs&&"string"===typeof A.blobs){H=A.blobs.slice(-1)}}return H}};CSL.Engine.Opt=function(){this.has_disambiguate=false;this.mode="html";this.dates={};this["locale-sort"]=[];this["locale-translit"]=[];this["locale-translat"]=[];this.citeAffixes={persons:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},institutions:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},titles:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},journals:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},publishers:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},places:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}}};this["default-locale"]=[];this.update_mode=CSL.NONE;this.bib_mode=CSL.NONE;this.sort_citations=false;this["et-al-min"]=0;this["et-al-use-first"]=1;this["et-al-use-last"]=false;this["et-al-subsequent-min"]=false;this["et-al-subsequent-use-first"]=false;this["demote-non-dropping-particle"]="display-and-sort";this["parse-names"]=true;this.citation_number_slug=false;this.trigraph="Aaaa00:AaAa00:AaAA00:AAAA00";this.nodenames=[];this.gender={};this["cite-lang-prefs"]={persons:["orig"],institutions:["orig"],titles:["orig","translat"],journals:["translit"],publishers:["orig"],places:["orig"],number:["translat"]};this.has_layout_locale=false;this.development_extensions={};this.development_extensions.field_hack=true;this.development_extensions.locator_date_and_revision=true;this.development_extensions.locator_parsing_for_plurals=true;this.development_extensions.locator_label_parse=true;this.development_extensions.raw_date_parsing=true;this.development_extensions.clean_up_csl_flaws=true;this.development_extensions.flip_parentheses_to_braces=true;this.development_extensions.jurisdiction_subfield=true;this.development_extensions.static_statute_locator=false;this.development_extensions.csl_reverse_lookup_support=false;this.development_extensions.clobber_locator_if_no_statute_section=false;this.development_extensions.wrap_url_and_doi=false;this.development_extensions.allow_force_lowercase=false;this.development_extensions.handle_parallel_articles=false;this.development_extensions.thin_non_breaking_space_html_hack=false;this.development_extensions.apply_citation_wrapper=false;this.development_extensions.main_title_from_short_title=false;this.development_extensions.uppercase_subtitles=false;this.development_extensions.normalize_lang_keys_to_lowercase=false;this.development_extensions.strict_text_case_locales=false;this.development_extensions.rtl_support=false;this.development_extensions.strict_page_numbers=false;this.development_extensions.expect_and_symbol_form=false;this.development_extensions.require_explicit_legal_case_title_short=false};CSL.Engine.Tmp=function(){this.names_max=new CSL.Stack();this.names_base=new CSL.Stack();this.givens_base=new CSL.Stack();this.value=[];this.namepart_decorations={};this.namepart_type=false;this.area="citation";this.root="citation";this.extension="";this.can_substitute=new CSL.Stack(0,CSL.LITERAL);this.element_rendered_ok=false;this.element_trace=new CSL.Stack("style");this.nameset_counter=0;this.group_context=new CSL.Stack([false,false,false],CSL.LITERAL);this.term_predecessor=false;this.jump=new CSL.Stack(0,CSL.LITERAL);this.decorations=new CSL.Stack();this.tokenstore_stack=new CSL.Stack();this.last_suffix_used="";this.last_names_used=[];this.last_years_used=[];this.years_used=[];this.names_used=[];this.taintedItemIDs={};this.taintedCitationIDs={};this.initialize_with=new CSL.Stack();this.disambig_request=false;this["name-as-sort-order"]=false;this.suppress_decorations=false;this.disambig_settings=new CSL.AmbigConfig();this.bib_sort_keys=[];this.prefix=new CSL.Stack("",CSL.LITERAL);this.suffix=new CSL.Stack("",CSL.LITERAL);this.delimiter=new CSL.Stack("",CSL.LITERAL);this.cite_locales=[];this.cite_affixes={citation:false,bibliography:false,citation_sort:false,bibliography_sort:false};this.strip_periods=0;this.shadow_numbers={}};CSL.Engine.Fun=function(a){this.match=new CSL.Util.Match;this.suffixator=new CSL.Util.Suffixator(CSL.SUFFIX_CHARS);this.romanizer=new CSL.Util.Romanizer();this.ordinalizer=new CSL.Util.Ordinalizer(a);this.long_ordinalizer=new CSL.Util.LongOrdinalizer()};CSL.Engine.Build=function(){this["alternate-term"]=false;this.in_bibliography=false;this.in_style=false;this.skip=false;this.postponed_macro=false;this.layout_flag=false;this.name=false;this.form=false;this.term=false;this.macro={};this.macro_stack=[];this.text=false;this.lang=false;this.area="citation";this.root="citation";this.extension="";this.substitute_level=new CSL.Stack(0,CSL.LITERAL);this.names_level=0;this.render_nesting_level=0;this.render_seen=false};CSL.Engine.Configure=function(){this.fail=[];this.succeed=[]};CSL.Engine.Citation=function(a){this.opt={};this.tokens=[];this.srt=new CSL.Registry.Comparifier(a,"citation_sort");this.opt.collapse=[];this.opt["disambiguate-add-names"]=false;this.opt["disambiguate-add-givenname"]=false;this.opt["disambiguate-add-year-suffix"]=false;this.opt["givenname-disambiguation-rule"]="by-cite";this.opt["near-note-distance"]=5;this.opt.topdecor=[];this.opt.layout_decorations=[];this.opt.layout_prefix="";this.opt.layout_suffix="";this.opt.layout_delimiter="";this.opt.sort_locales=[];this.opt.max_number_of_names=0;this.root="citation"};CSL.Engine.Bibliography=function(){this.opt={};this.tokens=[];this.opt.collapse=[];this.opt.topdecor=[];this.opt.layout_decorations=[];this.opt.layout_prefix="";this.opt.layout_suffix="";this.opt.layout_delimiter="";this.opt["line-spacing"]=1;this.opt["entry-spacing"]=1;this.opt.sort_locales=[];this.opt.max_number_of_names=0;this.root="bibliography"};CSL.Engine.BibliographySort=function(){this.tokens=[];this.opt={};this.opt.sort_directions=[];this.keys=[];this.opt.topdecor=[];this.root="bibliography"};CSL.Engine.CitationSort=function(){this.tokens=[];this.opt={};this.opt.sort_directions=[];this.keys=[];this.opt.topdecor=[];this.root="citation"};CSL.Engine.prototype.previewCitationCluster=function(d,c,f,e){var a=this.opt.mode;this.setOutputFormat(e);var b=this.processCitationCluster(d,c,f,CSL.PREVIEW);this.setOutputFormat(a);return b[1]};CSL.Engine.prototype.appendCitationCluster=function(d){var b=[];var a=this.registry.citationreg.citationByIndex.length;for(var f=0;f<a;f+=1){var e=this.registry.citationreg.citationByIndex[f];b.push([""+e.citationID,e.properties.noteIndex])}return this.processCitationCluster(d,b,[])[1]};CSL.Engine.prototype.processCitationCluster=function(K,Q,aj,aI){var aa,U,J,T,L,R,S,N,af,am,F,t,d,an,O,v;this.debug=false;this.tmp.citation_errors=[];var ag={bibchange:false};this.setCitationId(K);var ap;var aB;var r;if(aI===CSL.PREVIEW){ap=this.registry.citationreg.citationByIndex.slice();aB=this.registry.reflist.slice();var u=Q.concat([[""+K.citationID,K.properties.noteIndex]]).concat(aj);var ax={};var ad=[];for(U=0,J=u.length;U<J;U+=1){aa=this.registry.citationreg.citationById[u[U][0]];for(T=0,L=aa.citationItems.length;T<L;T+=1){ax[aa.citationItems[T].id]=true;ad.push(""+aa.citationItems[T].id)}}r={};for(U=0,J=aB.length;U<J;U+=1){if(!ax[aB[U].id]){var ab=this.registry.registry[aB[U].id].ambig;var aE=this.registry.ambigcites[ab];if(aE){for(T=0,L=aE.length;T<L;T+=1){r[aE[T]]=CSL.cloneAmbigConfig(this.registry.registry[aE[T]].disambig)}}}}}this.tmp.taintedCitationIDs={};var h=[];var E={};for(U=0,J=K.citationItems.length;U<J;U+=1){t={};for(am in K.citationItems[U]){t[am]=K.citationItems[U][am]}F=this.retrieveItem(""+t.id);if(F.id){this.transform.loadAbbreviation("default","hereinafter",F.id)}this.remapSectionVariable([[F,t]]);if(this.opt.development_extensions.locator_date_and_revision){if(t.locator){t.locator=""+t.locator;var aC=t.locator.indexOf("|");if(aC>-1){var p=t.locator;t.locator=p.slice(0,aC);p=p.slice(aC+1);O=p.match(/^([0-9]{4}-[0-9]{2}-[0-9]{2}).*/);if(O){t["locator-date"]=this.fun.dateparser.parse(O[1]);p=p.slice(O[1].length)}t["locator-revision"]=p.replace(/^\s+/,"").replace(/\s+$/,"")}}}if(this.opt.development_extensions.locator_label_parse){if(t.locator&&["bill","gazette","legislation","treaty"].indexOf(F.type)===-1&&(!t.label||t.label==="page")){O=CSL.LOCATOR_LABELS_REGEXP.exec(t.locator);if(O){t.label=CSL.LOCATOR_LABELS_MAP[O[2]];t.locator=O[3]}}}var aF=[F,t];h.push(aF);K.citationItems[U].item=F}K.sortedItems=h;var aH=[];for(U=0,J=Q.length;U<J;U+=1){aa=Q[U];this.registry.citationreg.citationById[aa[0]].properties.noteIndex=aa[1];aH.push(this.registry.citationreg.citationById[aa[0]])}aH.push(K);for(U=0,J=aj.length;U<J;U+=1){aa=aj[U];this.registry.citationreg.citationById[aa[0]].properties.noteIndex=aa[1];aH.push(this.registry.citationreg.citationById[aa[0]])}this.registry.citationreg.citationByIndex=aH;this.registry.citationreg.citationsByItemId={};if(this.opt.update_mode===CSL.POSITION){an=[];d=[];v={}}var C=[];for(U=0,J=aH.length;U<J;U+=1){aH[U].properties.index=U;for(T=0,L=aH[U].sortedItems.length;T<L;T+=1){t=aH[U].sortedItems[T];if(!this.registry.citationreg.citationsByItemId[t[1].id]){this.registry.citationreg.citationsByItemId[t[1].id]=[];C.push(""+t[1].id)}if(this.registry.citationreg.citationsByItemId[t[1].id].indexOf(aH[U])===-1){this.registry.citationreg.citationsByItemId[t[1].id].push(aH[U])}}if(this.opt.update_mode===CSL.POSITION){if(aH[U].properties.noteIndex){d.push(aH[U])}else{aH[U].properties.noteIndex=0;an.push(aH[U])}}}if(aI!==CSL.ASSUME_ALL_ITEMS_REGISTERED){this.updateItems(C)}if(!this.opt.citation_number_sort&&h&&h.length>1&&this.citation_sort.tokens.length>0){for(U=0,J=h.length;U<J;U+=1){h[U][1].sortkeys=CSL.getSortKeys.call(this,h[U][0],"citation_sort")}if(this.opt.grouped_sort&&!K.properties.unsorted){for(U=0,J=h.length;U<J;U+=1){var w=h[U][1].sortkeys;this.tmp.authorstring_request=true;var o=this.registry.registry[h[U][0].id].disambig;this.tmp.authorstring_request=true;CSL.getAmbiguousCite.call(this,h[U][0],o);var G=this.registry.authorstrings[h[U][0].id];this.tmp.authorstring_request=false;h[U][1].sortkeys=[G].concat(w)}h.sort(this.citation.srt.compareCompositeKeys);var ar=false;var H=false;var aD=false;for(U=0,J=h.length;U<J;U+=1){if(h[U][1].sortkeys[0]!==ar){aD=h[U][1].sortkeys[0];H=h[U][1].sortkeys[1]}h[U][1].sortkeys[0]=""+H+U;ar=aD}}if(!K.properties.unsorted){h.sort(this.citation.srt.compareCompositeKeys)}}var at;if(this.opt.update_mode===CSL.POSITION){for(U=0;U<2;U+=1){at=[an,d][U];var X={};var q={};for(T=0,L=at.length;T<L;T+=1){var aq=at[T];if(!at[T].properties.noteIndex){at[T].properties.noteIndex=0}at[T].properties.noteIndex=parseInt(at[T].properties.noteIndex,10);if(T>0&&at[T-1].properties.noteIndex>at[T].properties.noteIndex){v={};X={};q={}}for(R=0,S=aq.sortedItems.length;R<S;R+=1){if(!this.registry.registry[aq.sortedItems[R][1].id].parallel){if(!v[aq.properties.noteIndex]){v[aq.properties.noteIndex]=1}else{v[aq.properties.noteIndex]+=1}}}for(R=0,S=at[T].sortedItems.length;R<S;R+=1){t=at[T].sortedItems[R];var ac=t[0].id;var z=t[1].locator;var ak=t[1].label;if(t[0].legislation_id){ac=t[0].legislation_id}var s;if(R>0){if(aq.sortedItems[R-1][0].legislation_id){s=aq.sortedItems[R-1][0].legislation_id}else{s=aq.sortedItems[R-1][1].id}}if(aI===CSL.PREVIEW){if(aq.citationID!=K.citationID){if("undefined"===typeof X[t[1].id]){X[ac]=aq.properties.noteIndex;q[ac]=aq.properties.noteIndex}else{q[ac]=aq.properties.noteIndex}continue}}var Z={};Z.position=t[1].position;Z["first-reference-note-number"]=t[1]["first-reference-note-number"];Z["near-note"]=t[1]["near-note"];t[1]["first-reference-note-number"]=0;t[1]["near-note"]=false;if(this.registry.citationreg.citationsByItemId[ac]){if(this.opt.xclass==="note"&&this.opt.has_disambiguate){var y=this.registry.registry[ac]["citation-count"];var b=this.registry.citationreg.citationsByItemId[ac].length;this.registry.registry[ac]["citation-count"]=this.registry.citationreg.citationsByItemId[ac].length;if("number"===typeof y){var aJ=(y<2);var ae=(b<2);if(aJ!==ae){for(var P=0,W=this.registry.citationreg.citationsByItemId[ac].length;P<W;P++){E[this.registry.registry[ac].ambig]=true;this.tmp.taintedCitationIDs[this.registry.citationreg.citationsByItemId[ac][P].citationID]=true}}}else{for(var P=0,W=this.registry.citationreg.citationsByItemId[ac].length;P<W;P++){E[this.registry.registry[ac].ambig]=true;this.tmp.taintedCitationIDs[this.registry.citationreg.citationsByItemId[ac][P].citationID]=true}}}}var aG;if("undefined"===typeof X[ac]){X[ac]=aq.properties.noteIndex;if(this.registry.registry[ac]){this.registry.registry[ac]["first-reference-note-number"]=aq.properties.noteIndex}q[ac]=aq.properties.noteIndex;t[1].position=CSL.POSITION_FIRST}else{var D=false;var B=false;if(T>0){aG=at[T-1].sortedItems.slice(-1)[0][1].id;if(at[T-1].sortedItems[0].slice(-1)[0].legislation_id){aG=at[T-1].sortedItems[0].slice(-1)[0].legislation_id}}if(T>0&&parseInt(R,10)===0&&at[T-1].properties.noteIndex!==at[T].properties.noteIndex){var aw=at[(T-1)].sortedItems;var ai=false;var x=at[T-1].sortedItems[0][0].id;if(at[T-1].sortedItems[0][0].legislation_id){x=at[T-1].sortedItems[0][0].legislation_id}if((x==ac&&at[T-1].properties.noteIndex>=(at[T].properties.noteIndex-1))||at[T-1].sortedItems[0][1].id==this.registry.registry[t[1].id].parallel){if(v[at[T-1].properties.noteIndex]===1||at[T-1].properties.noteIndex===0){ai=true}}for(N=0,af=aw.slice(1).length;N<af;N+=1){var aA=aw.slice(1)[N];if(!this.registry.registry[aA[1].id].parallel||this.registry.registry[aA[1].id].parallel==this.registry.registry[aA[1].id]){ai=false}}if(ai){D=true}else{B=true}}else{if(R>0&&s==ac){D=true}else{if(R===0&&at[T-1].properties.noteIndex==at[T].properties.noteIndex&&at[T-1].sortedItems.length&&aG==ac){D=true}else{B=true}}}var I,V,au,ao,a;if(D){if(R>0){I=aq.sortedItems[(R-1)][1]}else{I=at[(T-1)].sortedItems[0][1]}if(I.locator){if(I.label){au=I.label}else{au=""}V=""+I.locator+au}else{V=I.locator}if(z){if(ak){a=ak}else{a=""}ao=""+z+a}else{ao=z}}if(D&&V&&!ao){D=false;B=true}if(D){if(!V&&ao){t[1].position=CSL.POSITION_IBID_WITH_LOCATOR}else{if(!V&&!ao){t[1].position=CSL.POSITION_IBID}else{if(V&&ao===V){t[1].position=CSL.POSITION_IBID}else{if(V&&ao&&ao!==V){t[1].position=CSL.POSITION_IBID_WITH_LOCATOR}else{D=false;B=true}}}}}if(B){t[1].position=CSL.POSITION_SUBSEQUENT}if(B||D){if(X[ac]!=aq.properties.noteIndex){t[1]["first-reference-note-number"]=X[ac];if(this.registry.registry[ac]){var az=this.registry.citationreg.citationsByItemId[ac][0].properties.noteIndex;var al=aq.properties.noteIndex;this.registry.registry[ac]["first-reference-note-number"]=al<az?al:az}}}}if(aq.properties.noteIndex){var A=parseInt(aq.properties.noteIndex,10)-parseInt(q[ac],10);if(t[1].position!==CSL.POSITION_FIRST&&A<=this.citation.opt["near-note-distance"]){t[1]["near-note"]=true}q[ac]=aq.properties.noteIndex}if(aq.citationID!=K.citationID){for(N=0,af=CSL.POSITION_TEST_VARS.length;N<af;N+=1){var ah=CSL.POSITION_TEST_VARS[N];if(t[1][ah]!==Z[ah]){if(ah==="first-reference-note-number"){E[this.registry.registry[ac].ambig]=true}this.tmp.taintedCitationIDs[aq.citationID]=true;if(ah==="first-reference-note-number"){this.tmp.taintedItemIDs[ac]=true}}}}if(this.sys.variableWrapper){t[1].index=aq.properties.index;t[1].noteIndex=aq.properties.noteIndex}}}}}if(this.opt.citation_number_sort&&h&&h.length>1&&this.citation_sort.tokens.length>0){for(U=0,J=h.length;U<J;U+=1){h[U][1].sortkeys=CSL.getSortKeys.call(this,h[U][0],"citation_sort")}if(!K.properties.unsorted){h.sort(this.citation.srt.compareCompositeKeys)}}for(am in this.tmp.taintedItemIDs){if(this.tmp.taintedItemIDs.hasOwnProperty(am)){at=this.registry.citationreg.citationsByItemId[am];if(at){for(U=0,J=at.length;U<J;U+=1){this.tmp.taintedCitationIDs[at[U].citationID]=true}}}}var M=[];if(aI===CSL.PREVIEW){try{M=this.process_CitationCluster.call(this,K.sortedItems,K.citationID)}catch(Y){CSL.error("Error running CSL processor for preview: "+Y)}this.registry.citationreg.citationByIndex=ap;this.registry.citationreg.citationById={};for(U=0,J=ap.length;U<J;U+=1){this.registry.citationreg.citationById[ap[U].citationID]=ap[U]}var ay=[];for(U=0,J=aB.length;U<J;U+=1){ay.push(""+aB[U].id)}this.updateItems(ay);for(am in r){if(r.hasOwnProperty(am)){this.registry.registry[am].disambig=r[am]}}}else{for(var g in E){this.disambiguate.run(g,K)}var f;for(am in this.tmp.taintedCitationIDs){if(am==K.citationID){continue}var av=this.registry.citationreg.citationById[am];this.tmp.citation_pos=av.properties.index;this.tmp.citation_note_index=av.properties.noteIndex;this.tmp.citation_id=""+av.citationID;f=[];f.push(av.properties.index);f.push(this.process_CitationCluster.call(this,av.sortedItems,av.citationID));M.push(f)}this.tmp.taintedItemIDs={};this.tmp.taintedCitationIDs={};this.tmp.citation_pos=K.properties.index;this.tmp.citation_note_index=K.properties.noteIndex;this.tmp.citation_id=""+K.citationID;f=[];f.push(Q.length);f.push(this.process_CitationCluster.call(this,h,K.citationID));M.push(f);M.sort(function(e,c){if(e[0]>c[0]){return 1}else{if(e[0]<c[0]){return -1}else{return 0}}})}ag.citation_errors=this.tmp.citation_errors.slice();return[ag,M]};CSL.Engine.prototype.process_CitationCluster=function(b,a){var c;this.parallel.StartCitation(b);c=CSL.getCitationCluster.call(this,b,a);return c};CSL.Engine.prototype.makeCitationCluster=function(c){var a,b,g,h,f,k,e;a=[];f=c.length;for(h=0;h<f;h+=1){k={};for(var j in c[h]){k[j]=c[h][j]}e=this.retrieveItem(""+k.id);if(this.opt.development_extensions.locator_label_parse){if(k.locator&&["bill","gazette","legislation","treaty"].indexOf(e.type)===-1&&(!k.label||k.label==="page")){var d=CSL.LOCATOR_LABELS_REGEXP.exec(k.locator);if(d){k.label=CSL.LOCATOR_LABELS_MAP[d[2]];k.locator=d[3]}}}b=[e,k];a.push(b)}this.remapSectionVariable(a);if(a&&a.length>1&&this.citation_sort.tokens.length>0){f=a.length;for(h=0;h<f;h+=1){a[h][1].sortkeys=CSL.getSortKeys.call(this,a[h][0],"citation_sort")}a.sort(this.citation.srt.compareCompositeKeys)}this.tmp.citation_errors=[];this.parallel.StartCitation(a);g=CSL.getCitationCluster.call(this,a);return g};CSL.getAmbiguousCite=function(c,l,f){var h,k;var b=this.tmp.group_context.value().slice();if(l){this.tmp.disambig_request=l}else{this.tmp.disambig_request=false}var g={position:1};if(this.registry.registry[c.id]&&this.registry.citationreg.citationsByItemId&&this.registry.citationreg.citationsByItemId[c.id]&&this.registry.citationreg.citationsByItemId[c.id].length&&f){if(this.citation.opt["givenname-disambiguation-rule"]==="by-cite"){g["first-reference-note-number"]=this.registry.registry[c.id]["first-reference-note-number"]}}this.tmp.area="citation";h=this.parallel.use_parallels;this.parallel.use_parallels=false;this.tmp.suppress_decorations=true;this.tmp.just_looking=true;CSL.getCite.call(this,c,g);for(var e=0,a=this.output.queue.length;e<a;e+=1){CSL.Output.Queue.purgeEmptyBlobs(this.output.queue[e])}if(this.opt.development_extensions.clean_up_csl_flaws){for(var d=0,n=this.output.queue.length;d<n;d+=1){this.output.adjust.upward(this.output.queue[d]);this.output.adjust.leftward(this.output.queue[d]);this.output.adjust.downward(this.output.queue[d]);this.output.adjust.fix(this.output.queue[d])}}k=this.output.string(this,this.output.queue);this.tmp.just_looking=false;this.tmp.suppress_decorations=false;this.parallel.use_parallels=h;this.tmp.group_context.replace(b,"literal");return k};CSL.getSpliceDelimiter=function(b,c){if(b&&!this.tmp.have_collapsed&&"string"===typeof this.citation.opt["after-collapse-delimiter"]){this.tmp.splice_delimiter=this.citation.opt["after-collapse-delimiter"]}else{if(this.tmp.have_collapsed&&this.opt.xclass==="in-text"&&this.opt.update_mode!==CSL.NUMERIC){this.tmp.splice_delimiter=", "}else{if(this.tmp.use_cite_group_delimiter){this.tmp.splice_delimiter=this.citation.opt.cite_group_delimiter}else{if(this.tmp.cite_locales[c-1]){var a=this.tmp.cite_affixes[this.tmp.area][this.tmp.cite_locales[c-1]];if(a&&a.delimiter){this.tmp.splice_delimiter=a.delimiter}}}}}if(!this.tmp.splice_delimiter){this.tmp.splice_delimiter=""}return this.tmp.splice_delimiter};CSL.getCitationCluster=function(A,c){var t,R,W,s,E,C,k,b,n,L,o,p,x,M,D,d,a,q,h;this.tmp.last_primary_names_string=false;this.tmp.nestedBraces=false;q=CSL.getSafeEscape(this);this.tmp.area="citation";t="";R=[];this.tmp.last_suffix_used="";this.tmp.last_names_used=[];this.tmp.last_years_used=[];this.tmp.backref_index=[];this.tmp.cite_locales=[];var v=false;if(this.opt.xclass==="note"&&this.citation.opt.suppressTrailingPunctuation){v=true}if(c){if(this.registry.citationreg.citationById[c].properties["suppress-trailing-punctuation"]){v=true}}if(this.opt.xclass==="note"){var Q=[];var l=false;var g=false;var w=false;var P=[];for(var V=0,y=A.length;V<y;V+=1){var Y=A[V][0].type;var F=A[V][0].title;var O=A[V][1].position;var J=A[V][0].id;if(F&&Y==="legal_case"&&J!==w&&O){if(F!==l||Q.length===0){P=[];Q.push(P)}P.push(A[V][1])}l=F;g=O;w=J}for(V=0,y=Q.length;V<y;V+=1){P=Q[V];if(P.length<2){continue}var N=P.slice(-1)[0].locator;if(N){for(var T=0,U=P.length-1;T<U;T+=1){if(P[T].locator){N=false}}}if(N){P[0].locator=N;delete P.slice(-1)[0].locator;P[0].label=P.slice(-1)[0].label;if(P.slice(-1)[0].label){delete P.slice(-1)[0].label}}}}W=[];s=A.length;for(E=0;E<s;E+=1){x=A[E][0];C=A[E][1];k=this.tmp.have_collapsed;b={};if(E>0){CSL.getCite.call(this,x,C,""+A[(E-1)][0].id)}else{this.tmp.term_predecessor=false;CSL.getCite.call(this,x,C)}if(!this.tmp.cite_renders_content){h={citationID:""+this.tmp.citation_id,index:this.tmp.citation_pos,noteIndex:this.tmp.citation_note_index,itemID:""+x.id,citationItems_pos:E,error_code:CSL.ERROR_NO_RENDERED_FORM};this.tmp.citation_errors.push(h)}if(E===(A.length-1)){this.parallel.ComposeSet()}b.splice_delimiter=CSL.getSpliceDelimiter.call(this,k,E);if(C&&C["author-only"]){this.tmp.suppress_decorations=true}if(E>0){a=A[E-1][1];var X=a.suffix&&a.suffix.slice(-1)===".";var B=!a.suffix&&C.prefix&&C.prefix.slice(0,1)===".";if(X||B){var I=b.splice_delimiter.indexOf(" ");if(I>-1&&!B){b.splice_delimiter=b.splice_delimiter.slice(I)}else{b.splice_delimiter=""}}}b.suppress_decorations=this.tmp.suppress_decorations;b.have_collapsed=this.tmp.have_collapsed;W.push(b)}this.tmp.has_purged_parallel=false;this.parallel.PruneOutputQueue(this);n=0;p=this.output.queue.slice();var r={strings:{suffix:this.citation.opt.layout_suffix,delimiter:this.citation.opt.layout_delimiter}};var S=this.citation.opt.layout_suffix;var f=this.tmp.cite_locales[this.tmp.cite_locales.length-1];if(f&&this.tmp.cite_affixes[this.tmp.area][f]&&this.tmp.cite_affixes[this.tmp.area][f].suffix){S=this.tmp.cite_affixes[this.tmp.area][f].suffix}if(CSL.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(S.slice(0,1))>-1){S=S.slice(0,1)}var H=this.citation.opt.layout_delimiter;if(!H){H=""}if(CSL.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(H.slice(0,1))>-1){H=H.slice(0,1)}var K=S;for(var V=0,y=this.output.queue.length;V<y;V+=1){CSL.Output.Queue.purgeEmptyBlobs(this.output.queue[V])}if(!this.tmp.suppress_decorations&&this.output.queue.length){if(!(this.opt.development_extensions.apply_citation_wrapper&&this.sys.wrapCitationEntry&&!this.tmp.just_looking&&this.tmp.area==="citation")){if(!v){this.output.queue[this.output.queue.length-1].strings.suffix=K}this.output.queue[0].strings.prefix=this.citation.opt.layout_prefix}}if(this.opt.development_extensions.clean_up_csl_flaws){for(var T=0,U=this.output.queue.length;T<U;T+=1){this.output.adjust.upward(this.output.queue[T]);this.output.adjust.leftward(this.output.queue[T]);this.output.adjust.downward(this.output.queue[T]);this.tmp.last_chr=this.output.adjust.fix(this.output.queue[T])}}for(E=0,s=p.length;E<s;E+=1){this.output.queue=[p[E]];this.tmp.suppress_decorations=W[E].suppress_decorations;this.tmp.splice_delimiter=W[E].splice_delimiter;if(p[E].parallel_delimiter){this.tmp.splice_delimiter=p[E].parallel_delimiter}this.tmp.have_collapsed=W[E].have_collapsed;L=this.output.string(this,this.output.queue);this.tmp.suppress_decorations=false;if("string"===typeof L){this.tmp.suppress_decorations=false;return L}if("object"===typeof L&&L.length===0&&!C["suppress-author"]){if(this.tmp.has_purged_parallel){L.push("")}else{var e="[CSL STYLE ERROR: reference with no printed form.]";var u=E===0?q(this.citation.opt.layout_prefix):"";var z=E===(p.length-1)?q(this.citation.opt.layout_suffix):"";L.push(u+e+z)}}if(R.length&&"string"===typeof L[0]){L.reverse();var G=L.pop();if(G&&G.slice(0,1)===","){R.push(G)}else{if("string"==typeof R.slice(-1)[0]&&R.slice(-1)[0].slice(-1)===","){R.push(" "+G)}else{if(G){R.push(q(this.tmp.splice_delimiter)+G)}}}}else{L.reverse();o=L.pop();if("undefined"!==typeof o){if(R.length&&"string"===typeof R[R.length-1]){R[R.length-1]+=o.successor_prefix}R.push(o)}}M=L.length;for(D=0;D<M;D+=1){d=L[D];if("string"===typeof d){R.push(q(this.tmp.splice_delimiter)+d);continue}o=L.pop();if("undefined"!==typeof o){R.push(o)}}if(R.length===0&&!A[E][1]["suppress-author"]){n+=1}}t+=this.output.renderBlobs(R);if(t){this.output.nestedBraces=false;if(!this.tmp.suppress_decorations){s=this.citation.opt.layout_decorations.length;for(E=0;E<s;E+=1){b=this.citation.opt.layout_decorations[E];if(b[1]==="normal"){continue}t=this.fun.decorate[b[0]][b[1]](this,t)}}}this.tmp.suppress_decorations=false;return t};CSL.getCite=function(a,c,d){var b,e;this.tmp.cite_renders_content=false;this.parallel.StartCite(a,c,d);CSL.citeStart.call(this,a,c);b=0;this.nameOutput=new CSL.NameOutput(this,a,c);while(b<this[this.tmp.area].tokens.length){b=CSL.tokenExec.call(this,this[this.tmp.area].tokens[b],a,c)}CSL.citeEnd.call(this,a,c);this.parallel.CloseCite(this);if(!this.tmp.cite_renders_content&&!this.tmp.just_looking){if(this.tmp.area==="bibliography"){e={index:this.tmp.bibliography_pos,itemID:""+a.id,error_code:CSL.ERROR_NO_RENDERED_FORM};this.tmp.bibliography_errors.push(e)}}return""+a.id};CSL.citeStart=function(a,d){this.tmp.disambiguate_count=0;this.tmp.disambiguate_maxMax=0;this.tmp.same_author_as_previous_cite=false;if(!this.tmp.suppress_decorations){this.tmp.subsequent_author_substitute_ok=true}else{this.tmp.subsequent_author_substitute_ok=false}this.tmp.lastchr="";if(this.tmp.area==="citation"&&this.citation.opt.collapse&&this.citation.opt.collapse.length){this.tmp.have_collapsed=true}else{this.tmp.have_collapsed=false}this.tmp.render_seen=false;if(this.tmp.disambig_request&&!this.tmp.disambig_override){this.tmp.disambig_settings=this.tmp.disambig_request}else{if(this.registry.registry[a.id]&&!this.tmp.disambig_override){this.tmp.disambig_request=this.registry.registry[a.id].disambig;this.tmp.disambig_settings=this.registry.registry[a.id].disambig}else{this.tmp.disambig_settings=new CSL.AmbigConfig()}}if(this.tmp.area!=="citation"&&this.registry.registry[a.id]){this.tmp.disambig_restore=CSL.cloneAmbigConfig(this.registry.registry[a.id].disambig);if(this.tmp.area==="bibliography"&&this.tmp.disambig_settings&&this.tmp.disambig_override){if(this.opt["disambiguate-add-names"]){this.tmp.disambig_settings.names=this.registry.registry[a.id].disambig.names.slice();this.tmp.disambig_request.names=this.registry.registry[a.id].disambig.names.slice()}if(this.opt["disambiguate-add-givenname"]){this.tmp.disambig_request=this.tmp.disambig_settings;this.tmp.disambig_settings.givens=this.registry.registry[a.id].disambig.givens.slice();this.tmp.disambig_request.givens=this.registry.registry[a.id].disambig.givens.slice();for(var c=0,b=this.tmp.disambig_settings.givens.length;c<b;c+=1){this.tmp.disambig_settings.givens[c]=this.registry.registry[a.id].disambig.givens[c].slice()}for(var c=0,b=this.tmp.disambig_request.givens.length;c<b;c+=1){this.tmp.disambig_request.givens[c]=this.registry.registry[a.id].disambig.givens[c].slice()}}}}this.tmp.names_used=[];this.tmp.nameset_counter=0;this.tmp.years_used=[];this.tmp.names_max.clear();this.tmp.splice_delimiter=this[this.tmp.area].opt.layout_delimiter;this.bibliography_sort.keys=[];this.citation_sort.keys=[];this.tmp.has_done_year_suffix=false;this.tmp.last_cite_locale=false;if(!this.tmp.just_looking&&d&&!d.position&&this.registry.registry[a.id]){this.tmp.disambig_restore=CSL.cloneAmbigConfig(this.registry.registry[a.id].disambig)}this.tmp.shadow_numbers={};this.setNumberLabels(a);this.tmp.first_name_string=false;if(this.opt.development_extensions.flip_parentheses_to_braces&&d&&d.prefix){var e=CSL.checkNestedBraceOpen.exec(d.prefix);var f=CSL.checkNestedBraceClose.exec(d.prefix);if(e){if(!f){this.output.nestedBraces=CSL.NestedBraces}else{if(f[0].length<e[0].length){this.output.nestedBraces=CSL.NestedBraces}else{this.output.nestedBraces=false}}}else{if(f){this.output.nestedBraces=false}}}};CSL.citeEnd=function(b,e){if(this.tmp.disambig_restore){this.registry.registry[b.id].disambig.names=this.tmp.disambig_restore.names.slice();this.registry.registry[b.id].disambig.givens=this.tmp.disambig_restore.givens.slice();for(var d=0,c=this.registry.registry[b.id].disambig.givens.length;d<c;d+=1){this.registry.registry[b.id].disambig.givens[d]=this.tmp.disambig_restore.givens[d].slice()}}this.tmp.disambig_restore=false;if(e&&e.suffix){this.tmp.last_suffix_used=e.suffix}else{this.tmp.last_suffix_used=""}this.tmp.last_years_used=this.tmp.years_used.slice();this.tmp.last_names_used=this.tmp.names_used.slice();this.tmp.cut_var=false;this.tmp.disambig_request=false;this.tmp.cite_locales.push(this.tmp.last_cite_locale);if(this.tmp.issued_date&&this.tmp.renders_collection_number){var a=[];for(var d=this.tmp.issued_date.list.length-1;d>this.tmp.issued_date.pos;d+=-1){a.push(this.tmp.issued_date.list.pop())}this.tmp.issued_date.list.pop();for(d=a.length-1;d>-1;d+=-1){this.tmp.issued_date.list.push(a.pop())}if(this.parallel.use_parallels){this.parallel.cite.issued=false}}this.tmp.issued_date=false;this.tmp.renders_collection_number=false;if(this.opt.development_extensions.flip_parentheses_to_braces&&e&&e.suffix){var f=CSL.checkNestedBraceOpen.exec(e.suffix);var g=CSL.checkNestedBraceClose.exec(e.suffix);if(g){if(!f){this.output.nestedBraces=false}else{if(f[0].length<g[0].length){this.output.nestedBraces=false}else{this.output.nestedBraces=CSL.NestedBraces}}}else{if(f){this.output.nestedBraces=CSL.NestedBraces}}}};CSL.Engine.prototype.makeBibliography=function(b){var a,k,d,e,o,j,l,n,q,c,g,h,p;a=false;if(!this.bibliography.tokens.length){return false}if("string"===typeof b){this.opt.citation_number_slug=b;b=false}k=CSL.getBibliographyEntries.call(this,b);g=k[0];h=k[1];var f=k[2];d={maxoffset:0,entryspacing:this.bibliography.opt["entry-spacing"],linespacing:this.bibliography.opt["line-spacing"],"second-field-align":false,entry_ids:g,bibliography_errors:this.tmp.bibliography_errors.slice(),done:f};if(this.bibliography.opt["second-field-align"]){d["second-field-align"]=this.bibliography.opt["second-field-align"]}e=0;j=this.registry.reflist.length;for(l=0;l<j;l+=1){o=this.registry.reflist[l];if(o.offset>d.maxoffset){d.maxoffset=o.offset}}if(this.bibliography.opt.hangingindent){d.hangingindent=this.bibliography.opt.hangingindent}d.bibstart=this.fun.decorate.bibstart;d.bibend=this.fun.decorate.bibend;this.opt.citation_number_slug=false;return[d,h]};CSL.getBibliographyEntries=function(g){var E,b,a,r,J,L,F,o,D,y,I,z,l,f,U,A,G,e,q,s,x,P,t,K,w,V,W,p,B,O,Q,d,T;E=[];B=[];this.tmp.area="bibliography";this.tmp.last_rendered_name=false;this.tmp.bibliography_errors=[];this.tmp.bibliography_pos=0;if(g&&g.page_start&&g.page_length){b=this.registry.getSortedIds()}else{b=this.retrieveItems(this.registry.getSortedIds())}this.tmp.disambig_override=true;function R(k,j){if(k===j){return true}return false}function H(k,j){f=j.length;for(U=0;U<f;U+=1){if(R(k,j[U])){return true}}return false}function u(k,j){if((k==="none"||!k)&&!j){return true}if("string"===typeof j){return R(k,j)}else{if(!j){return false}else{return H(k,j)}}}w={};var C;if(g&&g.page_start&&g.page_length){C=0;if(g.page_start!==true){for(P=0,t=b.length;P<t;P+=1){w[b[P]]=true;if(g.page_start==b[P]){break}}}}var v=[];for(P=0,t=b.length;P<t;P+=1){if(g&&g.page_start&&g.page_length){if(w[b[P]]){continue}y=this.retrieveItem(b[P]);if(C===g.page_length){break}}else{y=b[P];if(w[y.id]){continue}}if(g){a=true;if(g.include){a=false;for(O=0,Q=g.include.length;O<Q;O+=1){l=g.include[O];if(u(l.value,y[l.field])){a=true;break}}}else{if(g.exclude){r=false;for(O=0,Q=g.exclude.length;O<Q;O+=1){l=g.exclude[O];if(u(l.value,y[l.field])){r=true;break}}if(r){a=false}}else{if(g.select){a=false;J=true;for(O=0,Q=g.select.length;O<Q;O+=1){l=g.select[O];if(!u(l.value,y[l.field])){J=false}}if(J){a=true}}}}if(g.quash){J=true;for(O=0,Q=g.quash.length;O<Q;O+=1){l=g.quash[O];if(!u(l.value,y[l.field])){J=false}}if(J){a=false}}if(!a){continue}}L=new CSL.Token("group",CSL.START);L.decorations=[["@bibliography","entry"]].concat(this.bibliography.opt.layout_decorations);this.output.startTag("bib_entry",L);if(y.system_id&&this.sys.embedBibliographyEntry){this.output.current.value().item_id=y.system_id}else{this.output.current.value().system_id=y.id}V=[[{id:""+y.id},y]];q=[];if(this.registry.registry[y.id].master&&!(g&&g.page_start&&g.page_length)){x=true;this.parallel.StartCitation(V);this.output.queue[0].strings.delimiter=", ";this.tmp.term_predecessor=false;q.push(""+CSL.getCite.call(this,y));w[y.id]=true;K=this.registry.registry[y.id].siblings;for(O=0,Q=K.length;O<Q;O+=1){var N=this.registry.registry[y.id].siblings[O];W=this.retrieveItem(N);q.push(""+CSL.getCite.call(this,W));w[W.id]=true}this.parallel.ComposeSet();this.parallel.PruneOutputQueue()}else{if(!this.registry.registry[y.id].siblings){this.parallel.StartCitation(V);this.tmp.term_predecessor=false;q.push(""+CSL.getCite.call(this,y));if(g&&g.page_start&&g.page_length){C+=1}}}B.push("");this.tmp.bibliography_pos+=1;v.push(q);this.output.endTag("bib_entry");if(this.output.queue[0].blobs.length&&this.output.queue[0].blobs[0].blobs.length){if(x||!this.output.queue[0].blobs[0].blobs[0].strings){G=this.output.queue[0].blobs;x=false}else{G=this.output.queue[0].blobs[0].blobs}for(O=G.length-1;O>-1;O+=-1){if(G[O].blobs&&G[O].blobs.length!==0){var c=this.tmp.cite_locales[this.tmp.cite_locales.length-1];var M;if(this.tmp.cite_affixes[this.tmp.area][c]){M=this.tmp.cite_affixes[this.tmp.area][c].suffix}else{M=this.bibliography.opt.layout_suffix}p=M.slice(0,1);if(p&&G[O].strings.suffix.slice(-1)===p){G[O].strings.suffix=G[O].strings.suffix.slice(0,-1)}G[O].strings.suffix+=M;break}}G[0].strings.prefix=this.bibliography.opt.layout_prefix+G[0].strings.prefix}for(var O=0,Q=this.output.queue.length;O<Q;O+=1){CSL.Output.Queue.purgeEmptyBlobs(this.output.queue[O])}for(var O=0,Q=this.output.queue.length;O<Q;O+=1){this.output.adjust.upward(this.output.queue[O]);this.output.adjust.leftward(this.output.queue[O]);this.output.adjust.downward(this.output.queue[O],true);this.output.adjust.fix(this.output.queue[O])}F=this.output.string(this,this.output.queue)[0];if(!F){F="\n[CSL STYLE ERROR: reference with no printed form.]\n"}E.push(F)}var h=false;if(g&&g.page_start&&g.page_length){var n=b.slice(-1)[0];var S=v.slice(-1)[0];if(!n||!S||n==S){h=true}}this.tmp.disambig_override=false;return[v,E,h]};CSL.Engine.prototype.setCitationId=function(b,c){var a,e,d;a=false;if(!b.citationID||c){e=Math.floor(Math.random()*100000000000000);while(true){d=0;if(!this.registry.citationreg.citationById[e]){b.citationID=e.toString(32);break}else{if(!d&&e<50000000000000){d=1}else{d=-1}}if(d===1){e+=1}else{e+=-1}}a=""+e}this.registry.citationreg.citationById[b.citationID]=b;return a};CSL.Engine.prototype.rebuildProcessorState=function(b,h,q){if(!b){b=[]}if(!h){h="html"}var k={};var g=[];for(var f=0,c=b.length;f<c;f+=1){for(var e=0,s=b[f].citationItems.length;e<s;e+=1){var a=""+b[f].citationItems[e].id;if(!k[a]){g.push(a)}k[a]=true}}this.updateItems(g);var d=[];var r=[];var o=[];var n=this.opt.mode;this.setOutputFormat(h);for(var f=0,c=b.length;f<c;f+=1){var p=this.processCitationCluster(b[f],d,r,CSL.ASSUME_ALL_ITEMS_REGISTERED);d.push([b[f].citationID,b[f].properties.noteIndex]);for(var e=0,s=p[1].length;e<s;e+=1){var l=p[1][e][0];o[l]=[d[l][0],d[l][1],p[1][e][1]]}}this.updateUncitedItems(q);this.setOutputFormat(n);return o};CSL.Engine.prototype.restoreProcessorState=function(a){var h,c,g,p,q,e,b,d,k,n;d=[];k=[];if(!a){a=[]}var o=[];var r={};for(h=0,c=a.length;h<c;h+=1){if(r[a[h].citationID]){this.setCitationId(a[h],true)}r[a[h].citationID]=true;o.push(a[h].properties.index)}var f=a.slice();f.sort(function(s,j){if(s.properties.index<j.properties.index){return -1}else{if(s.properties.index>j.properties.index){return 1}else{return 0}}});for(h=0,c=f.length;h<c;h+=1){f[h].properties.index=h}for(h=0,c=f.length;h<c;h+=1){n=[];for(g=0,p=f[h].citationItems.length;g<p;g+=1){q=f[h].citationItems[g];if("undefined"===typeof q.sortkeys){q.sortkeys=[]}e=this.retrieveItem(""+q.id);b=[e,q];n.push(b);f[h].citationItems[g].item=e;k.push(""+q.id)}if(!f[h].properties.unsorted){n.sort(this.citation.srt.compareCompositeKeys)}f[h].sortedItems=n;this.registry.citationreg.citationById[f[h].citationID]=f[h]}this.updateItems(k);for(h=0,c=a.length;h<c;h+=1){d.push([""+a[h].citationID,a[h].properties.noteIndex])}var l=[];if(a&&a.length){l=this.processCitationCluster(a[0],[],d.slice(1))}else{this.registry=new CSL.Registry(this);this.tmp=new CSL.Engine.Tmp();this.disambiguate=new CSL.Disambiguation(this)}return l};CSL.Engine.prototype.updateItems=function(e,a,d){var c=false;var f=this.tmp.area;this.registry.init(e);if(d){for(var b in this.registry.ambigcites){this.registry.ambigsTouched[b]=true}}this.registry.dodeletes(this.registry.myhash);this.registry.doinserts(this.registry.mylist);this.registry.dorefreshes();this.registry.rebuildlist();this.registry.setsortkeys();this.registry.setdisambigs();if(!a){this.registry.sorttokens()}this.registry.renumber();this.tmp.area=f;return this.registry.getSortedIds()};CSL.Engine.prototype.updateUncitedItems=function(f,a){var b=false;if(!f){f=[]}if("object"==typeof f){if("undefined"==typeof f.length){var g=f;f=[];for(var e in g){f.push(e)}}else{if("number"==typeof f.length){var g={};for(var d=0,c=f.length;d<c;d+=1){g[f[d]]=true}}}}this.registry.init(f,true);this.registry.dopurge(g);this.registry.doinserts(this.registry.mylist);this.registry.dorefreshes();this.registry.rebuildlist();this.registry.setsortkeys();this.registry.setdisambigs();if(!a){this.registry.sorttokens()}this.registry.renumber();return this.registry.getSortedIds()};CSL.localeResolve=function(c,b){var a,d;if(!b){b="en-US"}if(!c){c=b}a={};d=c.split(/[\-_]/);a.base=CSL.LANG_BASES[d[0]];if("undefined"===typeof a.base){CSL.debug("Warning: unknown locale "+c+", setting fallback to "+b);return{base:b,best:c,bare:d[0]}}if(d.length===1){a.generic=true}if(d.length===1||d[1]==="x"){a.best=a.base.replace("_","-")}else{a.best=d.slice(0,2).join("-")}a.base=a.base.replace("_","-");a.bare=d[0];return a};CSL.Engine.prototype.localeConfigure=function(g,e){var h;if(this.opt.development_extensions.normalize_lang_keys_to_lowercase){g.best=g.best.toLowerCase();g.bare=g.bare.toLowerCase();g.base=g.base.toLowerCase()}if(e&&this.locale[g.best]){return}h=this.sys.xml.makeXml(this.sys.retrieveLocale("en-US"));this.localeSet(h,"en-US",g.best);if(g.best!=="en-US"){if(g.base!==g.best){h=this.sys.xml.makeXml(this.sys.retrieveLocale(g.base));this.localeSet(h,g.base,g.best)}h=this.sys.xml.makeXml(this.sys.retrieveLocale(g.best));this.localeSet(h,g.best,g.best)}this.localeSet(this.cslXml,"",g.best);this.localeSet(this.cslXml,g.bare,g.best);if(g.base!==g.best){this.localeSet(this.cslXml,g.base,g.best)}this.localeSet(this.cslXml,g.best,g.best);if("undefined"===typeof this.locale[g.best].terms["page-range-delimiter"]){if(["fr","pt"].indexOf(g.best.slice(0,2).toLowerCase())>-1){this.locale[g.best].terms["page-range-delimiter"]="-"}else{this.locale[g.best].terms["page-range-delimiter"]="\u2013"}}if("undefined"===typeof this.locale[g.best].terms["year-range-delimiter"]){this.locale[g.best].terms["year-range-delimiter"]="\u2013"}if("undefined"===typeof this.locale[g.best].terms["citation-range-delimiter"]){this.locale[g.best].terms["citation-range-delimiter"]="\u2013"}if(this.opt.development_extensions.normalize_lang_keys_to_lowercase){var f=["default-locale","locale-sort","locale-translit","locale-translat"];for(var d=0,c=f.length;d<c;d+=1){for(var b=0,a=this.opt[f[d]].length;b<a;b+=1){this.opt[f[d]][b]=this.opt[f[d]][b].toLowerCase()}}this.opt.lang=this.opt.lang.toLowerCase()}};CSL.Engine.prototype.localeSet=function(h,c,b){var q,p,B,C,x,u,v,z,y,N,k,I,E,n,F,a,H,s;c=c.replace("_","-");b=b.replace("_","-");if(this.opt.development_extensions.normalize_lang_keys_to_lowercase){c=c.toLowerCase();b=b.toLowerCase()}if(!this.locale[b]){this.locale[b]={};this.locale[b].terms={};this.locale[b].opts={};this.locale[b].opts["skip-words"]=CSL.SKIP_WORDS;if(!this.locale[b].opts["leading-noise-words"]){this.locale[b].opts["leading-noise-words"]=[]}this.locale[b].dates={};this.locale[b].ord={"1.0.1":false,keys:{}};this.locale[b]["noun-genders"]={}}p=this.sys.xml.makeXml();if(this.sys.xml.nodeNameIs(h,"locale")){p=h}else{B=this.sys.xml.getNodesByName(h,"locale");for(x=0,n=this.sys.xml.numberofnodes(B);x<n;x+=1){q=B[x];if(this.sys.xml.getAttributeValue(q,"lang","xml")===c){p=q;break}}}B=this.sys.xml.getNodesByName(p,"type");for(H=0,s=this.sys.xml.numberofnodes(B);H<s;H+=1){var e=B[H];var O=this.sys.xml.getAttributeValue(e,"name");var K=this.sys.xml.getAttributeValue(e,"gender");this.opt.gender[O]=K}var j=this.sys.xml.getNodesByName(p,"term","ordinal").length;if(j){for(var l in this.locale[b].ord.keys){delete this.locale[b].terms[l]}this.locale[b].ord={"1.0.1":false,keys:{}}}B=this.sys.xml.getNodesByName(p,"term");var d={"last-digit":{},"last-two-digits":{},"whole-number":{}};var A=false;var M={};for(x=0,n=this.sys.xml.numberofnodes(B);x<n;x+=1){v=B[x];y=this.sys.xml.getAttributeValue(v,"name");if(y==="sub verbo"){y="sub-verbo"}if(y.slice(0,7)==="ordinal"){var w=this.sys.xml.getNodeValue(v);if(y==="ordinal"){A=true}else{var g=this.sys.xml.getAttributeValue(v,"match");var J=y.slice(8);var F=this.sys.xml.getAttributeValue(v,"gender-form");if(!F){F="neuter"}if(!g){g="last-two-digits";if(J.slice(0,1)==="0"){g="last-digit"}}if(J.slice(0,1)==="0"){J=J.slice(1)}if(!d[g][J]){d[g][J]={}}d[g][J][F]=y}this.locale[b].ord.keys[y]=true}if("undefined"===typeof this.locale[b].terms[y]){this.locale[b].terms[y]={}}z="long";F=false;if(this.sys.xml.getAttributeValue(v,"form")){z=this.sys.xml.getAttributeValue(v,"form")}if(this.sys.xml.getAttributeValue(v,"gender-form")){F=this.sys.xml.getAttributeValue(v,"gender-form")}if(this.sys.xml.getAttributeValue(v,"gender")){this.locale[b]["noun-genders"][y]=this.sys.xml.getAttributeValue(v,"gender")}if(F){this.locale[b].terms[y][F]={};this.locale[b].terms[y][F][z]=[];a=this.locale[b].terms[y][F];M[y]=true}else{this.locale[b].terms[y][z]=[];a=this.locale[b].terms[y]}if(this.sys.xml.numberofnodes(this.sys.xml.getNodesByName(v,"multiple"))){a[z][0]=this.sys.xml.getNodeValue(v,"single");a[z][1]=this.sys.xml.getNodeValue(v,"multiple")}else{a[z]=this.sys.xml.getNodeValue(v)}}if(A){for(var r in M){var f={};var o=0;for(var G in this.locale[b].terms[r]){if(["masculine","feminine"].indexOf(G)>-1){f[G]=this.locale[b].terms[r][G]}else{o+=1}}if(!o){if(f.feminine){for(var G in f.feminine){this.locale[b].terms[r][G]=f.feminine[G]}}else{if(f.masculine){for(var G in f.masculine){this.locale[b].terms[r][G]=f.masculine[G]}}}}}this.locale[b].ord["1.0.1"]=d}for(y in this.locale[b].terms){for(H=0,s=2;H<s;H+=1){F=CSL.GENDERS[H];if(this.locale[b].terms[y][F]){for(z in this.locale[b].terms[y]){if(!this.locale[b].terms[y][F][z]){this.locale[b].terms[y][F][z]=this.locale[b].terms[y][z]}}}}}B=this.sys.xml.getNodesByName(p,"style-options");for(x=0,n=this.sys.xml.numberofnodes(B);x<n;x+=1){if(true){N=B[x];C=this.sys.xml.attributes(N);for(E in C){if(C.hasOwnProperty(E)){if(E==="@punctuation-in-quote"||E==="@limit-day-ordinals-to-day-1"){if(C[E]==="true"){this.locale[b].opts[E.slice(1)]=true}else{this.locale[b].opts[E.slice(1)]=false}}else{if(E==="@skip-words"){var L=C[E].split(/\s*,\s*/);this.locale[b].opts[E.slice(1)]=L}else{if(E==="@leading-noise-words"&&c===b){var t=C[E].split(/\s*,\s*/);this.locale[b].opts["leading-noise-words"]=t}else{if(E==="@name-as-sort-order"){this.locale[b].opts["name-as-sort-order"]={};var D=C[E].split(/\s+/);for(var H=0,s=D.length;H<s;H+=1){this.locale[b].opts["name-as-sort-order"][D[H]]=true}}else{if(E==="@name-as-reverse-order"){this.locale[b].opts["name-as-reverse-order"]={};var D=C[E].split(/\s+/);for(var H=0,s=D.length;H<s;H+=1){this.locale[b].opts["name-as-reverse-order"][D[H]]=true}}else{if(E==="@name-never-short"){this.locale[b].opts["name-never-short"]={};var D=C[E].split(/\s+/);for(var H=0,s=D.length;H<s;H+=1){this.locale[b].opts["name-never-short"][D[H]]=true}}}}}}}}}}}B=this.sys.xml.getNodesByName(p,"date");for(x=0,n=this.sys.xml.numberofnodes(B);x<n;x+=1){if(true){I=B[x];this.locale[b].dates[this.sys.xml.getAttributeValue(I,"form")]=I}}};CSL.Node={};CSL.Node.bibliography={build:function(a,b){if(this.tokentype===CSL.START){a.build.area="bibliography";a.build.root="bibliography";a.fixOpt(this,"names-delimiter","delimiter");a.fixOpt(this,"name-delimiter","delimiter");a.fixOpt(this,"name-form","form");a.fixOpt(this,"and","and");a.fixOpt(this,"delimiter-precedes-last","delimiter-precedes-last");a.fixOpt(this,"delimiter-precedes-et-al","delimiter-precedes-et-al");a.fixOpt(this,"initialize-with","initialize-with");a.fixOpt(this,"initialize","initialize");a.fixOpt(this,"name-as-sort-order","name-as-sort-order");a.fixOpt(this,"sort-separator","sort-separator");a.fixOpt(this,"and","and");a.fixOpt(this,"et-al-min","et-al-min");a.fixOpt(this,"et-al-use-first","et-al-use-first");a.fixOpt(this,"et-al-use-last","et-al-use-last");a.fixOpt(this,"et-al-subsequent-min","et-al-subsequent-min");a.fixOpt(this,"et-al-subsequent-use-first","et-al-subsequent-use-first")}b.push(this)}};CSL.Node.choose={build:function(b,c){var a;if(this.tokentype===CSL.START){a=function(e,d){e.tmp.jump.push(undefined,CSL.LITERAL)}}if(this.tokentype===CSL.END){a=function(e,d){e.tmp.jump.pop()}}this.execs.push(a);c.push(this)},configure:function(a,b){if(this.tokentype===CSL.END){a.configure.fail.push((b));a.configure.succeed.push((b))}else{a.configure.fail.pop();a.configure.succeed.pop()}}};CSL.Node.citation={build:function(a,c){if(this.tokentype===CSL.START){a.fixOpt(this,"names-delimiter","delimiter");a.fixOpt(this,"name-delimiter","delimiter");a.fixOpt(this,"name-form","form");a.fixOpt(this,"and","and");a.fixOpt(this,"delimiter-precedes-last","delimiter-precedes-last");a.fixOpt(this,"delimiter-precedes-et-al","delimiter-precedes-et-al");a.fixOpt(this,"initialize-with","initialize-with");a.fixOpt(this,"initialize","initialize");a.fixOpt(this,"name-as-sort-order","name-as-sort-order");a.fixOpt(this,"sort-separator","sort-separator");a.fixOpt(this,"and","and");a.fixOpt(this,"et-al-min","et-al-min");a.fixOpt(this,"et-al-use-first","et-al-use-first");a.fixOpt(this,"et-al-use-last","et-al-use-last");a.fixOpt(this,"et-al-subsequent-min","et-al-subsequent-min");a.fixOpt(this,"et-al-subsequent-use-first","et-al-subsequent-use-first");a.build.area="citation"}if(this.tokentype===CSL.END){a.opt.grouped_sort=a.opt.xclass==="in-text"&&(a.citation.opt.collapse&&a.citation.opt.collapse.length)||(a.citation.opt.cite_group_delimiter&&a.citation.opt.cite_group_delimiter.length)&&a.opt.update_mode!==CSL.POSITION&&a.opt.update_mode!==CSL.NUMERIC;if(a.opt.grouped_sort&&a.citation_sort.opt.sort_directions.length){var b=a.citation_sort.opt.sort_directions[0].slice();a.citation_sort.opt.sort_directions=[b].concat(a.citation_sort.opt.sort_directions)}a.citation.srt=new CSL.Registry.Comparifier(a,"citation_sort")}}};CSL.Node["#comment"]={build:function(a,b){}};CSL.Node.date={build:function(b,k){var e,a,o,j,n,d,h,g,l,c,f;if(this.tokentype===CSL.START||this.tokentype===CSL.SINGLETON){b.build.date_parts=[];b.build.date_variables=this.variables;if(!b.build.extension){CSL.Util.substituteStart.call(this,b,k)}if(b.build.extension){e=CSL.dateMacroAsSortKey}else{e=function(s,p,r){var q,t;s.tmp.element_rendered_ok=false;s.tmp.donesies=[];s.tmp.dateparts=[];t=[];if(this.variables.length&&!(s.tmp.just_looking&&this.variables[0]!=="issued")){s.parallel.StartVariable(this.variables[0]);a=p[this.variables[0]];if("undefined"===typeof a){a={"date-parts":[[0]]};if(s.opt.development_extensions.locator_date_and_revision){if(r&&this.variables[0]==="locator-date"&&r["locator-date"]){a=r["locator-date"]}}}s.tmp.date_object=a;j=this.dateparts.length;for(n=0;n<j;n+=1){d=this.dateparts[n];if("undefined"!==typeof s.tmp.date_object[(d+"_end")]){t.push(d)}else{if(d==="month"&&"undefined"!==typeof s.tmp.date_object.season_end){t.push(d)}}}h=[];g=["year","month","day"];j=g.length;for(n=0;n<j;n+=1){if(t.indexOf(g[n])>-1){h.push(g[n])}}t=h.slice();l=2;j=t.length;for(n=0;n<j;n+=1){d=t[n];c=s.tmp.date_object[d];f=s.tmp.date_object[(d+"_end")];if(c!==f){l=n;break}}s.tmp.date_collapse_at=t.slice(l)}else{s.tmp.date_object=false}}}this.execs.push(e);e=function(s,q){s.output.startTag("date",this);if(this.variables[0]==="issued"&&q.type==="legal_case"&&!s.tmp.extension&&""+q["collection-number"]===""+s.tmp.date_object.year&&this.dateparts.length===1&&this.dateparts[0]==="year"){for(var r in s.tmp.date_object){if(s.tmp.date_object.hasOwnProperty(r)){if(r.slice(0,4)==="year"){s.tmp.issued_date={};var p=s.output.current.mystack.slice(-2)[0].blobs;s.tmp.issued_date.list=p;s.tmp.issued_date.pos=p.length-1}}}}};this.execs.push(e)}if(!b.build.extension&&(this.tokentype===CSL.END||this.tokentype===CSL.SINGLETON)){e=function(q,p){q.output.endTag();q.parallel.CloseVariable("date")};this.execs.push(e)}k.push(this);if(this.tokentype===CSL.END||this.tokentype===CSL.SINGLETON){if(!b.build.extension){CSL.Util.substituteEnd.call(this,b,k)}}}};CSL.Node["date-part"]={build:function(e,D){var g,h,x,B,a,t,w,q,r,c,s,b,f,C,l,A,o,y,p,d,j,v,z,u,n;if(!this.strings.form){this.strings.form="long"}e.build.date_parts.push(this.strings.name);var k=e.build.date_variables[0];g=function(I,E){if(!I.tmp.date_object){return}a=true;t="";w="";I.tmp.donesies.push(this.strings.name);if(I.tmp.date_object.literal&&"year"===this.strings.name){I.parallel.AppendToVariable(I.tmp.date_object.literal);I.output.append(I.tmp.date_object.literal,this)}if(I.tmp.date_object){t=I.tmp.date_object[this.strings.name];w=I.tmp.date_object[(this.strings.name+"_end")]}if("year"===this.strings.name&&t===0&&!I.tmp.suppress_decorations){t=false}q=!I.tmp.suppress_decorations;r=I.tmp.have_collapsed;c=I[I.tmp.area].opt.collapse==="year-suffix"||I[I.tmp.area].opt.collapse==="year-suffix-ranged";s=I.opt["disambiguate-add-year-suffix"];if(q&&s&&c){I.tmp.years_used.push(t);b=I.tmp.last_years_used.length>=I.tmp.years_used.length;if(b&&r){if(I.tmp.last_years_used[(I.tmp.years_used.length-1)]===t){t=false}}}if("undefined"!==typeof t){f=false;C=false;l=false;A=false;if("year"===this.strings.name){if(parseInt(t,10)<500&&parseInt(t,10)>0){C=I.getTerm("ad")}if(parseInt(t,10)<0){f=I.getTerm("bc");t=(parseInt(t,10)*-1)}if(w){if(parseInt(w,10)<500&&parseInt(w,10)>0){A=I.getTerm("ad")}if(parseInt(w,10)<0){l=I.getTerm("bc");w=(parseInt(w,10)*-1)}}}I.parallel.AppendToVariable(t);var H=""+I.tmp.date_object.month;while(H.length<2){H="0"+H}H="month-"+H;var G=I.locale[I.opt.lang]["noun-genders"][H];if(this.strings.form){var J=this.strings.form;if(this.strings.name==="day"){if(J==="ordinal"&&I.locale[I.opt.lang].opts["limit-day-ordinals-to-day-1"]&&(""+t)!=="1"){J="numeric"}}t=CSL.Util.Dates[this.strings.name][J](I,t,G,("accessed"===k));if("month"===this.strings.name){if(I.tmp.strip_periods){t=t.replace(/\./g,"")}else{for(u=0,n=this.decorations.length;u<n;u+=1){if("@strip-periods"===this.decorations[u][0]&&"true"===this.decorations[u][1]){t=t.replace(/\./g,"");break}}}}if(w){w=CSL.Util.Dates[this.strings.name][J](I,w,G,("accessed"===k),"_end");if(I.tmp.strip_periods){w=w.replace(/\./g,"")}else{for(u=0,n=this.decorations.length;u<n;u+=1){if("@strip-periods"===this.decorations[u][0]&&"true"===this.decorations[u][1]){w=w.replace(/\./g,"");break}}}}}I.output.openLevel("empty");if(I.tmp.date_collapse_at.length){o=true;x=I.tmp.date_collapse_at.length;for(h=0;h<x;h+=1){z=I.tmp.date_collapse_at[h];if(I.tmp.donesies.indexOf(z)===-1){o=false;break}}if(o){if(""+w!=="0"){if(I.dateput.queue.length===0){a=true}if(I.opt["year-range-format"]&&I.opt["year-range-format"]!=="expanded"&&!I.tmp.date_object.day&&!I.tmp.date_object.month&&!I.tmp.date_object.season&&this.strings.name==="year"&&t&&w){w=I.fun.year_mangler(t+"-"+w,true);var F=I.getTerm("year-range-delimiter");w=w.slice(w.indexOf(F)+1)}I.dateput.append(w,this);if(a){I.dateput.current.value()[0].strings.prefix=""}}I.output.append(t,this);y=I.output.current.value();y.blobs[(y.blobs.length-1)].strings.suffix="";I.output.append(I.getTerm("year-range-delimiter"),"empty");p=I.dateput.current.value();y.blobs=y.blobs.concat(p);I.dateput.string(I,I.dateput.queue);I.tmp.date_collapse_at=[]}else{I.output.append(t,this);if(I.tmp.date_collapse_at.indexOf(this.strings.name)>-1){if(""+w!=="0"){if(I.dateput.queue.length===0){a=true}I.dateput.openLevel("empty");I.dateput.append(w,this);if(a){I.dateput.current.value().blobs[0].strings.prefix=""}if(f){I.dateput.append(f)}if(C){I.dateput.append(C)}I.dateput.closeLevel()}}}}else{I.output.append(t,this)}if(f){I.output.append(f)}if(C){I.output.append(C)}I.output.closeLevel()}else{if("month"===this.strings.name){if(I.tmp.date_object.season){t=""+I.tmp.date_object.season;if(t&&t.match(/^[1-4]$/)){I.tmp.group_context.replace([false,false,true]);I.output.append(I.getTerm(("season-0"+t)),this)}else{if(t){I.output.append(t,this)}}}}}I.tmp.value=[];if((t||I.tmp.have_collapsed)&&!I.opt.has_year_suffix&&"year"===this.strings.name&&!I.tmp.just_looking){if(I.registry.registry[E.id]&&I.registry.registry[E.id].disambig.year_suffix!==false&&!I.tmp.has_done_year_suffix){I.tmp.has_done_year_suffix=true;j=parseInt(I.registry.registry[E.id].disambig.year_suffix,10);d=new CSL.NumericBlob(j,this,E.id);this.successor_prefix=I[I.build.area].opt.layout_delimiter;this.splice_prefix=I[I.build.area].opt.layout_delimiter;v=new CSL.Util.Suffixator(CSL.SUFFIX_CHARS);d.setFormatter(v);if(I[I.tmp.area].opt.collapse==="year-suffix-ranged"){d.range_prefix=I.getTerm("citation-range-delimiter")}if(I[I.tmp.area].opt["year-suffix-delimiter"]){d.successor_prefix=I[I.tmp.area].opt["year-suffix-delimiter"]}else{d.successor_prefix=I[I.tmp.area].opt.layout_delimiter}d.UGLY_DELIMITER_SUPPRESS_HACK=true;I.output.append(d,"literal")}}};this.execs.push(g);D.push(this)}};CSL.Node["else-if"]={build:function(a,b){CSL.Conditions.TopNode.call(this,a,b);b.push(this)},configure:function(a,b){CSL.Conditions.Configure.call(this,a,b)}};CSL.Node["else"]={build:function(a,b){b.push(this)},configure:function(a,b){if(this.tokentype===CSL.START){a.configure.fail[(a.configure.fail.length-1)]=b}}};CSL.Node["et-al"]={build:function(b,c){if(b.build.area==="citation"||b.build.area==="bibliography"){var a=function(f,d,e){f.tmp.etal_node=this;if("string"===typeof this.strings.term){f.tmp.etal_term=this.strings.term}};this.execs.push(a)}c.push(this)}};CSL.Node.group={build:function(c,d){var b,a;if(this.tokentype===CSL.START){CSL.Util.substituteStart.call(this,c,d);if(c.build.substitute_level.value()){c.build.substitute_level.replace((c.build.substitute_level.value()+1))}b=function(g,e){g.output.startTag("group",this);if(g.tmp.group_context.mystack.length){g.output.current.value().parent=g.tmp.group_context.value()[4]}var f=g.tmp.group_context.value()[5];if(!f&&this.strings.label_form_override){f=this.strings.label_form_override}g.tmp.group_context.push([false,false,false,false,g.output.current.value(),f,this.strings.set_parallel_condition],CSL.LITERAL);if(this.strings.oops){g.tmp.group_context.value()[3]=this.strings.oops}};a=[];a.push(b);this.execs=a.concat(this.execs);if(this.strings["has-publisher-and-publisher-place"]){c.build["publisher-special"]=true;b=function(g,e){if(this.strings["subgroup-delimiter"]&&e.publisher&&e["publisher-place"]){var f=e.publisher.split(/;\s*/);var h=e["publisher-place"].split(/;\s*/);if(f.length>1&&f.length===h.length){g.publisherOutput=new CSL.PublisherOutput(g,this);g.publisherOutput["publisher-list"]=f;g.publisherOutput["publisher-place-list"]=h}}};this.execs.push(b)}}else{if(c.build["publisher-special"]){c.build["publisher-special"]=false;if("string"===typeof c[c.build.root].opt["name-delimiter"]){b=function(f,e){if(f.publisherOutput){f.publisherOutput.render();f.publisherOutput=false}};this.execs.push(b)}}b=function(h,g){var f=h.tmp.group_context.pop();h.output.endTag();var e=h.tmp.group_context.value();if(f[1]){h.tmp.group_context.value()[1]=true}if(f[2]||(f[0]&&!f[1])){h.tmp.group_context.value()[2]=true;var l=h.output.current.value().blobs;var k=h.output.current.value().blobs.length-1;if(!h.tmp.just_looking&&"undefined"!==typeof f[6]){var j={blobs:l,conditions:f[6],id:g.id,pos:k};h.parallel.parallel_conditional_blobs_list.push(j)}}else{if(h.output.current.value().blobs){h.output.current.value().blobs.pop()}if(h.tmp.group_context.value()[3]){h.output.current.mystack[h.output.current.mystack.length-2].strings.delimiter=h.tmp.group_context.value()[3]}}};this.execs.push(b)}d.push(this);if(this.tokentype===CSL.END){if(c.build.substitute_level.value()){c.build.substitute_level.replace((c.build.substitute_level.value()-1))}CSL.Util.substituteEnd.call(this,c,d)}}};CSL.Node["if"]={build:function(a,b){CSL.Conditions.TopNode.call(this,a,b);b.push(this)},configure:function(a,b){CSL.Conditions.Configure.call(this,a,b)}};CSL.Node.conditions={build:function(a,b){if(this.tokentype===CSL.START){a.tmp.conditions.addMatch(this.match)}if(this.tokentype===CSL.END){a.tmp.conditions.matchCombine()}}};CSL.Node.condition={build:function(a,b){if(this.tokentype===CSL.SINGLETON){var c=a.fun.match[this.match](this,a,this.tests);a.tmp.conditions.addTest(c)}}};CSL.Conditions={};CSL.Conditions.TopNode=function(b,c){var a;if(this.tokentype===CSL.START||this.tokentype===CSL.SINGLETON){if(this.locale){b.opt.lang=this.locale}if(!this.tests||!this.tests.length){b.tmp.conditions=new CSL.Conditions.Engine(b,this)}else{this.test=b.fun.match[this.match](this,b,this.tests)}}if(this.tokentype===CSL.END||this.tokentype===CSL.SINGLETON){a=function(f,d){if(this.locale_default){f.output.current.value().old_locale=this.locale_default;f.output.closeLevel("empty");f.opt.lang=this.locale_default}var e=this[f.tmp.jump.value()];return e};this.execs.push(a);if(this.locale_default){b.opt.lang=this.locale_default}}};CSL.Conditions.Configure=function(a,b){if(this.tokentype===CSL.START){this.fail=a.configure.fail.slice(-1)[0];this.succeed=this.next;a.configure.fail[(a.configure.fail.length-1)]=b}else{if(this.tokentype===CSL.SINGLETON){this.fail=this.next;this.succeed=a.configure.succeed.slice(-1)[0];a.configure.fail[(a.configure.fail.length-1)]=b}else{this.succeed=a.configure.succeed.slice(-1)[0];this.fail=this.next}}};CSL.Conditions.Engine=function(b,a){this.token=a;this.state=b};CSL.Conditions.Engine.prototype.addTest=function(a){this.token.tests.push(a)};CSL.Conditions.Engine.prototype.addMatch=function(a){this.token.match=a};CSL.Conditions.Engine.prototype.matchCombine=function(){this.token.test=this.state.fun.match[this.token.match](this.token,this.state,this.token.tests)};CSL.Node.info={build:function(a,b){if(this.tokentype===CSL.START){a.build.skip="info"}else{a.build.skip=false}}};CSL.Node.institution={build:function(b,c){if([CSL.SINGLETON,CSL.START].indexOf(this.tokentype)>-1){var a=function(g,f){if("string"===typeof g.build.name_delimiter&&!this.strings.delimiter){this.strings.delimiter=g.tmp.name_delimiter}var d,h,e;if("text"===this.strings.and){this.and_term=g.getTerm("and","long",0)}else{if("symbol"===this.strings.and){if(g.opt.development_extensions.expect_and_symbol_form){this.and_term=g.getTerm("and","symbol",0)}else{this.and_term="&"}}else{if("none"===this.strings.and){this.and_term=this.strings.delimiter}}}if("undefined"===typeof this.and_term&&g.tmp.and_term){this.and_term=g.getTerm("and","long",0)}if(CSL.STARTSWITH_ROMANESQUE_REGEXP.test(this.and_term)){this.and_prefix_single=" ";this.and_prefix_multiple=", ";if("string"===typeof this.strings.delimiter){this.and_prefix_multiple=this.strings.delimiter}this.and_suffix=" "}else{this.and_prefix_single="";this.and_prefix_multiple="";this.and_suffix=""}if(this.strings["delimiter-precedes-last"]==="always"){this.and_prefix_single=this.strings.delimiter}else{if(this.strings["delimiter-precedes-last"]==="never"){if(this.and_prefix_multiple){this.and_prefix_multiple=" "}}}this.and={};if("undefined"!==typeof this.and_term){g.output.append(this.and_term,"empty",true);this.and.single=g.output.pop();this.and.single.strings.prefix=this.and_prefix_single;this.and.single.strings.suffix=this.and_suffix;g.output.append(this.and_term,"empty",true);this.and.multiple=g.output.pop();this.and.multiple.strings.prefix=this.and_prefix_multiple;this.and.multiple.strings.suffix=this.and_suffix}else{if("undefined"!==this.strings.delimiter){this.and.single=new CSL.Blob(this.strings.delimiter);this.and.single.strings.prefix="";this.and.single.strings.suffix="";this.and.multiple=new CSL.Blob(this.strings.delimiter);this.and.multiple.strings.prefix="";this.and.multiple.strings.suffix=""}}g.nameOutput.institution=this};this.execs.push(a)}c.push(this)},configure:function(a,b){if([CSL.SINGLETON,CSL.START].indexOf(this.tokentype)>-1){a.build.has_institution=true}}};CSL.Node["institution-part"]={build:function(b,c){var a;if("long"===this.strings.name){if(this.strings["if-short"]){a=function(e,d){e.nameOutput.institutionpart["long-with-short"]=this}}else{a=function(e,d){e.nameOutput.institutionpart["long"]=this}}}else{if("short"===this.strings.name){a=function(e,d){e.nameOutput.institutionpart["short"]=this}}}this.execs.push(a);c.push(this)}};CSL.Node.key={build:function(c,v){var d,o,f;var h=false;var a=new CSL.Token("key",CSL.START);a.strings["et-al-min"]=this.strings["et-al-min"];a.strings["et-al-use-first"]=this.strings["et-al-use-first"];a.strings["et-al-use-last"]=this.strings["et-al-use-last"];d=function(x,w){x.tmp.done_vars=[]};a.execs.push(d);c.opt.citation_number_sort_direction=this.strings.sort_direction;d=function(x,w){x.output.openLevel("empty")};a.execs.push(d);var u=[];if(this.strings.sort_direction===CSL.DESCENDING){u.push(1);u.push(-1)}else{u.push(-1);u.push(1)}c[c.build.area].opt.sort_directions.push(u);if(CSL.DATE_VARIABLES.indexOf(this.variables[0])>-1){c.build.date_key=true}d=function(x,w){x.tmp.sort_key_flag=true;if(this.strings["et-al-min"]){x.tmp["et-al-min"]=this.strings["et-al-min"]}if(this.strings["et-al-use-first"]){x.tmp["et-al-use-first"]=this.strings["et-al-use-first"]}if("boolean"===typeof this.strings["et-al-use-last"]){x.tmp["et-al-use-last"]=this.strings["et-al-use-last"]}};a.execs.push(d);v.push(a);if(this.variables.length){var l=this.variables[0];if(l==="citation-number"){if(c.build.area==="citation_sort"){c.opt.citation_number_sort=true}if(c.build.area==="bibliography_sort"){c.opt.citation_number_sort_used=true}}if(CSL.CREATORS.indexOf(l)>-1){var r=new CSL.Token("names",CSL.START);r.tokentype=CSL.START;r.variables=this.variables;CSL.Node.names.build.call(r,c,v);var g=new CSL.Token("name",CSL.SINGLETON);g.tokentype=CSL.SINGLETON;g.strings["name-as-sort-order"]="all";g.strings["sort-separator"]=" ";g.strings["et-al-use-last"]=this.strings["et-al-use-last"];g.strings["et-al-min"]=this.strings["et-al-min"];g.strings["et-al-use-first"]=this.strings["et-al-use-first"];CSL.Node.name.build.call(g,c,v);var t=new CSL.Token("institution",CSL.SINGLETON);t.tokentype=CSL.SINGLETON;CSL.Node.institution.build.call(t,c,v);var b=new CSL.Token("names",CSL.END);b.tokentype=CSL.END;CSL.Node.names.build.call(b,c,v)}else{var s=new CSL.Token("text",CSL.SINGLETON);s.dateparts=this.dateparts;if(CSL.NUMERIC_VARIABLES.indexOf(l)>-1){d=function(z,y){var x,w;x=false;if("citation-number"===l){x=z.registry.registry[y.id].seq.toString()}else{x=y[l]}if(x){x=CSL.Util.padding(x)}z.output.append(x,this)}}else{if(l==="citation-label"){d=function(y,w){var x=y.getCitationLabel(w);y.output.append(x,this)}}else{if(CSL.DATE_VARIABLES.indexOf(l)>-1){d=CSL.dateAsSortKey;s.variables=this.variables}else{if("title"===l){var q="title";var n=false;var j=false;var k=true;d=c.transform.getOutputFunction(this.variables,q,n,j,k)}else{d=function(y,x){var w=x[l];y.output.append(w,"empty")}}}}}s.execs.push(d);v.push(s)}}else{var e=new CSL.Token("text",CSL.SINGLETON);e.postponed_macro=this.postponed_macro;CSL.expandMacro.call(c,e)}var p=new CSL.Token("key",CSL.END);d=function(y,x){var w=y.output.string(y,y.output.queue);if(y.sys.normalizeUnicode){w=y.sys.normalizeUnicode(w)}if(""===w){w=undefined}if("string"!==typeof w||y.tmp.empty_date){w=undefined;y.tmp.empty_date=false}y[y.tmp.area].keys.push(w);y.tmp.value=[]};p.execs.push(d);if(c.build.date_key){if(c.build.area==="citation_sort"){c[c.build.area].opt.sort_directions.push([-1,1]);d=function(z,w){var y=z.registry.registry[w.id].disambig.year_suffix;if(!y){y=0}var x=CSL.Util.padding(""+y);z[z.tmp.area].keys.push(x)};p.execs.push(d)}c.build.date_key=false}d=function(x,w){x.tmp["et-al-min"]=undefined;x.tmp["et-al-use-first"]=undefined;x.tmp["et-al-use-last"]=undefined;x.tmp.sort_key_flag=false};p.execs.push(d);v.push(p)}};CSL.Node.label={build:function(g,h){var b=false;if(this.strings.term){var c=false;if(!this.strings.form){this.strings.form="long"}var f=function(n,k,l){var j=CSL.evaluateLabel(this,n,k,l);if(l&&this.strings.term==="locator"){n.parallel.StartVariable("label");n.parallel.AppendToVariable(l.label);l.section_form_override=this.strings.form}n.output.append(j,this);if(l&&this.strings.term==="locator"){n.parallel.CloseVariable()}};this.execs.push(f)}else{var a=g.build.names_variables.slice(-1)[0];if(!g.build.name_label){g.build.name_label={}}for(var e=0,d=a.length;e<d;e+=1){if(!g.build.name_label[a[e]]){g.build.name_label[a[e]]={}}}if(!g.build.name_flag){for(var e=0,d=a.length;e<d;e+=1){g.build.name_label[a[e]].before=this}}else{for(var e=0,d=a.length;e<d;e+=1){g.build.name_label[a[e]].after=this}}}h.push(this)}};CSL.Node.layout={build:function(e,h){var c,g,f,a;if(this.tokentype===CSL.START){c=function(l,j,k){if(l.opt.development_extensions.apply_citation_wrapper&&l.sys.wrapCitationEntry&&!l.tmp.just_looking&&j.system_id&&l.tmp.area==="citation"){cite_entry=new CSL.Token("group",CSL.START);cite_entry.decorations=[["@cite","entry"]];l.output.startTag("cite_entry",cite_entry);l.output.current.value().item_id=j.system_id;if(k){l.output.current.value().locator_txt=k.locator_txt;l.output.current.value().suffix_txt=k.suffix_txt}}};this.execs.push(c)}if(this.tokentype===CSL.START&&!e.tmp.cite_affixes[e.build.area]){c=function(k,j){k.tmp.done_vars=[];if(!k.tmp.just_looking&&k.registry.registry[j.id].parallel){k.tmp.done_vars.push("first-reference-note-number")}k.tmp.rendered_name=false;k.tmp.name_node={}};this.execs.push(c);c=function(k,j){k.tmp.sort_key_flag=false};this.execs.push(c);c=function(k,j){k.tmp.nameset_counter=0};this.execs.push(c);c=function(l,k){var j="empty";if(l.opt.development_extensions.rtl_support){if(["ar","he","fa","ur","yi","ps","syr"].indexOf(k.language)>-1){j=new CSL.Token();j.strings.prefix="\u202b";j.strings.suffix="\u202c"}}l.output.openLevel(j)};this.execs.push(c);h.push(this);if(e.opt.development_extensions.rtl_support&&false){this.strings.prefix=this.strings.prefix.replace(/\((.|$)/g,"(\u200e$1");this.strings.suffix=this.strings.suffix.replace(/\)(.|$)/g,")\u200e$1")}if(e.build.area==="citation"){g=new CSL.Token("text",CSL.SINGLETON);c=function(p,k,n){var o;if(n&&n.prefix){o="";var l=n.prefix.replace(/<[^>]+>/g,"").replace(/["'\u201d\u2019\u00bb\u202f\u00a0 ]+$/g,"");var q=l.slice(-1);if(l.match(CSL.ENDSWITH_ROMANESQUE_REGEXP)){o=" "}else{if(CSL.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(q)>-1){o=" "}else{if(q.match(/[\)\],0-9]/)){o=" "}}}var j=false;if(CSL.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(q)>-1&&n.prefix.indexOf(" ")>-1){p.tmp.term_predecessor=false;j=true}prefix=(n.prefix+o).replace(/\s+/g," ");p.output.append(prefix,this,false,j)}};g.execs.push(c);h.push(g)}}var b;if(this.locale_raw){b=new CSL.Token("dummy",CSL.START);b.locale=this.locale_raw;b.strings.delimiter=this.strings.delimiter;b.strings.suffix=this.strings.suffix;if(!e.tmp.cite_affixes[e.build.area]){e.tmp.cite_affixes[e.build.area]={}}}if(this.tokentype===CSL.START){e.build.layout_flag=true;if(!this.locale_raw){e[e.tmp.area].opt.topdecor=[this.decorations];e[(e.tmp.area+"_sort")].opt.topdecor=[this.decorations];e[e.build.area].opt.layout_prefix=this.strings.prefix;e[e.build.area].opt.layout_suffix=this.strings.suffix;e[e.build.area].opt.layout_delimiter=this.strings.delimiter;e[e.build.area].opt.layout_decorations=this.decorations;if(e.tmp.cite_affixes[e.build.area]){a=new CSL.Token("else",CSL.START);CSL.Node["else"].build.call(a,e,h)}}if(this.locale_raw){if(!e.build.layout_locale_flag){var d=new CSL.Token("choose",CSL.START);CSL.Node.choose.build.call(d,e,h);b.name="if";CSL.Attributes["@locale-internal"].call(b,e,this.locale_raw);CSL.Node["if"].build.call(b,e,h)}else{b.name="else-if";CSL.Attributes["@locale-internal"].call(b,e,this.locale_raw);CSL.Node["else-if"].build.call(b,e,h)}e.tmp.cite_affixes[e.build.area][b.locale]={};e.tmp.cite_affixes[e.build.area][b.locale].delimiter=this.strings.delimiter;e.tmp.cite_affixes[e.build.area][b.locale].suffix=this.strings.suffix}}if(this.tokentype===CSL.END){if(this.locale_raw){if(!e.build.layout_locale_flag){b.name="if";b.tokentype=CSL.END;CSL.Attributes["@locale-internal"].call(b,e,this.locale_raw);CSL.Node["if"].build.call(b,e,h);e.build.layout_locale_flag=true}else{b.name="else-if";b.tokentype=CSL.END;CSL.Attributes["@locale-internal"].call(b,e,this.locale_raw);CSL.Node["else-if"].build.call(b,e,h)}}if(!this.locale_raw){if(e.tmp.cite_affixes[e.build.area]){if(e.build.layout_locale_flag){a=new CSL.Token("else",CSL.END);CSL.Node["else"].build.call(a,e,h);a=new CSL.Token("choose",CSL.END);CSL.Node.choose.build.call(a,e,h)}}e.build_layout_locale_flag=true;if(e.build.area==="citation"){f=new CSL.Token("text",CSL.SINGLETON);c=function(n,j,k){var l;if(k&&k.suffix){l="";if(k.suffix.match(CSL.STARTSWITH_ROMANESQUE_REGEXP)||["[","("].indexOf(k.suffix.slice(0,1))>-1){l=" "}n.output.append((l+k.suffix),this)}};f.execs.push(c);h.push(f)}c=function(k,j){if(k.tmp.area==="bibliography"){if(k.bibliography.opt["second-field-align"]){k.output.endTag()}}k.output.closeLevel()};this.execs.push(c);c=function(k,j){if(k.opt.development_extensions.apply_citation_wrapper&&k.sys.wrapCitationEntry&&!k.tmp.just_looking&&j.system_id&&k.tmp.area==="citation"){k.output.endTag()}};this.execs.push(c);h.push(this);e.build.layout_flag=false;e.build.layout_locale_flag=false}}}};CSL.Node.macro={build:function(a,b){}};CSL.NameOutput=function(c,a,b,d){this.debug=false;this.state=c;this.Item=a;this.item=b;this.nameset_base=0;this.etal_spec={};this._first_creator_variable=false;this._please_chop=false};CSL.NameOutput.prototype.init=function(c){if(this.state.tmp.term_predecessor){this.state.tmp.subsequent_author_substitute_ok=false}if(this.nameset_offset){this.nameset_base=this.nameset_base+this.nameset_offset}this.nameset_offset=0;this.names=c;this.variables=c.variables;this.state.tmp.value=[];this.state.tmp.rendered_name=[];this.state.tmp.label_blob=false;this.state.tmp.etal_node=false;this.state.tmp.etal_term=false;for(var b=0,a=this.variables.length;b<a;b+=1){if(this.Item[this.variables[b]]&&this.Item[this.variables[b]].length){this.state.tmp.value=this.state.tmp.value.concat(this.Item[this.variables[b]])}}this["et-al"]=undefined;this["with"]=undefined;this.name=undefined;this.institutionpart={};this.state.tmp.group_context.value()[1]=true;if(!this.state.tmp.value.length){return}};CSL.NameOutput.prototype.reinit=function(d){if(this.state.tmp.can_substitute.value()){this.nameset_offset=0;this.variables=d.variables;var c=this.state.tmp.value.slice();this.state.tmp.value=[];for(var b=0,a=this.variables.length;b<a;b+=1){if(this.Item[this.variables[b]]&&this.Item[this.variables[b]].length){this.state.tmp.value=this.state.tmp.value.concat(this.Item[this.variables[b]])}}if(this.state.tmp.value.length){this.state.tmp.can_substitute.replace(false,CSL.LITERAL)}this.state.tmp.value=c}};CSL.NameOutput.prototype.outputNames=function(){var d,b;var p=this.variables;if(this.institution.and){if(!this.institution.and.single.blobs||!this.institution.and.single.blobs.length){this.institution.and.single.blobs=this.name.and.single.blobs}if(!this.institution.and.multiple.blobs||!this.institution.and.multiple.blobs.length){this.institution.and.multiple.blobs=this.name.and.multiple.blobs}}this.variable_offset={};if(this.family){this.family_decor=CSL.Util.cloneToken(this.family);this.family_decor.strings.prefix="";this.family_decor.strings.suffix="";for(d=0,b=this.family.execs.length;d<b;d+=1){this.family.execs[d].call(this.family_decor,this.state,this.Item)}}else{this.family_decor=false}if(this.given){this.given_decor=CSL.Util.cloneToken(this.given);this.given_decor.strings.prefix="";this.given_decor.strings.suffix="";for(d=0,b=this.given.execs.length;d<b;d+=1){this.given.execs[d].call(this.given_decor,this.state,this.Item)}}else{this.given_decor=false}this.getEtAlConfig();this.divideAndTransliterateNames();this.truncatePersonalNameLists();this.disambigNames();this.constrainNames();if(this.name.strings.form==="count"){if(this.state.tmp.extension||this.names_count!=0){this.state.output.append(this.names_count,"empty");this.state.tmp.group_context.value()[2]=true}return}this.setEtAlParameters();this.setCommonTerm();this.state.tmp.name_node={};this.state.tmp.name_node.children=[];this.renderAllNames();var f=[];for(d=0,b=p.length;d<b;d+=1){var l=p[d];var q=[];var k=false;for(var c=0,o=this.institutions[l].length;c<o;c+=1){q.push(this.joinPersonsAndInstitutions([this.persons[l][c],this.institutions[l][c]]))}if(this.institutions[l].length){var g=this.nameset_base+this.variable_offset[l];if(this.freeters[l].length){g+=1}k=this.joinInstitutionSets(q,g)}var r=this.joinFreetersAndInstitutionSets([this.freeters[l],k]);if(r){if(this.state.tmp.area.slice(-5)!=="_sort"){r=this._applyLabels(r,l)}f.push(r)}if(this.common_term){break}}this.state.output.openLevel("empty");this.state.output.current.value().strings.delimiter=this.names.strings.delimiter;for(d=0,b=f.length;d<b;d+=1){this.state.output.append(f[d],"literal",true)}this.state.output.closeLevel("empty");var a=this.state.output.pop();this.state.output.append(a,this.names);if(this.state.tmp.term_predecessor_name){this.state.tmp.term_predecessor=true}this.state.tmp.name_node.top=this.state.output.current.value();if(p[0]!=="authority"){var e=[];var n=this.Item[p[0]];if(n){for(var d=0,b=n.length;d<b;d+=1){substring=CSL.Util.Names.getRawName(n[d]);if(substring){e.push(substring)}}}e=e.join(", ");if(e){this.state.tmp.name_node.string=e}}if(this.state.tmp.name_node.string&&!this.state.tmp.first_name_string){this.state.tmp.first_name_string=this.state.tmp.name_node.string}if("classic"===this.Item.type){var h=[];if(this.state.tmp.first_name_string){h.push(this.state.tmp.first_name_string)}if(this.Item.title){h.push(this.Item.title)}h=h.join(", ");if(h&&this.state.sys.getAbbreviation){this.state.transform.loadAbbreviation("default","classic",h);if(this.state.transform.abbrevs["default"].classic[h]){this.state.tmp.done_vars.push("title");this.state.output.append(this.state.transform.abbrevs["default"].classic[h],"empty",true);a=this.state.output.pop();this.state.tmp.name_node.top.blobs.pop();this.state.tmp.name_node.top.blobs.push(a)}}}this._collapseAuthor();this.variables=[]};CSL.NameOutput.prototype._applyLabels=function(c,b){var a;if(!this.label||!this.label[b]){return c}var e=0;var d=this.freeters_count[b]+this.institutions_count[b];if(d>1){e=1}else{for(var g=0,f=this.persons[b].length;g<f;g+=1){d+=this.persons_count[b][g]}if(d>1){e=1}}if(this.label[b].before){if("number"===typeof this.label[b].before.strings.plural){e=this.label[b].before.strings.plural}a=this._buildLabel(b,e,"before",b);this.state.output.openLevel("empty");this.state.output.append(a,this.label[b].before,true);this.state.output.append(c,"literal",true);this.state.output.closeLevel("empty");c=this.state.output.pop()}if(this.label[b].after){if("number"===typeof this.label[b].after.strings.plural){e=this.label[b].after.strings.plural}a=this._buildLabel(b,e,"after",b);this.state.output.openLevel("empty");this.state.output.append(c,"literal",true);this.state.output.append(a,this.label[b].after,true);this.state.tmp.label_blob=this.state.output.pop();this.state.output.append(this.state.tmp.label_blob,"literal",true);this.state.output.closeLevel("empty");c=this.state.output.pop()}return c};CSL.NameOutput.prototype._buildLabel=function(e,d,a,b){if(this.common_term){e=this.common_term}var c=false;var f=this.label[b][a];if(f){c=CSL.castLabel(this.state,f,e,d,CSL.TOLERANT)}return c};CSL.NameOutput.prototype._collapseAuthor=function(){var a,b,c;if(this.nameset_base===0&&this.Item[this.variables[0]]&&!this._first_creator_variable){this._first_creator_variable=this.variables[0]}if((this.item&&this.item["suppress-author"]&&this._first_creator_variable==this.variables[0])||(this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length)||(this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter.length)){if(this.state.tmp.authorstring_request){b="";a=this.state.tmp.name_node.top.blobs.slice(-1)[0].blobs;c=this.state.tmp.offset_characters;if(a){b=this.state.output.string(this.state,a,false)}this.state.tmp.offset_characters=c;this.state.registry.authorstrings[this.Item.id]=b}else{if(!this.state.tmp.just_looking&&!this.state.tmp.suppress_decorations&&(this.item["suppress-author"]||(this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length)||this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter)){b="";a=this.state.tmp.name_node.top.blobs.slice(-1)[0].blobs;c=this.state.tmp.offset_characters;if(a){b=this.state.output.string(this.state,a,false)}if(b===this.state.tmp.last_primary_names_string){if(this.item["suppress-author"]||(this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length)){this.state.tmp.name_node.top.blobs.pop();this.state.tmp.name_node.children=[];this.state.tmp.offset_characters=c}if(this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter){this.state.tmp.use_cite_group_delimiter=true}}else{this.state.tmp.last_primary_names_string=b;if(this.variables.indexOf(this._first_creator_variable)>-1&&this.item&&this.item["suppress-author"]&&this.Item.type!=="legal_case"){this.state.tmp.name_node.top.blobs.pop();this.state.tmp.name_node.children=[];this.state.tmp.offset_characters=c;this.state.tmp.term_predecessor=false}this.state.tmp.have_collapsed=false;if(this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter){this.state.tmp.use_cite_group_delimiter=false}}}}}};CSL.NameOutput.prototype.isPerson=function(a){if(a.literal||(!a.given&&a.family&&a.isInstitution)){return false}else{return true}};CSL.NameOutput.prototype.truncatePersonalNameLists=function(){var c,f,e,d,a,g,b;this.freeters_count={};this.persons_count={};this.institutions_count={};for(c in this.freeters){if(this.freeters.hasOwnProperty(c)){this.freeters_count[c]=this.freeters[c].length;this.freeters[c]=this._truncateNameList(this.freeters,c)}}for(c in this.persons){if(this.persons.hasOwnProperty(c)){this.institutions_count[c]=this.institutions[c].length;this._truncateNameList(this.institutions,c);this.persons[c]=this.persons[c].slice(0,this.institutions[c].length);this.persons_count[c]=[];for(d=0,a=this.persons[c].length;d<a;d+=1){this.persons_count[c][d]=this.persons[c][d].length;this.persons[c][d]=this._truncateNameList(this.persons,c,d)}}}if(this.etal_min===1&&this.etal_use_first===1&&!(this.state.tmp.extension||this.state.tmp.just_looking)){g=c}else{g=false}if(g||this._please_chop){for(f=0,e=this.variables.length;f<e;f+=1){c=this.variables[f];if(this.freeters[c].length){if(this._please_chop===c){this.freeters[c]=this.freeters[c].slice(1);this.freeters_count[c]+=-1;this._please_chop=false}else{if(g&&!this._please_chop){this.freeters[c]=this.freeters[c].slice(0,1);this.freeters_count[c]=1;this.institutions[c]=[];this.persons[c]=[];this._please_chop=g}}}for(f=0,e=this.persons[c].length;f<e;f+=1){if(this.persons[c][f].length){if(this._please_chop===c){this.persons[c][f]=this.persons[c][f].slice(1);this.persons_count[c][f]+=-1;this._please_chop=false;break}else{if(g&&!this._please_chop){this.freeters[c]=this.persons[c][f].slice(0,1);this.freeters_count[c]=1;this.institutions[c]=[];this.persons[c]=[];b=[];this._please_chop=g;break}}}}if(this.institutions[c].length){if(this._please_chop===c){this.institutions[c]=this.institutions[c].slice(1);this.institutions_count[c]+=-1;this._please_chop=false}else{if(g&&!this._please_chop){this.institutions[c]=this.institutions[c].slice(0,1);this.institutions_count[c]=1;b=[];this._please_chop=g}}}}}for(f=0,e=this.variables.length;f<e;f+=1){if(this.institutions[c].length){this.nameset_offset+=1}for(f=0,e=this.persons[c].length;f<e;f+=1){if(this.persons[c][f].length){this.nameset_offset+=1}}}};CSL.NameOutput.prototype._truncateNameList=function(b,d,c){var a;if("undefined"===typeof c){a=b[d]}else{a=b[d][c]}if(this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names&&a.length>50&&a.length>(this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names+2)){a=a.slice(0,this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names+2)}return a};CSL.NameOutput.prototype.divideAndTransliterateNames=function(){var e,a,d,n;var b=this.Item;var l=this.variables;this.varnames=l.slice();this.freeters={};this.persons={};this.institutions={};for(e=0,a=l.length;e<a;e+=1){var g=l[e];this.variable_offset[g]=this.nameset_offset;var h=this._normalizeVariableValue(b,g);if(this.name.strings["suppress-min"]&&h.length>=this.name.strings["suppress-min"]){h=[]}if(this.name.strings["suppress-max"]&&h.length<=this.name.strings["suppress-max"]){h=[]}this._getFreeters(g,h);this._getPersonsAndInstitutions(g,h);if(this.name.strings["suppress-min"]===0){this.freeters[g]=[];for(d=0,n=this.persons[g].length;d<n;d+=1){this.persons[g][d]=[]}}else{if(this.institution.strings["suppress-min"]===0){this.institutions[g]=[];this.freeters[g]=this.freeters[g].concat(this.persons[g]);for(d=0,n=this.persons[g].length;d<n;d+=1){for(var c=0,f=this.persons[g][d].length;c<f;c+=1){this.freeters[g].push(this.persons[g][d][c])}}this.persons[g]=[]}}}};CSL.NameOutput.prototype._normalizeVariableValue=function(c,b){var f,a,e,d;if("string"===typeof c[b]){f=[{literal:c[b]}]}else{if(!c[b]){f=[]}else{f=c[b].slice()}}return f};CSL.NameOutput.prototype._getFreeters=function(b,a){this.freeters[b]=[];for(var c=a.length-1;c>-1;c+=-1){if(this.isPerson(a[c])){var d=this._checkNickname(a.pop());if(d){this.freeters[b].push(d)}}else{break}}this.freeters[b].reverse();if(this.freeters[b].length){this.nameset_offset+=1}};CSL.NameOutput.prototype._getPersonsAndInstitutions=function(b,a){this.persons[b]=[];this.institutions[b]=[];var e=[];var g=false;var f=true;for(var c=a.length-1;c>-1;c+=-1){if(this.isPerson(a[c])){var d=this._checkNickname(a[c]);if(d){e.push(d)}}else{g=true;this.institutions[b].push(a[c]);if(!f){e.reverse();this.persons[b].push(e);e=[]}f=false}}if(g){e.reverse();this.persons[b].push(e);this.persons[b].reverse();this.institutions[b].reverse()}};CSL.NameOutput.prototype._clearValues=function(a){for(var b=a.length-1;b>-1;b+=-1){a.pop()}};CSL.NameOutput.prototype._checkNickname=function(b){if(["interview","personal_communication"].indexOf(this.Item.type)>-1){var c="";c=CSL.Util.Names.getRawName(b);if(c&&this.state.sys.getAbbreviation&&!(this.item&&this.item["suppress-author"])){this.state.transform.loadAbbreviation("default","nickname",c);var a=this.state.transform.abbrevs["default"].nickname[c];if(a){if(a==="!here>>>"){b=false}else{b={family:a,given:""}}}}}return b};CSL.NameOutput.prototype.joinPersons=function(d,c,b){var a;if("undefined"===typeof b){if(this.etal_spec[c].freeters===1){a=this._joinEtAl(d,"name")}else{if(this.etal_spec[c].freeters===2){a=this._joinEllipsis(d,"name")}else{if(!this.state.tmp.sort_key_flag){a=this._joinAnd(d,"name")}else{a=this._join(d," ")}}}}else{if(this.etal_spec[c].persons[b]===1){a=this._joinEtAl(d,"name")}else{if(this.etal_spec[c].persons[b]===2){a=this._joinEllipsis(d,"name")}else{if(!this.state.tmp.sort_key_flag){a=this._joinAnd(d,"name")}else{a=this._join(d," ")}}}}return a};CSL.NameOutput.prototype.joinInstitutionSets=function(c,b){var a;if(this.etal_spec[b].institutions===1){a=this._joinEtAl(c,"institution")}else{if(this.etal_spec[b].institutions===2){a=this._joinEllipsis(c,"institution")}else{a=this._joinAnd(c,"institution")}}return a};CSL.NameOutput.prototype.joinPersonsAndInstitutions=function(a){return this._join(a,this.name.strings.delimiter)};CSL.NameOutput.prototype.joinFreetersAndInstitutionSets=function(b){var a=this._join(b,"[never here]",this["with"].single,this["with"].multiple);return a};CSL.NameOutput.prototype._joinEtAl=function(c,b){var a=this._join(c,this.name.strings.delimiter);this.state.output.openLevel(this._getToken(b));this.state.output.current.value().strings.delimiter="";this.state.output.append(a,"literal",true);if(c.length>1){this.state.output.append(this["et-al"].multiple,"literal",true)}else{if(c.length===1){this.state.output.append(this["et-al"].single,"literal",true)}}this.state.output.closeLevel();return this.state.output.pop()};CSL.NameOutput.prototype._joinEllipsis=function(b,a){return this._join(b,this.name.strings.delimiter,this.name.ellipsis.single,this.name.ellipsis.multiple,a)};CSL.NameOutput.prototype._joinAnd=function(b,a){return this._join(b,this[a].strings.delimiter,this[a].and.single,this[a].and.multiple,a)};CSL.NameOutput.prototype._join=function(e,c,g,j,h){var f,d;if(!e){return false}for(f=e.length-1;f>-1;f+=-1){if(!e[f]||e[f].length===0||!e[f].blobs.length){e=e.slice(0,f).concat(e.slice(f+1))}}if(!e.length){return false}else{if(g&&e.length===2){if(g){g=new CSL.Blob(g.blobs,g)}e=[e[0],g,e[1]]}else{var b;if(j){b=2}else{b=1}for(f=0,d=e.length-b;f<d;f+=1){e[f].strings.suffix+=c}if(e.length>1){var a=e.pop();if(j){j=new CSL.Blob(j.blobs,j);e.push(j)}else{if(g){g=new CSL.Blob(g.blobs,g)}e.push(g)}e.push(a)}}}this.state.output.openLevel(this._getToken(h));if(g&&j){this.state.output.current.value().strings.delimiter=""}for(f=0,d=e.length;f<d;f+=1){this.state.output.append(e[f],false,true)}this.state.output.closeLevel();return this.state.output.pop()};CSL.NameOutput.prototype._getToken=function(b){var a=this[b];if(b==="institution"){var c=new CSL.Token();return c}return a};CSL.NameOutput.prototype.setCommonTerm=function(){var l=this.variables;var a=l.slice();a.sort();this.common_term=a.join("");if(!this.common_term){return false}var d=false;if(this.label&&this.label[this.variables[0]]){if(this.label[this.variables[0]].before){d=this.state.getTerm(this.common_term,this.label[this.variables[0]].before.strings.form,0)}else{if(this.label[this.variables[0]].after){d=this.state.getTerm(this.common_term,this.label[this.variables[0]].after.strings.form,0)}}}if(!this.state.locale[this.state.opt.lang].terms[this.common_term]||!d||this.variables.length<2){this.common_term=false;return}var e=0;for(var f=0,b=this.variables.length-1;f<b;f+=1){var h=this.variables[f];var g=this.variables[f+1];if(this.freeters[h].length||this.freeters[g].length){if(this.etal_spec[h].freeters!==this.etal_spec[g].freeters||!this._compareNamesets(this.freeters[h],this.freeters[g])){this.common_term=false;return}e+=1}if(this.persons[h].length!==this.persons[g].length){this.common_term=false;return}for(var c=0,k=this.persons[h].length;c<k;c+=1){if(this.etal_spec[h].persons[c]!==this.etal_spec[g].persons[c]||!this._compareNamesets(this.persons[h][c],this.persons[g][c])){this.common_term=false;return}}}};CSL.NameOutput.prototype._compareNamesets=function(h,g){if(h.length!==g.length){return false}for(var f=0,e=g.length;f<e;f+=1){var d=g[f];for(var c=0,a=CSL.NAME_PARTS.length;c<a;c+=1){var b=CSL.NAME_PARTS[c];if(!h[f]||h[f][b]!=g[f][b]){return false}}}return true};CSL.NameOutput.prototype.constrainNames=function(){this.names_count=0;var f;for(var e=0,d=this.variables.length;e<d;e+=1){var b=this.variables[e];f=this.nameset_base+e;if(this.freeters[b].length){this.state.tmp.names_max.push(this.freeters[b].length,"literal");this._imposeNameConstraints(this.freeters,this.freeters_count,b,f);this.names_count+=this.freeters[b].length}if(this.institutions[b].length){this.state.tmp.names_max.push(this.institutions[b].length,"literal");this._imposeNameConstraints(this.institutions,this.institutions_count,b,f);this.persons[b]=this.persons[b].slice(0,this.institutions[b].length);this.names_count+=this.institutions[b].length}for(var c=0,a=this.persons[b].length;c<a;c+=1){if(this.persons[b][c].length){this.state.tmp.names_max.push(this.persons[b][c].length,"literal");this._imposeNameConstraints(this.persons[b],this.persons_count[b],c,f);this.names_count+=this.persons[b][c].length}}}};CSL.NameOutput.prototype._imposeNameConstraints=function(a,f,d,h){var g=a[d];var e=this.state.tmp["et-al-min"];if(this.state.tmp.suppress_decorations){if(this.state.tmp.disambig_request&&this.state.tmp.disambig_request.names[h]){e=this.state.tmp.disambig_request.names[h]}else{if(f[d]>=this.etal_min){e=this.etal_use_first}}}else{if(this.state.tmp.disambig_request&&this.state.tmp.disambig_request.names[h]>this.etal_use_first){if(f[d]<this.etal_min){e=f[d]}else{e=this.state.tmp.disambig_request.names[h]}}else{if(f[d]>=this.etal_min){e=this.etal_use_first}}if(this.etal_use_last&&e>(this.etal_min-2)){e=this.etal_min-2}}var b=this.etal_min>=this.etal_use_first;var c=f[d]>e;if(e>f[d]){e=g.length}if(b&&c){if(this.etal_use_last){a[d]=g.slice(0,e).concat(g.slice(-1))}else{a[d]=g.slice(0,e)}}this.state.tmp.disambig_settings.names[h]=a[d].length;this.state.disambiguate.padBase(this.state.tmp.disambig_settings)};CSL.NameOutput.prototype.disambigNames=function(){var f;for(var e=0,d=this.variables.length;e<d;e+=1){var b=this.variables[e];f=this.nameset_base+e;if(this.freeters[b].length){this._runDisambigNames(this.freeters[b],f)}if(this.institutions[b].length){if("undefined"===typeof this.state.tmp.disambig_settings.givens[f]){this.state.tmp.disambig_settings.givens[f]=[]}for(var c=0,a=this.institutions[b].length;c<a;c+=1){if("undefined"===typeof this.state.tmp.disambig_settings.givens[f][c]){this.state.tmp.disambig_settings.givens[f].push(2)}}}for(var c=0,a=this.persons[b].length;c<a;c+=1){if(this.persons[b][c].length){this._runDisambigNames(this.persons[b][c],f)}}}};CSL.NameOutput.prototype._runDisambigNames=function(k,n){var l,a,f,e,h,c,b;for(h=0,c=k.length;h<c;h+=1){if(!k[h].given&&!k[h].family){continue}f=this.name.strings["initialize-with"];this.state.registry.namereg.addname(""+this.Item.id,k[h],h);l=this.state.tmp.disambig_settings.givens[n];if("undefined"===typeof l){for(var g=0,o=n+1;g<o;g+=1){if(!this.state.tmp.disambig_settings.givens[g]){this.state.tmp.disambig_settings.givens[g]=[]}}}l=this.state.tmp.disambig_settings.givens[n][h];if("undefined"===typeof l){a=this.name.strings.form;e=this.state.registry.namereg.evalname(""+this.Item.id,k[h],h,0,a,f);this.state.tmp.disambig_settings.givens[n].push(e)}a=this.name.strings.form;b=this.state.registry.namereg.evalname(""+this.Item.id,k[h],h,0,a,f);if(this.state.tmp.disambig_request){var d=this.state.tmp.disambig_settings.givens[n][h];if(d===1&&this.state.citation.opt["givenname-disambiguation-rule"]==="by-cite"&&("undefined"===typeof this.name.strings["initialize-with"]||"undefined"===typeof k[h].given)){d=2}e=d;if(this.state.opt["disambiguate-add-givenname"]&&k[h].given){e=this.state.registry.namereg.evalname(""+this.Item.id,k[h],h,e,this.name.strings.form,this.name.strings["initialize-with"])}}else{e=b}if(!this.state.tmp.just_looking&&this.item&&this.item.position===CSL.POSITION_FIRST){if(b>e){e=b}}if(!this.state.tmp.sort_key_flag){this.state.tmp.disambig_settings.givens[n][h]=e;if("string"===typeof f&&("undefined"===typeof this.name.strings.initialize||true===this.name.strings.initialize)){this.state.tmp.disambig_settings.use_initials=true}}}};CSL.NameOutput.prototype.getEtAlConfig=function(){var a=this.item;this["et-al"]={};this.state.output.append(this.etal_term,this.etal_style,true);this["et-al"].single=this.state.output.pop();this["et-al"].single.strings.suffix=this.etal_suffix;this["et-al"].single.strings.prefix=this.etal_prefix_single;this.state.output.append(this.etal_term,this.etal_style,true);this["et-al"].multiple=this.state.output.pop();this["et-al"].multiple.strings.suffix=this.etal_suffix;this["et-al"].multiple.strings.prefix=this.etal_prefix_multiple;if("undefined"===typeof a){a={}}if(a.position){if(this.name.strings["et-al-subsequent-min"]){this.etal_min=this.name.strings["et-al-subsequent-min"]}else{this.etal_min=this.name.strings["et-al-min"]}if(this.name.strings["et-al-subsequent-use-first"]){this.etal_use_first=this.name.strings["et-al-subsequent-use-first"]}else{this.etal_use_first=this.name.strings["et-al-use-first"]}}else{if(this.state.tmp["et-al-min"]){this.etal_min=this.state.tmp["et-al-min"]}else{this.etal_min=this.name.strings["et-al-min"]}if(this.state.tmp["et-al-use-first"]){this.etal_use_first=this.state.tmp["et-al-use-first"]}else{this.etal_use_first=this.name.strings["et-al-use-first"]}if("boolean"===typeof this.state.tmp["et-al-use-last"]){this.etal_use_last=this.state.tmp["et-al-use-last"]}else{this.etal_use_last=this.name.strings["et-al-use-last"]}}if(!this.state.tmp["et-al-min"]){this.state.tmp["et-al-min"]=this.etal_min}};CSL.NameOutput.prototype.setEtAlParameters=function(){var e,d,c,a;for(e=0,d=this.variables.length;e<d;e+=1){var b=this.variables[e];if("undefined"===typeof this.etal_spec[b]){this.etal_spec[b]={freeters:0,institutions:0,persons:[]}}this.etal_spec[this.nameset_base+e]=this.etal_spec[b];if(this.freeters[b].length){this._setEtAlParameter("freeters",b)}for(c=0,a=this.persons[b].length;c<a;c+=1){if("undefined"===typeof this.etal_spec[b][c]){this.etal_spec[b].persons[c]=0}this._setEtAlParameter("persons",b,c)}if(this.institutions[b].length){this._setEtAlParameter("institutions",b)}}};CSL.NameOutput.prototype._setEtAlParameter=function(d,b,c){var a,e;if(d==="persons"){a=this.persons[b][c];e=this.persons_count[b][c]}else{a=this[d][b];e=this[d+"_count"][b]}if(a.length<e&&!this.state.tmp.sort_key_flag){if(this.etal_use_last){if(d==="persons"){this.etal_spec[b].persons[c]=2}else{this.etal_spec[b][d]=2}}else{if(d==="persons"){this.etal_spec[b].persons[c]=1}else{this.etal_spec[b][d]=1}}}else{if(d==="persons"){this.etal_spec[b].persons[c]=0}else{this.etal_spec[b][d]=0}}};CSL.NameOutput.prototype.renderAllNames=function(){var f;for(var e=0,d=this.variables.length;e<d;e+=1){var b=this.variables[e];f=this.nameset_base+e;if(this.freeters[b].length){this.freeters[b]=this._renderPersonalNames(this.freeters[b],f)}for(var c=0,a=this.institutions[b].length;c<a;c+=1){this.persons[b][c]=this._renderPersonalNames(this.persons[b][c],f,c)}}this.renderInstitutionNames()};CSL.NameOutput.prototype.renderInstitutionNames=function(){for(var q=0,d=this.variables.length;q<d;q+=1){var e=this.variables[q];for(var o=0,f=this.institutions[e].length;o<f;o+=1){var c,p,t,b,n;var z=this.institutions[e][o];var o,w,a,f,y,r;if(this.state.tmp.extension){r=["sort"]}else{if(z.isInstitution){r=this.state.opt["cite-lang-prefs"].institutions}else{r=this.state.opt["cite-lang-prefs"].persons}}slot={primary:"locale-orig",secondary:false,tertiary:false};if(r){var s=["primary","secondary","tertiary"];for(var l=0,h=s.length;l<h;l+=1){if(r.length-1<l){break}if(r[l]){slot[s[l]]="locale-"+r[l]}}}else{slot.primary="locale-translat"}if(this.state.tmp.area!=="bibliography"&&!(this.state.tmp.area==="citation"&&this.state.opt.xclass==="note"&&this.item&&!this.item.position)){slot.secondary=false;slot.tertiary=false}var x;this.setRenderedName(z);x=this.getName(z,slot.primary,true);var g=x.name;var u=x.usedOrig;if(g){g=this.fixupInstitution(g,e,o)}secondary=false;if(slot.secondary){x=this.getName(z,slot.secondary,false,u);secondary=x.name;u=x.usedOrig;if(secondary){secondary=this.fixupInstitution(secondary,e,o)}}tertiary=false;if(slot.tertiary){x=this.getName(z,slot.tertiary,false,u);tertiary=x.name;if(tertiary){tertiary=this.fixupInstitution(tertiary,e,o)}}switch(this.institution.strings["institution-parts"]){case"short":if(g["short"].length){b=this._getShortStyle();c=[this._renderOneInstitutionPart(g["short"],b)]}else{n=this._getLongStyle(g,e,o);c=[this._renderOneInstitutionPart(g["long"],n)]}break;case"short-long":n=this._getLongStyle(g,e,o);b=this._getShortStyle();p=this._renderOneInstitutionPart(g["short"],b);t=this._composeOneInstitutionPart([g,secondary,tertiary],slot,n);c=[p,t];break;case"long-short":n=this._getLongStyle(g,e,o);b=this._getShortStyle();p=this._renderOneInstitutionPart(g["short"],b);t=this._composeOneInstitutionPart([g,secondary,tertiary],slot,n,true);c=[t,p];break;default:n=this._getLongStyle(g,e,o);c=[this._composeOneInstitutionPart([g,secondary,tertiary],slot,n)];break}this.institutions[e][o]=this._join(c,"")}}};CSL.NameOutput.prototype._composeOneInstitutionPart=function(e,g,d){var c=false,a=false,f=false;if(e[0]){c=this._renderOneInstitutionPart(e[0]["long"],d)}if(e[1]){a=this._renderOneInstitutionPart(e[1]["long"],d)}if(e[2]){f=this._renderOneInstitutionPart(e[2]["long"],d)}var b;if(a||f){this.state.output.openLevel("empty");this.state.output.append(c);secondary_tok=CSL.Util.cloneToken(d);if(g.secondary){secondary_tok.strings.prefix=this.state.opt.citeAffixes.institutions[g.secondary].prefix;secondary_tok.strings.suffix=this.state.opt.citeAffixes.institutions[g.secondary].suffix;if(!secondary_tok.strings.prefix){secondary_tok.strings.prefix=" "}}this.state.output.append(a,secondary_tok);tertiary_tok=CSL.Util.cloneToken(d);if(g.tertiary){tertiary_tok.strings.prefix=this.state.opt.citeAffixes.institutions[g.tertiary].prefix;tertiary_tok.strings.suffix=this.state.opt.citeAffixes.institutions[g.tertiary].suffix;if(!tertiary_tok.strings.prefix){tertiary_tok.strings.prefix=" "}}this.state.output.append(f,tertiary_tok);this.state.output.closeLevel();b=this.state.output.pop()}else{b=c}return b};CSL.NameOutput.prototype._renderOneInstitutionPart=function(g,e){for(var d=0,c=g.length;d<c;d+=1){if(g[d]){var f=g[d];if(this.state.tmp.strip_periods){f=f.replace(/\./g,"")}else{for(var b=0,a=e.decorations.length;b<a;b+=1){if("@strip-periods"===e.decorations[b][0]&&"true"===e.decorations[b][1]){f=f.replace(/\./g,"");break}}}this.state.tmp.group_context.value()[2]=true;this.state.tmp.can_substitute.replace(false,CSL.LITERAL);if(f==="!here>>>"){g[d]=false}else{this.state.output.append(f,e,true);g[d]=this.state.output.pop()}}}if("undefined"===typeof this.institution.strings["part-separator"]){this.institution.strings["part-separator"]=this.name.strings.delimiter}return this._join(g,this.institution.strings["part-separator"])};CSL.NameOutput.prototype._renderPersonalNames=function(a,c,o){var s=false;if(a.length){var f=[];for(var p=0,e=a.length;p<e;p+=1){var v=a[p];var s,b,g,t,q;if(this.state.tmp.extension){q=["sort"]}else{if(v.isInstitution){q=this.state.opt["cite-lang-prefs"].institutions}else{q=this.state.opt["cite-lang-prefs"].persons}}slot={primary:"locale-orig",secondary:false,tertiary:false};if(q){var r=["primary","secondary","tertiary"];for(var n=0,l=r.length;n<l;n+=1){if(q.length-1<n){break}slot[r[n]]="locale-"+q[n]}}else{slot.primary="locale-translat"}if(this.state.tmp.sort_key_flag||(this.state.tmp.area!=="bibliography"&&!(this.state.tmp.area==="citation"&&this.state.opt.xclass==="note"&&this.item&&!this.item.position))){slot.secondary=false;slot.tertiary=false}this.setRenderedName(v);var u=this.getName(v,slot.primary,true);var h=this._renderOnePersonalName(u.name,c,p,o);secondary=false;if(slot.secondary){u=this.getName(v,slot.secondary,false,u.usedOrig);if(u.name){secondary=this._renderOnePersonalName(u.name,c,p,o)}}tertiary=false;if(slot.tertiary){u=this.getName(v,slot.tertiary,false,u.usedOrig);if(u.name){tertiary=this._renderOnePersonalName(u.name,c,p,o)}}var d;if(secondary||tertiary){this.state.output.openLevel("empty");this.state.output.append(h);secondary_tok=new CSL.Token();if(slot.secondary){secondary_tok.strings.prefix=this.state.opt.citeAffixes.persons[slot.secondary].prefix;secondary_tok.strings.suffix=this.state.opt.citeAffixes.persons[slot.secondary].suffix;if(!secondary_tok.strings.prefix){secondary_tok.strings.prefix=" "}}this.state.output.append(secondary,secondary_tok);tertiary_tok=new CSL.Token();if(slot.tertiary){tertiary_tok.strings.prefix=this.state.opt.citeAffixes.persons[slot.tertiary].prefix;tertiary_tok.strings.suffix=this.state.opt.citeAffixes.persons[slot.tertiary].suffix;if(!tertiary_tok.strings.prefix){tertiary_tok.strings.prefix=" "}}this.state.output.append(tertiary,tertiary_tok);this.state.output.closeLevel();d=this.state.output.pop()}else{d=h}f.push(d)}s=this.joinPersons(f,c,o)}return s};CSL.NameOutput.prototype._isRomanesque=function(c){var b=2;if(!c.family.replace('"',"","g").match(CSL.ROMANESQUE_REGEXP)){b=0}if(!b&&c.given&&c.given.match(CSL.STARTSWITH_ROMANESQUE_REGEXP)){b=1}if(b==2){if(c.multi&&c.multi.main){var a=c.multi.main.slice(0,2)}else{if(this.Item.language){a=this.Item.language.slice(0,2)}}if(["ja","zh"].indexOf(a)>-1){b=1}}return b};CSL.NameOutput.prototype._renderOnePersonalName=function(k,c,n,l){var u=k;var e=this._droppingParticle(u,c,l);var r=this._familyName(u);var p=this._nonDroppingParticle(u);var g=this._givenName(u,c,n);var b=this._nameSuffix(u);if(this._isShort(c,n)&&!u["full-form-always"]){e=false;g=false;b=false}var h=this.name.strings["sort-separator"];if(!h){h=""}var q;if(u["comma-suffix"]){q=", "}else{q=" "}var o=this._isRomanesque(u);var d=p&&p.blobs.slice(-1)==="-";var a,s,f,t;if(o===0){a=this._join([p,r,g],"")}else{if(o===1||u["static-ordering"]){a=this._join([p,r,g]," ")}else{if(u["reverse-ordering"]){a=this._join([g,p,r]," ")}else{if(this.state.tmp.sort_key_flag){if(this.state.opt["demote-non-dropping-particle"]==="never"){f=this._join([p,r,e]," ");s=this._join([f,g]," ");a=this._join([s,b]," ")}else{t=this._join([g,e,p]," ");s=this._join([r,t]," ");a=this._join([s,b]," ")}}else{if(this.name.strings["name-as-sort-order"]==="all"||(this.name.strings["name-as-sort-order"]==="first"&&n===0&&(l===0||"undefined"===typeof l))){if(["Lord","Lady"].indexOf(u.given)>-1){h=", "}if(["always","display-and-sort"].indexOf(this.state.opt["demote-non-dropping-particle"])>-1&&!d){t=this._join([g,e],(u["comma-dropping-particle"]+" "));t=this._join([t,p]," ");if(t&&this.given){t.strings.prefix=this.given.strings.prefix;t.strings.suffix=this.given.strings.suffix}if(r&&this.family){r.strings.prefix=this.family.strings.prefix;r.strings.suffix=this.family.strings.suffix}s=this._join([r,t],h);a=this._join([s,b],h)}else{if(this.state.tmp.area==="bibliography"&&!this.state.tmp.term_predecessor&&p){if(!d){p.blobs=CSL.Output.Formatters["capitalize-first"](this.state,p.blobs)}}if(d){f=this._join([p,r],"")}else{f=this._join([p,r]," ")}if(f&&this.family){f.strings.prefix=this.family.strings.prefix;f.strings.suffix=this.family.strings.suffix}t=this._join([g,e],(u["comma-dropping-particle"]+" "));if(t&&this.given){t.strings.prefix=this.given.strings.prefix;t.strings.suffix=this.given.strings.suffix}s=this._join([f,t],h);a=this._join([s,b],h)}}else{if(u["dropping-particle"]&&u.family&&!u["non-dropping-particle"]){if(["'","\u02bc","\u2019"].indexOf(u["dropping-particle"].slice(-1))>-1){r=this._join([e,r],"");e=false}}if(!this.state.tmp.term_predecessor){if(!g&&this.state.tmp.area==="bibliography"){if(!e&&p){if(!d){p.blobs=CSL.Output.Formatters["capitalize-first"](this.state,p.blobs)}}else{if(e){e.blobs=CSL.Output.Formatters["capitalize-first"](this.state,e.blobs)}}}}if(d){t=this._join([p,r],"");t=this._join([e,t]," ")}else{t=this._join([e,p,r]," ")}t=this._join([t,b],q);if(t&&this.family){t.strings.prefix=this.family.strings.prefix;t.strings.suffix=this.family.strings.suffix}if(g&&this.given){g.strings.prefix=this.given.strings.prefix;g.strings.suffix=this.given.strings.suffix}if(t.strings.prefix){u["comma-dropping-particle"]=""}a=this._join([g,t],(u["comma-dropping-particle"]+" "))}}}}}this.state.tmp.group_context.value()[2]=true;this.state.tmp.can_substitute.replace(false,CSL.LITERAL);this.state.tmp.term_predecessor=true;this.state.tmp.name_node.children.push(a);return a};CSL.NameOutput.prototype._isShort=function(b,a){if(0===this.state.tmp.disambig_settings.givens[b][a]){return true}else{return false}};CSL.NameOutput.prototype._normalizeNameInput=function(b){var a={literal:b.literal,family:b.family,isInstitution:b.isInstitution,given:b.given,suffix:b.suffix,"comma-suffix":b["comma-suffix"],"non-dropping-particle":b["non-dropping-particle"],"dropping-particle":b["dropping-particle"],"static-ordering":b["static-ordering"],"reverse-ordering":b["reverse-ordering"],"full-form-always":b["full-form-always"],"parse-names":b["parse-names"],"comma-dropping-particle":"",block_initialize:b.block_initialize,multi:b.multi};this._parseName(a);return a};CSL.NameOutput.prototype._stripPeriods=function(d,e){var c=this[d+"_decor"];if(e){if(this.state.tmp.strip_periods){e=e.replace(/\./g,"")}else{if(c){for(var b=0,a=c.decorations.length;b<a;b+=1){if("@strip-periods"===c.decorations[b][0]&&"true"===c.decorations[b][1]){e=e.replace(/\./g,"");break}}}}}return e};CSL.NameOutput.prototype._nonDroppingParticle=function(a){var c=a["non-dropping-particle"];if(c&&this.state.tmp.sort_key_flag){c=c.replace(/[\'\u2019]/,"")}var b=this._stripPeriods("family",c);if(this.state.output.append(b,this.family_decor,true)){return this.state.output.pop()}return false};CSL.NameOutput.prototype._droppingParticle=function(b,e,a){var d=b["dropping-particle"];if(d&&this.state.tmp.sort_key_flag){d=d.replace(/[\'\u2019]/,"")}var c=this._stripPeriods("given",d);if(b["dropping-particle"]&&b["dropping-particle"].match(/^et.?al[^a-z]$/)){if(this.name.strings["et-al-use-last"]){if("undefined"===typeof a){this.etal_spec[e].freeters=2}else{this.etal_spec[e].persons=2}}else{if("undefined"===typeof a){this.etal_spec[e].freeters=1}else{this.etal_spec[e].persons=1}}b["comma-dropping-particle"]=""}else{if(this.state.output.append(c,this.given_decor,true)){return this.state.output.pop()}}return false};CSL.NameOutput.prototype._familyName=function(a){var b=this._stripPeriods("family",a.family);if(this.state.output.append(b,this.family_decor,true)){return this.state.output.pop()}return false};CSL.NameOutput.prototype._givenName=function(b,f,c){if(this.name.strings.initialize===false){if(b.family&&b.given&&this.name.strings.initialize===false){b.given=CSL.Util.Names.initializeWith(this.state,b.given,this.name.strings["initialize-with"],true)}b.given=CSL.Util.Names.unInitialize(this.state,b.given)}else{if(b.family&&1===this.state.tmp.disambig_settings.givens[f][c]&&!b.block_initialize){var a=this.name.strings["initialize-with"];b.given=CSL.Util.Names.initializeWith(this.state,b.given,a)}else{b.given=CSL.Util.Names.unInitialize(this.state,b.given)}}var d=this._stripPeriods("given",b.given);var e=this.state.output.append(d,this.given_decor,true);if(e){ret=this.state.output.pop();return ret}return false};CSL.NameOutput.prototype._nameSuffix=function(b){var c=b.suffix;if("string"===typeof this.name.strings["initialize-with"]){c=CSL.Util.Names.initializeWith(this.state,b.suffix,this.name.strings["initialize-with"],true)}c=this._stripPeriods("family",c);var a="";if(c&&c.slice(-1)==="."){c=c.slice(0,-1);a="."}var d=this.state.output.append(c,"empty",true);if(d){ret=this.state.output.pop();ret.strings.suffix=a+ret.strings.suffix;return ret}return false};CSL.NameOutput.prototype._getLongStyle=function(b,a,c){var e,d;if(b["short"].length){if(this.institutionpart["long-with-short"]){e=this.institutionpart["long-with-short"]}else{e=this.institutionpart["long"]}}else{e=this.institutionpart["long"]}if(!e){e=new CSL.Token()}return e};CSL.NameOutput.prototype._getShortStyle=function(){var a;if(this.institutionpart["short"]){a=this.institutionpart["short"]}else{a=new CSL.Token()}return a};CSL.NameOutput.prototype._parseName=function(e){var c,b;if(!e["parse-names"]&&"undefined"!==typeof e["parse-names"]){return e}if(e.family&&!e.given&&e.isInstitution){e.literal=e.family;e.family=undefined;e.isInstitution=undefined}var d;if(e.family&&(e.family.slice(0,1)==='"'&&e.family.slice(-1)==='"')||(!e["parse-names"]&&"undefined"!==typeof e["parse-names"])){e.family=e.family.slice(1,-1);d=true;e["parse-names"]=0}else{d=false}if(!e["non-dropping-particle"]&&e.family&&!d&&e.given){c=e.family.match(/^((?:[\'\u2019a-z][ \'\u2019a-z]*[-\s\'\u2019]+|[ABDVL][^ ][-\s]+[a-z]*\s*|[ABDVL][^ ][^ ][-\s]+[a-z]*\s*))/);if(c){e.family=e.family.slice(c[1].length);e["non-dropping-particle"]=c[1].replace(/\s+$/,"").replace("'","\u2019")}}if(!e.suffix&&e.given){c=e.given.match(/(\s*,!*\s*)/);if(c){b=e.given.indexOf(c[1]);var a=e.given.slice(b+c[1].length);var f=e.given.slice(b,b+c[1].length).replace(/\s*/g,"");if(a.length<=3){if(f.length===2){e["comma-suffix"]=true}e.suffix=a}else{if(!e["dropping-particle"]&&e.given){e["dropping-particle"]=a;e["comma-dropping-particle"]=","}}e.given=e.given.slice(0,b)}}if(!e["dropping-particle"]&&e.given){c=e.given.match(/(\s+)([a-z][ \'\u2019a-z]*)$/);if(c){e.given=e.given.slice(0,(c[1].length+c[2].length)*-1);e["dropping-particle"]=c[2]}}};CSL.NameOutput.prototype.getName=function(b,f,e,g){if(g&&f==="locale-orig"){return{name:false,usedOrig:g}}if(!b.family){b.family=""}if(!b.given){b.given=""}var a={};a["static-ordering"]=this.getStaticOrder(b);var c=true;if(f!=="locale-orig"){c=false;if(b.multi){var d=this.state.opt[f];for(i=0,ilen=d.length;i<ilen;i+=1){j=d[i];if(b.multi._key[j]){c=true;b=b.multi._key[j];a=this.getNameParams(j);a.transliterated=true;break}}}}if(!c){var j=false;if(b.multi&&b.multi.main){j=b.multi.main}else{if(this.Item.language){j=this.Item.language}}if(j){a=this.getNameParams(j)}}if(!e&&!c){return{name:false,usedOrig:g}}if(!b.family){b.family=""}if(!b.given){b.given=""}b={family:b.family,given:b.given,"non-dropping-particle":b["non-dropping-particle"],"dropping-particle":b["dropping-particle"],suffix:b.suffix,"static-ordering":a["static-ordering"],"reverse-ordering":a["reverse-ordering"],"full-form-always":a["full-form-always"],"parse-names":b["parse-names"],"comma-suffix":b["comma-suffix"],"comma-dropping-particle":b["comma-dropping-particle"],transliterated:a.transliterated,block_initialize:a["block-initialize"],literal:b.literal,isInstitution:b.isInstitution,multi:b.multi};if(!b.literal&&(!b.given&&b.family&&b.isInstitution)){b.literal=b.family}if(b.literal){delete b.family;delete b.given}b=this._normalizeNameInput(b);var h;if(g){h=g}else{h=!c}return{name:b,usedOrig:h}};CSL.NameOutput.prototype.getNameParams=function(c){var b={};var g=CSL.localeResolve(this.Item.language,this.state.opt["default-locale"][0]);var f=this.state.locale[g.best]?g.best:this.state.opt["default-locale"][0];var e=this.state.locale[f].opts["name-as-sort-order"];var d=this.state.locale[f].opts["name-as-reverse-order"];var a=this.state.locale[f].opts["name-never-short"];var h=c.split("-")[0];if(e&&e[h]){b["static-ordering"]=true;b["reverse-ordering"]=false}if(d&&d[h]){b["reverse-ordering"]=true;b["static-ordering"]=false}if(a&&a[h]){b["full-form-always"]=true}if(b["static-ordering"]){b["block-initialize"]=true}return b};CSL.NameOutput.prototype.setRenderedName=function(c){if(this.state.tmp.area==="bibliography"){var d="";for(var b=0,a=CSL.NAME_PARTS.length;b<a;b+=1){if(c[CSL.NAME_PARTS[b]]){d+=c[CSL.NAME_PARTS[b]]}}this.state.tmp.rendered_name.push(d)}};CSL.NameOutput.prototype.fixupInstitution=function(e,c,f){if(this.state.sys.getHumanForm&&"legal_case"===this.Item.type&&"authority"===c){e.literal=this.state.sys.getHumanForm(this.Item.jurisdiction,e.literal)}e=this._splitInstitution(e,c,f);if(this.institution.strings["reverse-order"]){e["long"].reverse()}var a=e["long"];var g=a.slice();if(this.state.sys.getAbbreviation){var h=this.Item.jurisdiction;for(var d=0,b=a.length;d<b;d+=1){h=this.state.transform.loadAbbreviation(h,"institution-part",a[d]);if(this.state.transform.abbrevs[h]["institution-part"][a[d]]){g[d]=this.state.transform.abbrevs[h]["institution-part"][a[d]]}}}e["short"]=g;return e};CSL.NameOutput.prototype.getStaticOrder=function(a,b){var c=false;if(!b&&a["static-ordering"]){c=true}else{if(this._isRomanesque(a)===0){c=true}else{if((!a.multi||!a.multi.main)&&this.Item.language&&["vi","hu"].indexOf(this.Item.language)>-1){c=true}else{if(a.multi&&a.multi.main&&["vi","hu"].indexOf(a.multi.main.slice(0,2))>-1){c=true}else{if(this.state.opt["auto-vietnamese-names"]&&(CSL.VIETNAMESE_NAMES.exec(a.family+" "+a.given)&&CSL.VIETNAMESE_SPECIALS.exec(a.family+a.given))){c=true}}}}}return c};CSL.NameOutput.prototype._splitInstitution=function(o,p,g){var h={};var f=o.literal.replace(/\s*\|\s*/g,"|");f=f.split("|");if(this.institution.strings.form==="short"&&this.state.sys.getAbbreviation){var n=this.Item.jurisdiction;for(var d=f.length;d>0;d+=-1){var l=f.slice(0,d).join("|");n=this.state.transform.loadAbbreviation(n,"institution-entire",l);if(this.state.transform.abbrevs[n]["institution-entire"][l]){var e=this.state.transform.abbrevs[n]["institution-entire"][l];e=this.state.transform.quashCheck(e);var a=e.split(/>>[0-9]{4}>>/);var b=e.match(/>>([0-9]{4})>>/);e=a.pop();if(a.length>0&&this.Item["original-date"]&&this.Item["original-date"].year){for(var c=b.length-1;c>0;c+=-1){if(parseInt(this.Item["original-date"].year,10)>=parseInt(b[c],10)){break}e=a.pop()}}e=e.replace(/\s*\|\s*/g,"|");f=[e]}}}f.reverse();h["long"]=this._trimInstitution(f,p,g);return h};CSL.NameOutput.prototype._trimInstitution=function(f,c,d){var b=false;var a=false;var g=false;var e=f.slice();if(this.institution){if("undefined"!==typeof this.institution.strings["use-first"]){b=this.institution.strings["use-first"]}if("undefined"!==typeof this.institution.strings["stop-last"]){e=e.slice(0,this.institution.strings["stop-last"]);f=f.slice(0,this.institution.strings["stop-last"])}if("undefined"!==typeof this.institution.strings["use-last"]){a=this.institution.strings["use-last"]}}if(false===b){if(this.persons[c].length===0){b=this.institution.strings["substitute-use-first"]}if(!b){b=0}}if(false===a){if(!b){a=f.length}else{a=0}}if(b>f.length-a){b=f.length-a}if(g){a=0}f=f.slice(0,b);e=e.slice(b);if(a){if(a>e.length){a=e.length}if(a){f=f.concat(e.slice((e.length-a)))}}return f};CSL.PublisherOutput=function(b,a){this.state=b;this.group_tok=a;this.varlist=[]};CSL.PublisherOutput.prototype.render=function(){this.clearVars();this.composeAndBlob();this.composeElements();this.composePublishers();this.joinPublishers()};CSL.PublisherOutput.prototype.composeAndBlob=function(){this.and_blob={};var c=false;if(this.group_tok.strings.and==="text"){c=this.state.getTerm("and")}else{if(this.group_tok.strings.and==="symbol"){c="&"}}var b=new CSL.Token();b.strings.suffix=" ";b.strings.prefix=" ";this.state.output.append(c,b,true);var a=this.state.output.pop();b.strings.prefix=this.group_tok.strings["subgroup-delimiter"];this.state.output.append(c,b,true);var d=this.state.output.pop();this.and_blob.single=false;this.and_blob.multiple=false;if(c){if(this.group_tok.strings["subgroup-delimiter-precedes-last"]==="always"){this.and_blob.single=d}else{if(this.group_tok.strings["subgroup-delimiter-precedes-last"]==="never"){this.and_blob.single=a;this.and_blob.multiple=a}else{this.and_blob.single=a;this.and_blob.multiple=d}}}};CSL.PublisherOutput.prototype.composeElements=function(){for(var f=0,e=2;f<e;f+=1){var c=["publisher","publisher-place"][f];for(var d=0,a=this["publisher-list"].length;d<a;d+=1){var g=this[c+"-list"][d];var b=this[c+"-token"];this.state.output.append(g,b,true);this[c+"-list"][d]=this.state.output.pop()}}};CSL.PublisherOutput.prototype.composePublishers=function(){var d;for(var b=0,a=this["publisher-list"].length;b<a;b+=1){var c=[];d=[this[this.varlist[0]+"-list"][b],this[this.varlist[1]+"-list"][b]];this["publisher-list"][b]=this._join(d,this.group_tok.strings.delimiter)}};CSL.PublisherOutput.prototype.joinPublishers=function(){var c=this["publisher-list"];var b=this.name_delimiter;var a=this._join(c,this.group_tok.strings["subgroup-delimiter"],this.and_blob.single,this.and_blob.multiple,this.group_tok);this.state.output.append(a,"literal")};CSL.PublisherOutput.prototype._join=CSL.NameOutput.prototype._join;CSL.PublisherOutput.prototype._getToken=CSL.NameOutput.prototype._getToken;CSL.PublisherOutput.prototype.clearVars=function(){this.state.tmp["publisher-list"]=false;this.state.tmp["publisher-place-list"]=false;this.state.tmp["publisher-group-token"]=false;this.state.tmp["publisher-token"]=false;this.state.tmp["publisher-place-token"]=false};CSL.evaluateLabel=function(d,f,b,c){var e;if("locator"===d.strings.term){if(c&&c.label){if(c.label==="sub verbo"){e="sub-verbo"}else{e=c.label}}if(!e){e="page"}}else{e=d.strings.term}var a=d.strings.plural;if(c&&"number"===typeof c.force_pluralism){a=c.force_pluralism}else{if("number"!==typeof a){if("locator"===d.strings.term){if(c&&c.locator){if(f.opt.development_extensions.locator_parsing_for_plurals){if(!f.tmp.shadow_numbers.locator){f.processNumber(false,c,"locator",b.type)}a=f.tmp.shadow_numbers.locator.plural}else{a=CSL.evaluateStringPluralism(c.locator)}}}else{if(["page","page-first"].indexOf(d.variables[0])>-1){f.processNumber(false,b,e,b.type);a=f.tmp.shadow_numbers[e].plural;e=f.tmp.shadow_numbers[e].label}else{if(!f.tmp.shadow_numbers[e]){f.processNumber(false,b,e,b.type)}a=f.tmp.shadow_numbers[e].plural}}if(d.decorations&&(f.opt.development_extensions.csl_reverse_lookup_support||f.sys.csl_reverse_lookup_support)){d.decorations.reverse();d.decorations.push(["@showid","true",d.cslid]);d.decorations.reverse()}}}return CSL.castLabel(f,d,e,a,CSL.TOLERANT)};CSL.evaluateStringPluralism=function(b){if(b){var a=b.match(/(?:[0-9],\s*[0-9]|\s+and\s+|&|([0-9]+)\s*[\-\u2013]\s*([0-9]+))/);if(a&&(!a[1]||parseInt(a[1],10)<parseInt(a[2],10))){return 1}}return 0};CSL.castLabel=function(a,c,d,j,f){var g=c.strings.form;if(a.tmp.group_context.value()[5]){g=a.tmp.group_context.value()[5]}var h=a.getTerm(d,g,j,false,f);if(a.tmp.strip_periods){h=h.replace(/\./g,"")}else{for(var e=0,b=c.decorations.length;e<b;e+=1){if("@strip-periods"===c.decorations[e][0]&&"true"===c.decorations[e][1]){h=h.replace(/\./g,"");break}}}return h};CSL.Node.name={build:function(d,e){var b,f,a,c;if([CSL.SINGLETON,CSL.START].indexOf(this.tokentype)>-1){d.fixOpt(this,"name-delimiter","name_delimiter");d.fixOpt(this,"name-form","form");d.fixOpt(this,"and","and");d.fixOpt(this,"delimiter-precedes-last","delimiter-precedes-last");d.fixOpt(this,"delimiter-precedes-et-al","delimiter-precedes-et-al");d.fixOpt(this,"initialize-with","initialize-with");d.fixOpt(this,"initialize","initialize");d.fixOpt(this,"name-as-sort-order","name-as-sort-order");d.fixOpt(this,"sort-separator","sort-separator");d.fixOpt(this,"and","and");d.fixOpt(this,"et-al-min","et-al-min");d.fixOpt(this,"et-al-use-first","et-al-use-first");d.fixOpt(this,"et-al-use-last","et-al-use-last");d.fixOpt(this,"et-al-subsequent-min","et-al-subsequent-min");d.fixOpt(this,"et-al-subsequent-use-first","et-al-subsequent-use-first");if(this.strings["et-al-subsequent-min"]&&(this.strings["et-al-subsequent-min"]!==this.strings["et-al-min"])){d.opt.update_mode=CSL.POSITION}if(this.strings["et-al-subsequent-use-first"]&&(this.strings["et-al-subsequent-use-first"]!==this.strings["et-al-use-first"])){d.opt.update_mode=CSL.POSITION}if("undefined"==typeof this.strings.name_delimiter){this.strings.delimiter=", "}else{this.strings.delimiter=this.strings.name_delimiter}if(this.strings["et-al-use-last"]){this.ellipsis_term="\u2026";this.ellipsis_prefix_single=" ";this.ellipsis_prefix_multiple=this.strings.delimiter;this.ellipsis_suffix=" "}b=function(h,g){h.tmp.etal_term="et-al";h.tmp.name_delimiter=this.strings.delimiter;h.tmp["delimiter-precedes-et-al"]=this.strings["delimiter-precedes-et-al"];if("text"===this.strings.and){this.and_term=h.getTerm("and","long",0)}else{if("symbol"===this.strings.and){if(h.opt.development_extensions.expect_and_symbol_form){this.and_term=h.getTerm("and","symbol",0)}else{this.and_term="&"}}}h.tmp.and_term=this.and_term;if(CSL.STARTSWITH_ROMANESQUE_REGEXP.test(this.and_term)){this.and_prefix_single=" ";this.and_prefix_multiple=", ";if("string"===typeof this.strings.delimiter){this.and_prefix_multiple=this.strings.delimiter}this.and_suffix=" ";h.build.name_delimiter=this.strings.delimiter}else{this.and_prefix_single="";this.and_prefix_multiple="";this.and_suffix=""}if(this.strings["delimiter-precedes-last"]==="always"){this.and_prefix_single=this.strings.delimiter}else{if(this.strings["delimiter-precedes-last"]==="never"){if(this.and_prefix_multiple){this.and_prefix_multiple=" "}}else{if(this.strings["delimiter-precedes-last"]==="after-inverted-name"){if(this.and_prefix_single){this.and_prefix_single=this.strings.delimiter}if(this.and_prefix_multiple){this.and_prefix_multiple=" "}}}}this.and={};if(this.strings.and){h.output.append(this.and_term,"empty",true);this.and.single=h.output.pop();this.and.single.strings.prefix=this.and_prefix_single;this.and.single.strings.suffix=this.and_suffix;h.output.append(this.and_term,"empty",true);this.and.multiple=h.output.pop();this.and.multiple.strings.prefix=this.and_prefix_multiple;this.and.multiple.strings.suffix=this.and_suffix}else{if(this.strings.delimiter){this.and.single=new CSL.Blob(this.strings.delimiter);this.and.single.strings.prefix="";this.and.single.strings.suffix="";this.and.multiple=new CSL.Blob(this.strings.delimiter);this.and.multiple.strings.prefix="";this.and.multiple.strings.suffix=""}}this.ellipsis={};if(this.strings["et-al-use-last"]){this.ellipsis.single=new CSL.Blob(this.ellipsis_term);this.ellipsis.single.strings.prefix=this.ellipsis_prefix_single;this.ellipsis.single.strings.suffix=this.ellipsis_suffix;this.ellipsis.multiple=new CSL.Blob(this.ellipsis_term);this.ellipsis.multiple.strings.prefix=this.ellipsis_prefix_multiple;this.ellipsis.multiple.strings.suffix=this.ellipsis_suffix}if("undefined"===typeof h.tmp["et-al-min"]){h.tmp["et-al-min"]=this.strings["et-al-min"]}if("undefined"===typeof h.tmp["et-al-use-first"]){h.tmp["et-al-use-first"]=this.strings["et-al-use-first"]}if("undefined"===typeof h.tmp["et-al-use-last"]){h.tmp["et-al-use-last"]=this.strings["et-al-use-last"]}h.nameOutput.name=this};d.build.name_flag=true;this.execs.push(b)}e.push(this)}};CSL.Node["name-part"]={build:function(a,b){a.build[this.strings.name]=this}};CSL.Node.names={build:function(a,j){var d,h,k,e;var b=false;if(this.tokentype===CSL.START||this.tokentype===CSL.SINGLETON){CSL.Util.substituteStart.call(this,a,j);a.build.substitute_level.push(1);a.fixOpt(this,"names-delimiter","delimiter")}if(this.tokentype===CSL.SINGLETON){a.build.names_variables.push(this.variables);for(var g=0,c=this.variables.length;g<c;g+=1){a.build.name_label[this.variables[g]]=a.build.name_label[a.build.names_variables.slice(0)[0]]}d=function(r,p,q){r.nameOutput.reinit(this)};this.execs.push(d)}if(this.tokentype===CSL.START){a.build.names_flag=true;a.build.names_level+=1;if(a.build.names_level===1){a.build.names_variables=[];a.build.name_label={}}a.build.names_variables.push(this.variables);d=function(r,p,q){r.tmp.can_substitute.push(true);r.parallel.StartVariable("names",this.variables[0]);r.nameOutput.init(this)};this.execs.push(d)}if(this.tokentype===CSL.END){for(var g=0,c=3;g<c;g+=1){var n=["family","given","et-al"][g];this[n]=a.build[n];if(a.build.names_level===1){a.build[n]=undefined}}this.label=a.build.name_label;if(a.build.names_level===1){a.build.name_label={}}a.build.names_level+=-1;a.build.names_variables.pop();var l="with";var f="";var o="";if(CSL.STARTSWITH_ROMANESQUE_REGEXP.test(l)){f=" ";o=" "}this["with"]={};this["with"].single=new CSL.Blob(l);this["with"].single.strings.suffix=o;this["with"].multiple=new CSL.Blob(l);this["with"].multiple.strings.suffix=o;if(this.strings["delimiter-precedes-last"]==="always"){this["with"].single.strings.prefix=this.strings.delimiter;this["with"].multiple.strings.prefix=this.strings.delimiter}else{if(this.strings["delimiter-precedes-last"]==="contextual"){this["with"].single.strings.prefix=f;this["with"].multiple.strings.prefix=this.strings.delimiter}else{if(this.strings["delimiter-precedes-last"]==="after-inverted-name"){this["with"].single.strings.prefix=this.strings.delimiter;this["with"].multiple.strings.prefix=f}else{this["with"].single.strings.prefix=f;this["with"].multiple.strings.prefix=f}}}d=function(u,p,t){if(u.tmp.etal_node){this.etal_style=u.tmp.etal_node}else{this.etal_style="empty"}this.etal_term=u.getTerm(u.tmp.etal_term,"long",0);if(CSL.STARTSWITH_ROMANESQUE_REGEXP.test(this.etal_term)){this.etal_prefix_single=" ";this.etal_prefix_multiple=u.tmp.name_delimiter;if(u.tmp["delimiter-precedes-et-al"]==="always"){this.etal_prefix_single=u.tmp.name_delimiter}else{if(u.tmp["delimiter-precedes-et-al"]==="never"){this.etal_prefix_multiple=" "}else{if(u.tmp["delimiter-precedes-et-al"]==="after-inverted-name"){this.etal_prefix_single=u.tmp.name_delimiter;this.etal_prefix_multiple=" "}}}this.etal_suffix=""}else{this.etal_prefix_single="";this.etal_prefix_multiple="";this.etal_suffix=""}for(var s=0,r=3;s<r;s+=1){var q=["family","given"][s];u.nameOutput[q]=this[q]}u.nameOutput["with"]=this["with"];u.nameOutput.label=this.label;u.nameOutput.etal_style=this.etal_style;u.nameOutput.etal_term=this.etal_term;u.nameOutput.etal_prefix_single=this.etal_prefix_single;u.nameOutput.etal_prefix_multiple=this.etal_prefix_multiple;u.nameOutput.etal_suffix=this.etal_suffix;u.nameOutput.outputNames();u.tmp["et-al-use-first"]=undefined;u.tmp["et-al-min"]=undefined;u.tmp["et-al-use-last"]=undefined};this.execs.push(d);d=function(q,p){if(!q.tmp.can_substitute.pop()){q.tmp.can_substitute.replace(false,CSL.LITERAL)}q.parallel.CloseVariable("names");if(q.tmp.can_substitute.mystack.length===1){q.tmp.can_block_substitute=false}};this.execs.push(d);a.build.name_flag=false}j.push(this);if(this.tokentype===CSL.END||this.tokentype===CSL.SINGLETON){a.build.substitute_level.pop();CSL.Util.substituteEnd.call(this,a,j)}}};CSL.Node.number={build:function(b,c){var a;CSL.Util.substituteStart.call(this,b,c);if(this.strings.form==="roman"){this.formatter=b.fun.romanizer}else{if(this.strings.form==="ordinal"){this.formatter=b.fun.ordinalizer}else{if(this.strings.form==="long-ordinal"){this.formatter=b.fun.long_ordinalizer}}}if("undefined"===typeof this.successor_prefix){this.successor_prefix=b[b.build.area].opt.layout_delimiter}if("undefined"===typeof this.splice_prefix){this.splice_prefix=b[b.build.area].opt.layout_delimiter}a=function(p,n,C){var B,s,E,r;if(this.variables.length===0){return}if("undefined"===typeof C){var C={}}var f,q,g,z,A,u;f=this.variables[0];if(f==="locator"&&p.tmp.just_looking){return}p.parallel.StartVariable(this.variables[0]);if(this.variables[0]==="locator"){p.parallel.AppendToVariable(n.section)}else{p.parallel.AppendToVariable(n[this.variables[0]])}var D=new RegExp("(?:&|, | and |"+p.getTerm("page-range-delimiter")+")");if(f==="collection-number"&&n.type==="legal_case"){p.tmp.renders_collection_number=true}var y=n[this.variables[0]];var h="long";if(this.strings.label_form_override){h=this.strings.label_form_override}if(f==="locator"&&C.locator){C.locator=C.locator.replace(/([^\\])\s*-\s*/,"$1"+p.getTerm("page-range-delimiter"));z=C.locator.match(CSL.STATUTE_SUBDIV_GROUPED_REGEX);if(z){r=C.locator.split(CSL.STATUTE_SUBDIV_PLAIN_REGEX);for(B=0,s=r.length;B<s;B+=1){r[B]=p.fun.page_mangler(r[B])}E=[r[0]];if(!this.strings.label_form_override&&p.tmp.group_context.value()[5]){h=p.tmp.group_context.value()[5]}for(B=1,s=r.length;B<s;B+=1){var t=0;if(r[B].match(D)){t=1}var w=CSL.STATUTE_SUBDIV_STRINGS[z[B-1].replace(/^\s*/,"")];var l=h;if(C.section_label_count>B&&C.section_form_override){l=C.section_form_override}E.push(p.getTerm(w,l,t));E.push(r[B].replace(/^\s*/,""))}y=E.join(" ");y=y.replace(/\\/,"","g");p.output.append(y,this)}else{y=p.fun.page_mangler(C.locator);y=y.replace(/\\/,"","g");p.output.append(y,this)}}else{var x=this;if(!p.tmp.shadow_numbers[f]||(p.tmp.shadow_numbers[f].values.length&&p.tmp.shadow_numbers[f].values[0][2]===false)){if(f==="locator"){p.processNumber(x,C,f,n.type)}else{p.processNumber(x,n,f,n.type)}}var k=p.tmp.shadow_numbers[f].values;var e;var o="";var d="page";if(["bill","gazette","legislation","legal_case","treaty"].indexOf(n.type)>-1&&f==="collection-number"){d="year"}if(((f==="number"&&["bill","gazette","legislation","treaty"].indexOf(n.type)>-1)||p.opt[d+"-range-format"])&&!this.strings.prefix&&!this.strings.suffix&&!this.strings.form){for(B=0,s=k.length;B<s;B+=1){o+=k[B][1]}}if(o&&!o.match(/^[\-.\u20130-9]+$/)){if(f==="number"&&["bill","gazette","legislation","treaty"].indexOf(n.type)>-1){var v=o.split(/\s/)[0];if(v){E=[];z=o.match(CSL.STATUTE_SUBDIV_GROUPED_REGEX);if(z){r=o.split(CSL.STATUTE_SUBDIV_PLAIN_REGEX);for(B=1,s=r.length;B<s;B+=1){E.push(p.getTerm(CSL.STATUTE_SUBDIV_STRINGS[z[B-1].replace(/^\s+/,"")],this.strings.label_form_override));E.push(r[B].replace(/^\s+/,""))}o=E.join(" ")}}}p.output.append(o,this)}else{if(k.length){p.output.openLevel("empty");for(B=0,s=k.length;B<s;B+=1){e=new CSL[k[B][0]](k[B][1],k[B][2],n.id);if(B>0){e.strings.prefix=e.strings.prefix.replace(/^\s*/,"")}if(B<k.length-1){e.strings.suffix=e.strings.suffix.replace(/\s*$/,"")}if("undefined"===typeof e.gender){e.gender=p.locale[p.opt.lang]["noun-genders"][f]}p.output.append(e,"literal",false,false,true)}p.output.closeLevel("empty")}}}if(f==="locator"){p.tmp.done_vars.push("locator")}p.parallel.CloseVariable("number")};this.execs.push(a);c.push(this);CSL.Util.substituteEnd.call(this,b,c)}};CSL.Node.sort={build:function(b,c){c=b[b.build.root+"_sort"].tokens;if(this.tokentype===CSL.START){if(b.build.area==="citation"){b.parallel.use_parallels=false;b.opt.sort_citations=true}b.build.area=b.build.root+"_sort";b.build.extension="_sort";var a=function(j,e){if(j.opt.has_layout_locale){var k=CSL.localeResolve(e.language,j.opt["default-locale"][0]);var h=j[j.tmp.area.slice(0,-5)].opt.sort_locales;var d;for(var g=0,f=h.length;g<f;g+=1){d=h[g][k.bare];if(!d){d=h[g][k.best]}if(d){break}}if(!d){d=j.opt["default-locale"][0]}j.tmp.lang_sort_hold=j.opt.lang;j.opt.lang=d}};this.execs.push(a)}if(this.tokentype===CSL.END){b.build.area=b.build.root;b.build.extension="";var a=function(e,d){if(e.opt.has_layout_locale){e.opt.lang=e.tmp.lang_sort_hold;delete e.tmp.lang_sort_hold}};this.execs.push(a)}c.push(this)}};CSL.Node.substitute={build:function(b,c){var a;if(this.tokentype===CSL.START){a=function(e,d){e.tmp.can_block_substitute=true;if(e.tmp.value.length){e.tmp.can_substitute.replace(false,CSL.LITERAL)}};this.execs.push(a)}c.push(this)}};CSL.Node.text={build:function(e,F){var z,f,c,q,s,j,b,C,h,l,k,a,p,G,o,d,t,v,D,g,u,x,w,B;if(this.postponed_macro){return CSL.expandMacro.call(e,this)}else{CSL.Util.substituteStart.call(this,e,F);if(!this.variables_real){this.variables_real=[]}if(!this.variables){this.variables=[]}c="long";q=0;if(this.strings.form){c=this.strings.form}if(this.strings.plural){q=this.strings.plural}if("citation-number"===this.variables_real[0]||"year-suffix"===this.variables_real[0]||"citation-label"===this.variables_real[0]){if(this.variables_real[0]==="citation-number"){if(e.build.root==="citation"){e.opt.update_mode=CSL.NUMERIC}if(e.build.root==="bibliography"){e.opt.bib_mode=CSL.NUMERIC}if(e.build.area==="bibliography_sort"){e.opt.citation_number_sort_used=true}if("citation-number"===e[e.tmp.area].opt.collapse){this.range_prefix=e.getTerm("citation-range-delimiter")}this.successor_prefix=e[e.build.area].opt.layout_delimiter;this.splice_prefix=e[e.build.area].opt.layout_delimiter;f=function(I,n,H){s=""+n.id;if(!I.tmp.just_looking){if(H&&H["author-only"]){I.tmp.element_trace.replace("do-not-suppress-me");var J=I.getTerm("reference","long","singular");if("undefined"===typeof J){J="reference"}t=CSL.Output.Formatters["capitalize-first"](I,J);I.output.append(t+" ");I.tmp.last_element_trace=true}if(H&&H["suppress-author"]){if(I.tmp.last_element_trace){I.tmp.element_trace.replace("suppress-me")}I.tmp.last_element_trace=false}j=I.registry.registry[s].seq;if(I.opt.citation_number_slug){I.output.append(I.opt.citation_number_slug,this)}else{b=new CSL.NumericBlob(j,this,n.id);I.output.append(b,"literal")}}};this.execs.push(f)}else{if(this.variables_real[0]==="year-suffix"){e.opt.has_year_suffix=true;if(e[e.tmp.area].opt.collapse==="year-suffix-ranged"){this.range_prefix=e.getTerm("citation-range-delimiter")}this.successor_prefix=e[e.build.area].opt.layout_delimiter;if(e[e.tmp.area].opt["year-suffix-delimiter"]){this.successor_prefix=e[e.build.area].opt["year-suffix-delimiter"]}f=function(H,n){if(H.registry.registry[n.id]&&H.registry.registry[n.id].disambig.year_suffix!==false&&!H.tmp.just_looking){j=parseInt(H.registry.registry[n.id].disambig.year_suffix,10);b=new CSL.NumericBlob(j,this,n.id);C=new CSL.Util.Suffixator(CSL.SUFFIX_CHARS);b.setFormatter(C);H.output.append(b,"literal");h=false;D=H.tmp.group_context.mystack.length;for(g=0;g<D;g+=1){B=H.tmp.group_context.mystack[g];if(!B[2]&&(B[1]||(!B[1]&&!B[0]))){h=true;break}}l=H[H.tmp.area].opt["year-suffix-delimiter"];if(h&&l&&!H.tmp.sort_key_flag){H.tmp.splice_delimiter=H[H.tmp.area].opt["year-suffix-delimiter"]}}};this.execs.push(f)}else{if(this.variables_real[0]==="citation-label"){e.opt.has_year_suffix=true;f=function(H,n){k=n["citation-label"];if(!k){k=H.getCitationLabel(n)}if(!H.tmp.just_looking){d="";if(H.registry.registry[n.id]&&H.registry.registry[n.id].disambig.year_suffix!==false){j=parseInt(H.registry.registry[n.id].disambig.year_suffix,10);d=H.fun.suffixator.format(j)}k+=d}H.output.append(k,this)};this.execs.push(f)}}}}else{if(this.strings.term){f=function(N,n,L){var K=N.opt.gender[n.type];var J=this.strings.term;J=N.getTerm(J,c,q,K,false,("accessed"===J));var M;if(J!==""){B=N.tmp.group_context.value();B[0]=true;N.tmp.group_context.replace(B)}if(!N.tmp.term_predecessor&&!(N.opt["class"]==="in-text"&&N.tmp.area==="citation")){M=CSL.Output.Formatters["capitalize-first"](N,J)}else{M=J}if(N.tmp.strip_periods){M=M.replace(/\./g,"")}else{for(var I=0,H=this.decorations.length;I<H;I+=1){if("@strip-periods"===this.decorations[I][0]&&"true"===this.decorations[I][1]){M=M.replace(/\./g,"");break}}}N.output.append(M,this)};this.execs.push(f);e.build.term=false;e.build.form=false;e.build.plural=false}else{if(this.variables_real.length){f=function(J,H,I){var n=this.variables[0];if(n==="title"&&(c==="short"||H["title-short"])){n="title-short"}J.parallel.StartVariable(n);J.parallel.AppendToVariable(H[n],n)};this.execs.push(f);if(CSL.MULTI_FIELDS.indexOf(this.variables_real[0])>-1){var E=this.variables[0];var A=false;var r=false;var y=false;if(c==="short"){if(this.variables_real[0]==="container-title"){r="journalAbbreviation"}else{if(this.variables_real[0]==="title"){r="title-short"}}}else{E=false}if(e.build.extension){y=true}else{y=true;A=true}f=e.transform.getOutputFunction(this.variables,E,A,r,y)}else{if(CSL.CITE_FIELDS.indexOf(this.variables_real[0])>-1){f=function(J,n,H){if(H&&H[this.variables[0]]){var I=""+H[this.variables[0]];I=I.replace(/([^\\])--*/g,"$1"+J.getTerm("page-range-delimiter"));I=I.replace(/\\-/g,"-");J.output.append(I,this,false,false,true);if(this.variables[0]==="locator-revision"){J.tmp.done_vars.push("locator-revision")}}}}else{if(this.variables_real[0]==="page-first"){f=function(J,H){var n,I;I=J.getVariable(H,"page-first",c);if(I){I=I.replace("\\","");J.output.append(I,this,false,false,true)}}}else{if(this.variables_real[0]==="page"){f=function(I,n){var H=I.getVariable(n,"page",c);if(H){H=""+H;H=H.replace(/([^\\])--*/g,"$1"+I.getTerm("page-range-delimiter"));H=H.replace(/\\-/g,"-");H=I.fun.page_mangler(H);I.output.append(H,this,false,false,true)}}}else{if(this.variables_real[0]==="volume"){f=function(I,n){if(this.variables[0]){var H=I.getVariable(n,this.variables[0],c);if(H){I.output.append(H,this)}}}}else{if(["URL","DOI"].indexOf(this.variables_real[0])>-1){f=function(I,n){var H;if(this.variables[0]){H=I.getVariable(n,this.variables[0],c);if(H){if(I.opt.development_extensions.wrap_url_and_doi){if(!this.decorations.length||this.decorations[0][0]!=="@"+this.variables[0]){this.decorations=[["@"+this.variables[0],"true"]].concat(this.decorations)}}else{if(this.decorations.length&&this.decorations[0][0]==="@"+this.variables[0]){this.decorations=this.decorations.slice(1)}}I.output.append(H,this,false,false,true)}}}}else{if(this.variables_real[0]==="section"){f=function(I,n){var H;H=I.getVariable(n,this.variables[0],c);if(H){I.output.append(H,this)}}}else{if(this.variables_real[0]==="hereinafter"){f=function(I,n){var H=I.transform.abbrevs["default"]["hereinafter"][n.id];if(H){I.output.append(H,this);I.tmp.group_context.value()[2]=true}}}else{f=function(I,n){var H;if(this.variables[0]){H=I.getVariable(n,this.variables[0],c);if(H){H=""+H;H=H.replace("\\","","g");I.output.append(H,this)}}}}}}}}}}}this.execs.push(f);f=function(H,n){H.parallel.CloseVariable("text")};this.execs.push(f)}else{if(this.strings.value){f=function(I,H){var n;n=I.tmp.group_context.value();n[0]=true;I.tmp.group_context.replace(n);I.output.append(this.strings.value,this)};this.execs.push(f)}}}}F.push(this);CSL.Util.substituteEnd.call(this,e,F)}}};CSL.Attributes={};CSL.Attributes["@genre"]=function(c,a){a=a.replace("-"," ");var b=function(e,f){var d;if(a===e.genre){return true}return false};this.tests.push(b)};CSL.Attributes["@disambiguate"]=function(c,a){if(a==="true"){c.opt.has_disambiguate=true;var b=function(d,e){c.tmp.disambiguate_maxMax+=1;if(c.tmp.disambig_settings.disambiguate&&c.tmp.disambiguate_count<c.tmp.disambig_settings.disambiguate){c.tmp.disambiguate_count+=1;return true}return false};this.tests.push(b)}else{if(a==="check-ambiguity-and-backreference"){var b=function(d,e){if(c.registry.registry[d.id].disambig.disambiguate&&c.registry.registry[d.id]["citation-count"]>1){return true}return false};this.tests.push(b)}}};CSL.Attributes["@is-numeric"]=function(d,a,c){var f=a.split(/\s+/);var e=function(g){return function(h,j){var k=h;if(["locator","locator-revision"].indexOf(g)>-1){k=j}if("undefined"===typeof k){return false}if(CSL.NUMERIC_VARIABLES.indexOf(g)>-1){if(!d.tmp.shadow_numbers[g]){d.processNumber(false,k,g,h.type)}if(k[g]&&d.tmp.shadow_numbers[g].numeric){return true}}else{if(["title","locator-revision","version"].indexOf(g)>-1){if(k[g]){if(k[g].slice(-1)===""+parseInt(k[g].slice(-1),10)){return true}}}}return false}};for(var b=0;b<f.length;b+=1){this.tests.push(e(f[b]))}};CSL.Attributes["@is-uncertain-date"]=function(d,a){var f=a.split(/\s+/);var e=function(g){return function(h,j){if(h[g]&&h[g].circa){return true}else{return false}}};for(var c=0,b=f.length;c<b;c+=1){this.tests.push(e(f[c]))}};CSL.Attributes["@locator"]=function(d,a){var f=a.replace("sub verbo","sub-verbo");f=f.split(/\s+/);var e=function(g){return function(j,k){var h;if("undefined"===typeof k||!k.label){h="page"}else{if(k.label==="sub verbo"){h="sub-verbo"}else{h=k.label}}if(g===h){return true}else{return false}}};for(var c=0,b=f.length;c<b;c+=1){this.tests.push(e(f[c]))}};CSL.Attributes["@position"]=function(f,a){var c;f.opt.update_mode=CSL.POSITION;f.parallel.use_parallels=true;var b=a.split(/\s+/);var g=function(h){return function(j,k){if(f.tmp.area==="bibliography"){return false}if(k&&"undefined"===typeof k.position){k.position=0}if(k&&typeof k.position==="number"){if(k.position===0&&h===0){return true}else{if(h>0&&k.position>=h){return true}}}else{if(h===0){return true}}return false}};for(var e=0,d=b.length;e<d;e+=1){var c=b[e];if(c==="first"){c=CSL.POSITION_FIRST}else{if(c==="subsequent"){c=CSL.POSITION_SUBSEQUENT}else{if(c==="ibid"){c=CSL.POSITION_IBID}else{if(c==="ibid-with-locator"){c=CSL.POSITION_IBID_WITH_LOCATOR}}}}if("near-note"===c){this.tests.push(function(h,j){if(j&&j.position>=CSL.POSITION_SUBSEQUENT&&j["near-note"]){return true}return false})}else{this.tests.push(g(c))}}};CSL.Attributes["@type"]=function(f,a){var d=a.split(/\s+/);var g=function(h){return function(k,l){var j=(k.type===h);if(j){return true}else{return false}}};var e=[];for(var c=0,b=d.length;c<b;c+=1){e.push(g(d[c]))}this.tests.push(f.fun.match.any(this,f,e))};CSL.Attributes["@variable"]=function(e,a){var d;this.variables=a.split(/\s+/);this.variables_real=this.variables.slice();if("label"===this.name&&this.variables[0]){this.strings.term=this.variables[0]}else{if(["names","date","text","number"].indexOf(this.name)>-1){d=function(k,g,j){variables=this.variables_real.slice();for(var h=this.variables.length-1;h>-1;h+=-1){this.variables.pop()}len=variables.length;for(pos=0;pos<len;pos+=1){if(k.tmp.done_vars.indexOf(variables[pos])===-1&&!(j&&g.type==="legal_case"&&j["suppress-author"]&&variables[pos]==="title")){this.variables.push(variables[pos])}if(k.tmp.can_block_substitute){k.tmp.done_vars.push(variables[pos])}}};this.execs.push(d);d=function(o,g,n){var l;output=false;len=this.variables.length;for(pos=0;pos<len;pos+=1){variable=this.variables[pos];if(variable==="authority"&&"string"===typeof g[variable]&&"names"===this.name){var k={family:g[variable],isInstitution:true,multi:{_key:{}}};if(g.multi&&g.multi._keys&&g.multi._keys[variable]){for(var j in g.multi._keys[variable]){creatorChild={family:g.multi._keys[variable][j],isInstitution:true};k.multi._key[j]=creatorChild}}g[variable]=[k]}if(this.strings.form==="short"&&!g[variable]){if(variable==="title"){variable="title-short"}else{if(variable==="container-title"){variable="journalAbbreviation"}}}if(variable==="year-suffix"){output=true;break}else{if(CSL.DATE_VARIABLES.indexOf(variable)>-1){if(o.opt.development_extensions.locator_date_and_revision&&"locator-date"===variable){output=true;break}if(g[variable]){for(var h in g[variable]){if(this.dateparts.indexOf(h)===-1&&"literal"!==h){continue}if(g[variable][h]){output=true;break}}if(output){break}}}else{if("locator"===variable){if(n&&n.locator){output=true}break}else{if("locator-revision"===variable){if(n&&n["locator-revision"]){output=true}break}else{if(["citation-number","citation-label"].indexOf(variable)>-1){output=true;break}else{if("first-reference-note-number"===variable){if(n&&n["first-reference-note-number"]){output=true}break}else{if("hereinafter"===variable){if(o.transform.abbrevs["default"].hereinafter[g.id]&&o.sys.getAbbreviation&&g.id){output=true}break}else{if("object"===typeof g[variable]){if(g[variable].length){}break}else{if("string"===typeof g[variable]&&g[variable]){output=true;break}else{if("number"===typeof g[variable]){output=true;break}}}}}}}}}}if(output){break}}flag=o.tmp.group_context.value();if(output){if(variable!=="citation-number"||o.tmp.area!=="bibliography"){o.tmp.cite_renders_content=true}flag[2]=true;o.tmp.group_context.replace(flag);if(o.tmp.can_substitute.value()&&o.tmp.area==="bibliography"&&"string"===typeof g[variable]){o.tmp.rendered_name.push(g[variable])}o.tmp.can_substitute.replace(false,CSL.LITERAL)}else{flag[1]=true}};this.execs.push(d)}else{if(["if","else-if","condition"].indexOf(this.name)>-1){var f=function(g){return function(h,j){var k=h;if(j&&["locator","locator-revision","first-reference-note-number","locator-date"].indexOf(g)>-1){k=j}if(g==="hereinafter"&&e.sys.getAbbreviation&&k.id){if(e.transform.abbrevs["default"].hereinafter[k.id]){return true}}else{if(k[g]){if("number"===typeof k[g]||"string"===typeof k[g]){return true}else{if("object"===typeof k[g]){for(key in k[g]){if(k[g][key]){return true}}}}}}return false}};for(var c=0,b=this.variables.length;c<b;c+=1){this.tests.push(f(this.variables[c]))}}}}};CSL.Attributes["@page"]=function(d,a){var f=a.replace("sub verbo","sub-verbo");f=f.split(/\s+/);var e=function(g){return function(j,k){var h;d.processNumber(false,j,"page",j.type);if(!d.tmp.shadow_numbers.page.label){h="page"}else{if(d.tmp.shadow_numbers.page.label==="sub verbo"){h="sub-verbo"}else{h=d.tmp.shadow_numbers.page.label}}if(g===h){return true}else{return false}}};for(var c=0,b=f.length;c<b;c+=1){this.tests.push(e(f[c]))}};CSL.Attributes["@jurisdiction"]=function(e,a){var b=a.split(/\s+/);for(var d=0,c=b.length;d<c;d+=1){b[d]=b[d].split(";")}var g=function(h){return function(l,p){if(!l.jurisdiction){return false}var k=l.jurisdiction.split(";");for(var o=0,n=k.length;o<n;o+=1){k[o]=k[o].split(";")}for(o=h.length;o>0;o+=-1){var j=h.slice(0,o).join(";");var q=k.slice(0,o).join(";");if(j!==q){return false}}return true}};for(var d=0,c=b.length;d<c;d+=1){var f=b[d].slice();this.tests.push(g(f))}};CSL.Attributes["@context"]=function(c,a){var b=function(d,f){var e=c.tmp.area.slice(0,a.length);if(e===a){return true}return false};this.tests.push(b)};CSL.Attributes["@has-year-only"]=function(e,a){var b=a.split(/\s+/);var f=function(g){return function(j,k){var h=j[g];if(!h||h.month||h.season){return false}else{return true}}};for(var d=0,c=b.length;d<c;d+=1){this.tests.push(f(b[d]))}};CSL.Attributes["@has-to-month-or-season"]=function(e,a){var b=a.split(/\s+/);var f=function(g){return function(j,k){var h=j[g];if(!h||(!h.month&&!h.season)||h.day){return false}else{return true}}};for(var d=0,c=b.length;d<c;d+=1){this.tests.push(f(b[d]))}};CSL.Attributes["@has-day"]=function(e,a){var b=a.split(/\s+/);var f=function(g){return function(j,k){var h=j[g];if(!h||!h.day){return false}else{return true}}};for(var d=0,c=b.length;d<c;d+=1){this.tests.push(f(b[d]))}};CSL.Attributes["@subjurisdictions"]=function(d,a){var c=parseInt(a,10);var b=function(e,g){var f=0;if(e.jurisdiction){f=e.jurisdiction.split(";").length}if(f){f+=-1}if(f>=c){return true}return false};this.tests.push(b)};CSL.Attributes["@is-plural"]=function(c,a){var b=function(e,j){var l=e[a];if(l&&l.length){var k=0;var h=0;var d=false;for(var g=0,f=l.length;g<f;g+=1){if(l[g].isInstitution&&(l[g].literal||(l[g].family&&!l[g].given))){h+=1;d=false}else{k+=1;d=true}}if(k>1){return true}else{if(h>1){return true}else{if(h&&d){return true}}}}return false};this.tests.push(b)};CSL.Attributes["@locale"]=function(c,e){var d,w,s,g,q,u,a,x,l,r,n,p;var b=c.opt["default-locale"][0];if(this.name==="layout"){this.locale_raw=e;if(this.tokentype===CSL.START){var h=e.split(/\s+/);var t={};var f=CSL.localeResolve(h[0],b);if(f.generic){t[f.generic]=f.best}else{t[f.best]=f.best}for(var r=1,n=h.length;r<n;r+=1){var v=CSL.localeResolve(h[r],b);if(v.generic){t[v.generic]=f.best}else{t[v.best]=f.best}}c[c.build.area].opt.sort_locales.push(t)}c.opt.has_layout_locale=true}else{l=e.split(/\s+/);var k=[];for(r=0,n=l.length;r<n;r+=1){x=l[r];a=CSL.localeResolve(x,b);if(l[r].length===2){k.push(a.bare)}c.localeConfigure(a,true);l[r]=a}var o=l.slice();var j=function(A,z,y){return function(B,E){var D,C;w=[];C=false;var G=false;var F;if(!B.language){F=z}else{F=B.language}G=CSL.localeResolve(F,z);for(r=0,n=A.length;r<n;r+=1){if(G.best===A[r].best){C=true;break}}if(!C&&y.indexOf(G.bare)>-1){C=true}return C}};this.tests.push(j(o,b,k))}};CSL.Attributes["@locale-internal"]=function(a,q){var d,k,j,n,e,p,r,c,g,f,b,h;g=q.split(/\s+/);this.locale_bares=[];for(f=0,b=g.length;f<b;f+=1){c=g[f];r=CSL.localeResolve(c,a.opt["default-locale"][0]);if(g[f].length===2){this.locale_bares.push(r.bare)}a.localeConfigure(r);g[f]=r}this.locale_default=a.opt["default-locale"][0];this.locale=g[0].best;this.locale_list=g.slice();var o=function(s){return function(t,w){var v,u;k=[];u=false;var x=false;if(t.language){c=t.language;x=CSL.localeResolve(c,a.opt["default-locale"][0]);if(x.best===a.opt["default-locale"][0]){x=false}}if(x){for(f=0,b=s.locale_list.length;f<b;f+=1){if(x.best===s.locale_list[f].best){a.opt.lang=s.locale;a.tmp.last_cite_locale=s.locale;a.output.openLevel("empty");a.output.current.value().new_locale=s.locale;u=true;break}}if(!u&&s.locale_bares.indexOf(x.bare)>-1){a.opt.lang=s.locale;a.tmp.last_cite_locale=s.locale;a.output.openLevel("empty");a.output.current.value().new_locale=s.locale;u=true}}return u}};var l=this;this.tests.push(o(l))};CSL.Attributes["@is-parallel"]=function(e,a){var b=a.split(" ");for(var d=0,c=b.length;d<c;d+=1){if(b[d]==="true"){b[d]=true}else{if(b[d]==="false"){b[d]=false}}}this.strings.set_parallel_condition=b};CSL.Attributes["@gender"]=function(b,a){this.gender=a};CSL.Attributes["@cslid"]=function(b,a){this.cslid=parseInt(a,10)};CSL.Attributes["@label-form"]=function(b,a){this.strings.label_form_override=a};CSL.Attributes["@part-separator"]=function(b,a){this.strings["part-separator"]=a};CSL.Attributes["@leading-noise-words"]=function(b,a){this["leading-noise-words"]=a};CSL.Attributes["@name-never-short"]=function(b,a){this["name-never-short"]=a};CSL.Attributes["@class"]=function(b,a){b.opt["class"]=a};CSL.Attributes["@version"]=function(b,a){b.opt.version=a};CSL.Attributes["@value"]=function(b,a){this.strings.value=a};CSL.Attributes["@name"]=function(b,a){this.strings.name=a};CSL.Attributes["@form"]=function(b,a){this.strings.form=a};CSL.Attributes["@date-parts"]=function(b,a){this.strings["date-parts"]=a};CSL.Attributes["@range-delimiter"]=function(b,a){this.strings["range-delimiter"]=a};CSL.Attributes["@macro"]=function(b,a){this.postponed_macro=a};CSL.Attributes["@term"]=function(b,a){if(a==="sub verbo"){this.strings.term="sub-verbo"}else{this.strings.term=a}};CSL.Attributes["@xmlns"]=function(b,a){};CSL.Attributes["@lang"]=function(b,a){if(a){b.build.lang=a}};CSL.Attributes["@lingo"]=function(b,a){};CSL.Attributes["@macro-has-date"]=function(b,a){this["macro-has-date"]=true};CSL.Attributes["@suffix"]=function(b,a){this.strings.suffix=a};CSL.Attributes["@prefix"]=function(b,a){this.strings.prefix=a};CSL.Attributes["@delimiter"]=function(b,a){if("name"==this.name){this.strings.name_delimiter=a}else{this.strings.delimiter=a}};CSL.Attributes["@match"]=function(b,a){this.match=a};CSL.Attributes["@names-min"]=function(b,a){var c=parseInt(a,10);if(b[b.tmp.area].opt.max_number_of_names<c){b[b.tmp.area].opt.max_number_of_names=c}this.strings["et-al-min"]=c};CSL.Attributes["@names-use-first"]=function(b,a){this.strings["et-al-use-first"]=parseInt(a,10)};CSL.Attributes["@names-use-last"]=function(b,a){if(a==="true"){this.strings["et-al-use-last"]=true}else{this.strings["et-al-use-last"]=false}};CSL.Attributes["@sort"]=function(b,a){if(a==="descending"){this.strings.sort_direction=CSL.DESCENDING}};CSL.Attributes["@plural"]=function(b,a){if("always"===a||"true"===a){this.strings.plural=1}else{if("never"===a||"false"===a){this.strings.plural=0}else{if("contextual"===a){this.strings.plural=false}}}};CSL.Attributes["@number"]=function(c,a){var b;var d=a.replace("sub verbo","sub-verbo");d=d.split(/\s+/);if(["if","else-if"].indexOf(this.name)>-1){b=function(l,g,k){var f=[];var e;l.processNumber(false,g,"number",g.type);if(!l.tmp.shadow_numbers.number.label){e="number"}else{if(l.tmp.shadow_numbers.number.label==="sub verbo"){e="sub-verbo"}else{e=l.tmp.shadow_numbers.number.label}}for(var j=0,h=d.length;j<h;j+=1){if(d[j]===e){f.push(true)}else{f.push(false)}}return f};this.tests.push(b)}};CSL.Attributes["@has-publisher-and-publisher-place"]=function(b,a){this.strings["has-publisher-and-publisher-place"]=true};CSL.Attributes["@publisher-delimiter-precedes-last"]=function(b,a){this.strings["publisher-delimiter-precedes-last"]=a};CSL.Attributes["@publisher-delimiter"]=function(b,a){this.strings["publisher-delimiter"]=a};CSL.Attributes["@publisher-and"]=function(b,a){this.strings["publisher-and"]=a};CSL.Attributes["@newdate"]=function(b,a){};CSL.Attributes["@givenname-disambiguation-rule"]=function(b,a){if(CSL.GIVENNAME_DISAMBIGUATION_RULES.indexOf(a)>-1){b.citation.opt["givenname-disambiguation-rule"]=a}};CSL.Attributes["@collapse"]=function(b,a){if(a){b[this.name].opt.collapse=a}};CSL.Attributes["@cite-group-delimiter"]=function(b,a){if(a){b[b.tmp.area].opt.cite_group_delimiter=a}};CSL.Attributes["@names-delimiter"]=function(b,a){b.setOpt(this,"names-delimiter",a)};CSL.Attributes["@name-form"]=function(b,a){b.setOpt(this,"name-form",a)};CSL.Attributes["@subgroup-delimiter"]=function(b,a){this.strings["subgroup-delimiter"]=a};CSL.Attributes["@subgroup-delimiter-precedes-last"]=function(b,a){this.strings["subgroup-delimiter-precedes-last"]=a};CSL.Attributes["@name-delimiter"]=function(b,a){b.setOpt(this,"name-delimiter",a)};CSL.Attributes["@et-al-min"]=function(b,a){var c=parseInt(a,10);if(b[b.tmp.area].opt.max_number_of_names<c){b[b.tmp.area].opt.max_number_of_names=c}b.setOpt(this,"et-al-min",c)};CSL.Attributes["@et-al-use-first"]=function(b,a){b.setOpt(this,"et-al-use-first",parseInt(a,10))};CSL.Attributes["@et-al-use-last"]=function(b,a){if(a==="true"){b.setOpt(this,"et-al-use-last",true)}else{b.setOpt(this,"et-al-use-last",false)}};CSL.Attributes["@et-al-subsequent-min"]=function(b,a){var c=parseInt(a,10);if(b[b.tmp.area].opt.max_number_of_names<c){b[b.tmp.area].opt.max_number_of_names=c}b.setOpt(this,"et-al-subsequent-min",c)};CSL.Attributes["@et-al-subsequent-use-first"]=function(b,a){b.setOpt(this,"et-al-subsequent-use-first",parseInt(a,10))};CSL.Attributes["@suppress-min"]=function(b,a){this.strings["suppress-min"]=parseInt(a,10)};CSL.Attributes["@suppress-max"]=function(b,a){this.strings["suppress-max"]=parseInt(a,10)};CSL.Attributes["@and"]=function(b,a){b.setOpt(this,"and",a)};CSL.Attributes["@delimiter-precedes-last"]=function(b,a){b.setOpt(this,"delimiter-precedes-last",a)};CSL.Attributes["@delimiter-precedes-et-al"]=function(b,a){b.setOpt(this,"delimiter-precedes-et-al",a)};CSL.Attributes["@initialize-with"]=function(b,a){b.setOpt(this,"initialize-with",a)};CSL.Attributes["@initialize"]=function(b,a){if(a==="false"){b.setOpt(this,"initialize",false)}};CSL.Attributes["@name-as-reverse-order"]=function(b,a){this["name-as-reverse-order"]=a};CSL.Attributes["@name-as-sort-order"]=function(b,a){if(this.name==="style-options"){this["name-as-sort-order"]=a}else{b.setOpt(this,"name-as-sort-order",a)}};CSL.Attributes["@sort-separator"]=function(b,a){b.setOpt(this,"sort-separator",a)};CSL.Attributes["@year-suffix-delimiter"]=function(b,a){b[this.name].opt["year-suffix-delimiter"]=a};CSL.Attributes["@after-collapse-delimiter"]=function(b,a){b[this.name].opt["after-collapse-delimiter"]=a};CSL.Attributes["@subsequent-author-substitute"]=function(b,a){b[this.name].opt["subsequent-author-substitute"]=a};CSL.Attributes["@subsequent-author-substitute-rule"]=function(b,a){b[this.name].opt["subsequent-author-substitute-rule"]=a};CSL.Attributes["@disambiguate-add-names"]=function(b,a){if(a==="true"){b.opt["disambiguate-add-names"]=true}};CSL.Attributes["@disambiguate-add-givenname"]=function(b,a){if(a==="true"){b.opt["disambiguate-add-givenname"]=true}};CSL.Attributes["@disambiguate-add-year-suffix"]=function(b,a){if(a==="true"&&b.opt.xclass!=="numeric"){b.opt["disambiguate-add-year-suffix"]=true}};CSL.Attributes["@second-field-align"]=function(b,a){if(a==="flush"||a==="margin"){b[this.name].opt["second-field-align"]=a}};CSL.Attributes["@hanging-indent"]=function(b,a){if(a==="true"){b[this.name].opt.hangingindent=2}};CSL.Attributes["@line-spacing"]=function(b,a){if(a&&a.match(/^[.0-9]+$/)){b[this.name].opt["line-spacing"]=parseFloat(a,10)}};CSL.Attributes["@entry-spacing"]=function(b,a){if(a&&a.match(/^[.0-9]+$/)){b[this.name].opt["entry-spacing"]=parseFloat(a,10)}};CSL.Attributes["@near-note-distance"]=function(b,a){b[this.name].opt["near-note-distance"]=parseInt(a,10)};CSL.Attributes["@text-case"]=function(c,a){var b=function(g,e){if(a==="normal"){this.text_case_normal=true}else{this.strings["text-case"]=a;if(a==="title"){var d=false;var f=g.opt["default-locale"][0].slice(0,2);if(e.jurisdiction){this.strings["text-case"]="passthrough"}}}};this.execs.push(b)};CSL.Attributes["@page-range-format"]=function(b,a){b.opt["page-range-format"]=a};CSL.Attributes["@year-range-format"]=function(b,a){b.opt["year-range-format"]=a};CSL.Attributes["@default-locale"]=function(f,d){var c,b,g,a,e;a=d.match(/-x-(sort|translit|translat)-/g);if(a){for(g=0,b=a.length;g<b;g+=1){a[g]=a[g].replace(/^-x-/,"").replace(/-$/,"")}}c=d.split(/-x-(?:sort|translit|translat)-/);e=[c[0]];for(g=1,b=c.length;g<b;g+=1){e.push(a[g-1]);e.push(c[g])}c=e.slice();b=c.length;for(g=1;g<b;g+=2){f.opt[("locale-"+c[g])].push(c[(g+1)].replace(/^\s*/g,"").replace(/\s*$/g,""))}if(c.length){f.opt["default-locale"]=c.slice(0,1)}else{f.opt["default-locale"]=["en"]}};CSL.Attributes["@default-locale-sort"]=function(f,d){var c,b,g,a,e;f.opt["default-locale-sort"]=d};CSL.Attributes["@demote-non-dropping-particle"]=function(b,a){b.opt["demote-non-dropping-particle"]=a};CSL.Attributes["@initialize-with-hyphen"]=function(b,a){if(a==="false"){b.opt["initialize-with-hyphen"]=false}};CSL.Attributes["@institution-parts"]=function(b,a){this.strings["institution-parts"]=a};CSL.Attributes["@if-short"]=function(b,a){if(a==="true"){this.strings["if-short"]=true}};CSL.Attributes["@substitute-use-first"]=function(b,a){this.strings["substitute-use-first"]=parseInt(a,10)};CSL.Attributes["@use-first"]=function(b,a){this.strings["use-first"]=parseInt(a,10)};CSL.Attributes["@stop-last"]=function(b,a){this.strings["stop-last"]=parseInt(a,10)*-1};CSL.Attributes["@oops"]=function(b,a){this.strings.oops=a};CSL.Attributes["@use-last"]=function(b,a){this.strings["use-last"]=parseInt(a,10)};CSL.Attributes["@reverse-order"]=function(b,a){if("true"===a){this.strings["reverse-order"]=true}};CSL.Attributes["@display"]=function(b,a){this.strings.cls=a};CSL.Stack=function(b,a){this.mystack=[];if(a||b){this.mystack.push(b)}};CSL.Stack.prototype.push=function(b,a){if(a||b){this.mystack.push(b)}else{this.mystack.push("")}};CSL.Stack.prototype.clear=function(){this.mystack=[]};CSL.Stack.prototype.replace=function(b,a){if(this.mystack.length===0){throw"Internal CSL processor error: attempt to replace nonexistent stack item with "+b}if(a||b){this.mystack[(this.mystack.length-1)]=b}else{this.mystack[(this.mystack.length-1)]=""}};CSL.Stack.prototype.pop=function(){return this.mystack.pop()};CSL.Stack.prototype.value=function(){return this.mystack.slice(-1)[0]};CSL.Stack.prototype.length=function(){return this.mystack.length};CSL.Parallel=function(a){this.state=a;this.sets=new CSL.Stack([]);this.try_cite=true;this.use_parallels=false;this.midVars=["section","volume","container-title","collection-number","issue","page-first","page","number"];this.ignoreVarsLawGeneral=["first-reference-note-number","locator","label","page-first","page","genre"];this.ignoreVarsLawProceduralHistory=["issued","first-reference-note-number","locator","label","page-first","page","genre","jurisdiction"];this.ignoreVarsOrders=["first-reference-note-number"];this.ignoreVarsOther=["first-reference-note-number","locator","label","section","page-first","page"]};CSL.Parallel.prototype.isMid=function(a){return(this.midVars.indexOf(a)>-1)};CSL.Parallel.prototype.StartCitation=function(b,a){this.parallel_conditional_blobs_list=[];if(this.use_parallels){this.sortedItems=b;this.sortedItemsPos=-1;this.sets.clear();this.sets.push([]);this.in_series=true;this.delim_counter=0;this.delim_pointers=[];if(a){this.out=a}else{this.out=this.state.output.queue}this.master_was_neutral_cite=true}};CSL.Parallel.prototype.StartCite=function(d,v,c){var y,t,g,k,u,l,h,q,b,f,w;if(this.use_parallels){if(this.sets.value().length&&this.sets.value()[0].itemId==d.id){this.ComposeSet()}this.sortedItemsPos+=1;if(v){y=v.position}this.try_cite=true;var e=false;for(var s=0,j=CSL.PARALLEL_MATCH_VARS.length;s<j;s+=1){if(d[CSL.PARALLEL_MATCH_VARS[s]]){e=true;break}}var r=true;var a=this.sets.value().slice(-1)[0];if(a&&a.Item){var p=a.Item.jurisdiction?a.Item.jurisdiction.split(";")[0]:"";var n=d.jurisdiction?d.jurisdiction.split(";")[0]:"";if(a.Item.title!==d.title){r=false}else{if(p!==n){r=false}else{if(a.Item.type!==d.type){r=false}else{if(["article-journal","article-magazine"].indexOf(d.type)>-1){if(!this.state.opt.development_extensions.handle_parallel_articles||a.Item["container-title"]!==d["container-title"]){r=false}}}}}}if(!r||!e||CSL.PARALLEL_TYPES.indexOf(d.type)===-1){this.try_cite=true;if(this.in_series){this.in_series=false}}this.cite={};this.cite.front=[];this.cite.mid=[];this.cite.back=[];this.cite.front_collapse={};this.cite.back_forceme=[];this.cite.position=y;this.cite.Item=d;this.cite.itemId=""+d.id;this.cite.prevItemID=""+c;this.target="front";if(["treaty"].indexOf(d.type)>-1){this.ignoreVars=this.ignoreVarsOrders}else{if(["article-journal","article-magazine"].indexOf(d.type)>-1){this.ignoreVars=this.ignoreVarsOther}else{if(v&&v.prefix){this.ignoreVars=this.ignoreVarsLawProceduralHistory;this.cite.useProceduralHistory=true;var o=this.sets.value()[(this.sets.value().length-1)];if(o&&o.back){for(var s=o.back.length-1;s>-1;s+=-1){if(o.back[s]&&o[o.back[s]]){delete o[o.back[s]]}}}}else{this.ignoreVars=this.ignoreVarsLawGeneral}}}if(this.sortedItems&&this.sortedItemsPos>0&&this.sortedItemsPos<this.sortedItems.length){u=this.sortedItems[this.sortedItemsPos][1];h=""+this.sortedItems[(this.sortedItemsPos-1)][1].id;l=this.state.registry.registry[h].parallel;q=false;if(l==u.id){t=this.sortedItemsPos-1;for(g=t;g>-1;g+=-1){if(this.sortedItems[g][1].id==d.id){q=this.sortedItems[g][1].locator;break}}b=this.sortedItems[this.sortedItemsPos][1].locator;if(!q&&b){u.position=CSL.POSITION_IBID_WITH_LOCATOR}else{if(b===q){u.position=CSL.POSITION_IBID}else{u.position=CSL.POSITION_IBID_WITH_LOCATOR}}}}else{if(this.state.registry.registry[d.id]){this.state.registry.registry[d.id].parallel=false}else{this.try_cite=false;this.force_collapse=false;return}}this.force_collapse=false;if(this.state.registry.registry[d.id].parallel){this.force_collapse=true}}};CSL.Parallel.prototype.StartVariable=function(b,a){if(this.use_parallels&&(this.try_cite||this.force_collapse)){if(b==="names"){this.variable=b+":"+this.target}else{this.variable=b}if(this.ignoreVars.indexOf(b)>-1){return}if(b==="container-title"&&this.sets.value().length===0){this.master_was_neutral_cite=false}this.data={};this.data.value="";this.data.blobs=[];var c=this.isMid(b);if(a==="authority"&&this.variable==="names:front"){this.try_cite=true;this.in_series=false}else{if(this.target==="front"&&c){this.target="mid"}else{if(this.target==="mid"&&!c&&this.cite.Item.title&&b!=="names"){this.target="back"}else{if(this.target==="back"&&c){this.try_cite=true;this.in_series=false}}}}if(b==="number"){this.cite.front.push(this.variable)}else{if(CSL.PARALLEL_COLLAPSING_MID_VARSET.indexOf(b)>-1){if(["article-journal","article-magazine"].indexOf(this.cite.Item.type)>-1){this.cite.mid.push(this.variable)}else{this.cite.front.push(this.variable)}}else{this.cite[this.target].push(this.variable)}}}};CSL.Parallel.prototype.AppendBlobPointer=function(a){if(this.use_parallels){if(this.ignoreVars.indexOf(this.variable)>-1){return}if(this.use_parallels&&(this.force_collapse||this.try_cite)){if(["article-journal","article-magazine"].indexOf(this.cite.Item.type)>-1){if(["volume","page","page-first","issue"].indexOf(this.variable)>-1){return}if("container-title"===this.variable&&this.cite.mid.length>1){return}}if(this.variable&&(this.try_cite||this.force_collapse)&&a&&a.blobs){if(!(this.cite.useProceduralHistory&&this.target==="back")){this.data.blobs.push([a,a.blobs.length])}}}}};CSL.Parallel.prototype.AppendToVariable=function(c,a){if(this.use_parallels){if(this.ignoreVars.indexOf(this.variable)>-1){return}if(this.try_cite||this.force_collapse){if(this.target!=="back"||true){this.data.value+="::"+c}else{var b=this.sets.value()[(this.sets.value().length-1)];if(b){if(b[this.variable]){if(b[this.variable].value){this.data.value+="::"+c}}}}}}};CSL.Parallel.prototype.CloseVariable=function(){if(this.use_parallels){if(this.ignoreVars.indexOf(this.variable)>-1){return}if(this.try_cite||this.force_collapse){this.cite[this.variable]=this.data;if(this.sets.value().length>0){var a=this.sets.value()[(this.sets.value().length-1)];if(this.target==="front"&&this.variable==="issued"){if(this.data.value&&this.master_was_neutral_cite){this.target="mid"}}if(this.target==="front"){if((a[this.variable]||this.data.value)&&(!a[this.variable]||this.data.value!==a[this.variable].value)){if("issued"!==this.variable){this.in_series=false}}}else{if(this.target==="mid"){if(CSL.PARALLEL_COLLAPSING_MID_VARSET.indexOf(this.variable)>-1){if(a[this.variable]){if(a[this.variable].value===this.data.value){this.cite.front_collapse[this.variable]=true}else{this.cite.front_collapse[this.variable]=false}}else{this.cite.front_collapse[this.variable]=false}}}else{if(this.target==="back"){if(a[this.variable]){if(this.data.value!==a[this.variable].value&&this.sets.value().slice(-1)[0].back_forceme.indexOf(this.variable)===-1){this.in_series=false}}}}}}}this.variable=false}};CSL.Parallel.prototype.CloseCite=function(){var g,f,d,e,k,a,c,j;if(this.use_parallels&&(this.force_collapse||this.try_cite)){k=false;if(!this.cite.front_collapse["container-title"]){k=true}if(this.cite.front_collapse.volume===false){k=true}if(this.cite.front_collapse["collection-number"]===false){k=true}if(this.cite.front_collapse.section===false){k=true}if(k){this.cite.use_journal_info=true;j=this.cite.front.indexOf("section");if(j>-1){this.cite.front=this.cite.front.slice(0,j).concat(this.cite.front.slice(j+1))}a=this.cite.front.indexOf("volume");if(a>-1){this.cite.front=this.cite.front.slice(0,a).concat(this.cite.front.slice(a+1))}c=this.cite.front.indexOf("container-title");if(c>-1){this.cite.front=this.cite.front.slice(0,c).concat(this.cite.front.slice(c+1))}collection_number_pos=this.cite.front.indexOf("collection-number");if(collection_number_pos>-1){this.cite.front=this.cite.front.slice(0,collection_number_pos).concat(this.cite.front.slice(collection_number_pos+1))}}if(!this.in_series&&!this.force_collapse){this.ComposeSet(true)}if(this.sets.value().length===0){has_date=false;for(f=0,d=this.cite.back.length;f<d;f+=1){g=this.cite.back[f];if(g==="issued"&&this.cite.issued&&this.cite.issued.value){has_date=true;break}}if(!has_date){this.cite.back_forceme.push("issued")}}else{var h=this.cite.front.indexOf("issued");if(h===-1||this.master_was_neutral_cite){this.cite.back_forceme=this.sets.value().slice(-1)[0].back_forceme}if(h>-1){var b=this.sets.value()[this.sets.value().length-1];if(!b.issued){this.cite.front=this.cite.front.slice(0,h).concat(this.cite.front.slice(h+1))}}if(this.master_was_neutral_cite&&this.cite.mid.indexOf("names:mid")>-1){this.cite.front.push("names:mid")}}this.sets.value().push(this.cite)}};CSL.Parallel.prototype.ComposeSet=function(b){var d,f,c,a;if(this.use_parallels&&(this.force_collapse||this.try_cite)){var e=this.sets.value().length;if(this.sets.value().length===1){if(!this.in_series){this.sets.value().pop();this.delim_counter+=1}}else{a=this.sets.value().length;for(f=0;f<a;f+=1){d=this.sets.value()[f];if(f===0){this.delim_counter+=1}else{if(!d.Item.title&&d.use_journal_info){this.delim_pointers.push(false)}else{this.delim_pointers.push(this.delim_counter)}this.delim_counter+=1}if(CSL.POSITION_FIRST===d.position){if(f===0){this.state.registry.registry[d.itemId].master=true;this.state.registry.registry[d.itemId].siblings=[];this.state.registry.registry[d.itemId].parallel=false}else{if(d.prevItemID){if(!this.state.registry.registry[d.prevItemID].parallel){this.state.registry.registry[d.itemId].parallel=d.prevItemID}else{this.state.registry.registry[d.itemId].parallel=this.state.registry.registry[d.prevItemID].parallel}this.state.registry.registry[d.itemId].siblings=this.state.registry.registry[d.prevItemID].siblings;if(!this.state.registry.registry[d.itemId].siblings){this.state.registry.registry[d.itemId].siblings=[];CSL.debug("WARNING: adding missing siblings array to registry object")}this.state.registry.registry[d.itemId].siblings.push(d.itemId)}}}}this.sets.push([])}if(e<2){this.purgeGroupsIfParallel(false)}else{this.purgeGroupsIfParallel(true)}this.in_series=true}};CSL.Parallel.prototype.PruneOutputQueue=function(){var a,f,c,b,d,e;if(this.use_parallels){a=this.sets.mystack.length;for(f=0;f<a;f+=1){c=this.sets.mystack[f];if(c.length>1){d=c.length;for(b=0;b<d;b+=1){e=c[b];if(b===0){this.purgeVariableBlobs(e,e.back)}else{if(b===(c.length-1)){this.purgeVariableBlobs(e,e.front.concat(e.back_forceme))}else{this.purgeVariableBlobs(e,e.front.concat(e.back))}}}}}}};CSL.Parallel.prototype.purgeVariableBlobs=function(d,c){var h,j,a,k,f,g,e;if(this.use_parallels){e=this.state.output.current.value();if("undefined"===typeof e.length){e=e.blobs}for(j=0,h=this.delim_pointers.length;j<h;j+=1){g=this.delim_pointers[j];if(g!==false){e[g].parallel_delimiter=", "}}h=c.length-1;for(j=h;j>-1;j+=-1){a=c[j];if(d[a]){f=d[a].blobs.length-1;for(g=f;g>-1;g+=-1){k=d[a].blobs[g];k[0].blobs=k[0].blobs.slice(0,k[1]).concat(k[0].blobs.slice((k[1]+1)));this.state.tmp.has_purged_parallel=true;if(k[0]&&k[0].strings&&"string"==typeof k[0].strings.oops&&k[0].parent&&k[0].parent){k[0].parent.parent.strings.delimiter=k[0].strings.oops}}}}}};CSL.Parallel.prototype.purgeGroupsIfParallel=function(g){for(var e=this.parallel_conditional_blobs_list.length-1;e>-1;e+=-1){var f=this.parallel_conditional_blobs_list[e];var c=true;for(var d=0,b=f.conditions.length;d<b;d+=1){if(!(!f.conditions[d]===!!g||("master"===f.conditions[d]&&!this.state.registry.registry[f.id].master)||("servant"===f.conditions[d]&&!this.state.registry.registry[f.id].parallel))){var c=false;break}}if(c){var a=[];while(f.blobs.length>f.pos){a.push(f.blobs.pop())}if(a.length){a.pop()}while(a.length){f.blobs.push(a.pop())}}this.parallel_conditional_blobs_list.pop()}};CSL.Util={};CSL.Util.Match=function(){this.any=function(a,c,b){return function(d,g){for(var f=0,e=b.length;f<e;f+=1){result=b[f](d,g);if(result){return true}}return false}};this.none=function(a,c,b){return function(d,g){for(var f=0,e=b.length;f<e;f+=1){result=b[f](d,g);if(result){return false}}return true}};this.all=function(a,c,b){return function(d,g){for(var f=0,e=b.length;f<e;f+=1){result=b[f](d,g);if(!result){return false}}return true}};this[undefined]=this.all;this.nand=function(a,c,b){return function(d,g){for(var f=0,e=b.length;f<e;f+=1){result=b[f](d,g);if(!result){return true}}return false}}};CSL.Transform=function(a){var b=false,j,f,l,e,c;this.abbrevs={};this.abbrevs["default"]=new a.sys.AbbreviationSegments();this.getTextSubField=k;function d(r,t,q,s,v,x){var z;if(!v){return s}var u=v;var w=false;if(["title","title-short"].indexOf(u)>-1&&!t.jurisdiction){w=true}if(CSL.NUMERIC_VARIABLES.indexOf(v)>-1){v="number"}if(["publisher-place","event-place","jurisdiction","archive-place"].indexOf(v)>-1){v="place"}if(["publisher","authority"].indexOf(v)>-1){v="institution-part"}if(["genre","event","medium","title-short"].indexOf(v)>-1){v="title"}if(["archive"].indexOf(v)>-1){v="collection-title"}if(u==="jurisdiction"&&r.sys.getHumanForm&&s){s=r.sys.getHumanForm(s)}z="";if(r.sys.getAbbreviation){var y=r.transform.loadAbbreviation(t.jurisdiction,v,s,t.type,w);if(r.transform.abbrevs[y][v]&&s&&r.sys.getAbbreviation){if(r.transform.abbrevs[y][v][s]){z=r.transform.abbrevs[y][v][s].replace("{stet}",s)}}}if(!z&&(!r.opt.development_extensions.require_explicit_legal_case_title_short||t.type!=="legal_case")&&q&&t[q]&&x){z=t[q]}if(!z){z=s}if(z&&z.match(/^\!(?:[^>]+,)*here(?:,[^>]+)*>>>/)){if(u==="jurisdiction"&&["treaty","patent"].indexOf(t.type)>-1){z=z.replace(/^\![^>]*>>>\s*/,"")}else{z=false}}return z}function o(s,t){var r=a.opt["default-locale"][0].slice(0,2);var q;if(a.opt.development_extensions.strict_text_case_locales){q=new RegExp("^([a-zA-Z]{2})(?:$|-.*| .*)")}else{q=new RegExp("^([a-zA-Z]{2})(?:$|-.*|.*)")}if(s.language){m=(""+s.language).match(q);if(m){r=m[1]}else{r="tlh"}}if(s.multi&&s.multi&&s.multi.main&&s.multi.main[t]){r=s.multi.main[t]}if(!a.opt.development_extensions.strict_text_case_locales||a.opt.development_extensions.normalize_lang_keys_to_lowercase){r=r.toLowerCase()}return r}function k(t,s,F,C,q){var B,y,r,A,x,v,I,H,E,u,z;var G=q;if(!t[s]){return{name:"",usedOrig:q}}H={name:"",usedOrig:q,locale:o(t,s)};z=a.opt[F];if(F==="locale-orig"){if(q){H={name:"",usedOrig:q}}else{H={name:t[s],usedOrig:false,locale:o(t,s)}}return H}else{if(C&&("undefined"===typeof z||z.length===0)){return{name:t[s],usedOrig:true,locale:o(t,s)}}}for(var D=0,w=z.length;D<w;D+=1){r=z[D];A=r.split(/[\-_]/)[0];if(r&&t.multi&&t.multi._keys[s]&&t.multi._keys[s][r]){H.name=t.multi._keys[s][r];H.locale=A;break}else{if(A&&t.multi&&t.multi._keys[s]&&t.multi._keys[s][A]){H.name=t.multi._keys[s][A];H.locale=A;break}}}if(!H.name&&C){H={name:t[s],usedOrig:true,locale:o(t,s)}}return H}function h(z,q,A,x,v){var y,w;if(!z){z="default"}if(!A){if(!a.transform.abbrevs[z]){a.transform.abbrevs[z]=new a.sys.AbbreviationSegments()}return z}if(a.sys.getAbbreviation){var t=["default"];if(z!=="default"){var s=z.split(/\s*;\s*/);for(var u=0,r=s.length;u<r;u+=1){t.push(s.slice(0,u+1).join(";"))}}for(var u=t.length-1;u>-1;u+=-1){if(!a.transform.abbrevs[t[u]]){a.transform.abbrevs[t[u]]=new a.sys.AbbreviationSegments()}if(!a.transform.abbrevs[t[u]][q][A]){a.sys.getAbbreviation(a.opt.styleID,a.transform.abbrevs,t[u],q,A,x,v)}if(a.transform.abbrevs[t[u]][q][A]){if(u<t.length){a.transform.abbrevs[z][q][A]=a.transform.abbrevs[t[u]][q][A]}break}}}return z}this.loadAbbreviation=h;function p(s,t,w,x){var r=s.variables[0];if(a.publisherOutput&&w){if(["publisher","publisher-place"].indexOf(r)===-1){return false}else{a.publisherOutput[r+"-token"]=s;a.publisherOutput.varlist.push(r);var q=w.split(/;\s*/);if(q.length===a.publisherOutput[r+"-list"].length){a.publisherOutput[r+"-list"]=q}for(var v=0,u=q.length;v<u;v+=1){q[v]=d(a,t,false,q[v],x,true)}a.tmp[r+"-token"]=s;return true}}return false}function g(w,v,q,r,u){var s;var t=CSL.LangPrefsMap[w[0]];if(!t){s=false}else{s=a.opt["cite-lang-prefs"][t]}return function(B,y,Q,S){var J,E,H,I,F,O,C,x,U;if(!w[0]||(!y[w[0]]&&!y[r])){return null}if(B.opt.suppressJurisdictions&&w[0]==="jurisdiction"&&B.opt.suppressJurisdictions[y.jurisdiction]&&["legal_case","gazette","regulation","legislation"].indexOf(y.type)>-1){return null}var A={primary:false,secondary:false,tertiary:false};if(B.tmp.area.slice(-5)==="_sort"){A.primary="locale-sort"}else{if(s){var R=["primary","secondary","tertiary"];for(var N=0,D=R.length;N<D;N+=1){if(s.length-1<N){break}if(s[N]){A[R[N]]="locale-"+s[N]}}}else{A.primary="locale-orig"}}if((B.tmp.area!=="bibliography"&&!(B.tmp.area==="citation"&&B.opt.xclass==="note"&&Q&&!Q.position))){A.secondary=false;A.tertiary=false}if(B.tmp["publisher-list"]){if(w[0]==="publisher"){B.tmp["publisher-token"]=this}else{if(w[0]==="publisher-place"){B.tmp["publisher-place-token"]=this}}return null}var T=k(y,w[0],A.primary,true);J=T.name;E=T.locale;var G=T.usedOrig;if(p(this,y,J,v)){return null}H=false;F=false;if(A.secondary){T=k(y,w[0],A.secondary,false,T.usedOrig);H=T.name;I=T.locale}if(A.tertiary){T=k(y,w[0],A.tertiary,false,T.usedOrig);F=T.name;O=T.locale}if(v){J=d(B,y,r,J,v,true);if(J){J=n(J)}H=d(B,y,false,H,v,true);F=d(B,y,false,F,v,true)}var P=CSL.Util.cloneToken(this);var C=CSL.Util.cloneToken(this);var z;if(A.primary==="locale-translit"){z=B.opt.citeAffixes[t][A.primary].prefix}if(z==="<i>"&&w[0]==="title"&&!G){var L=false;for(var N=0,D=C.decorations.length;N<D;N+=1){if(C.decorations[N][0]==="@font-style"&&C.decorations[N][1]==="italic"){L=true}}if(!L){C.decorations.push(["@font-style","italic"])}}if(E!=="en"&&C.strings["text-case"]==="title"){C.strings["text-case"]="passthrough"}if("title"===w[0]){J=CSL.demoteNoiseWords(B,J,this["leading-noise-words"])}if(H||F){B.output.openLevel("empty");C.strings.suffix=C.strings.suffix.replace(/[ .,]+$/,"");B.output.append(J,C);if(H){secondary_tok=CSL.Util.cloneToken(P);secondary_tok.strings.prefix=B.opt.citeAffixes[t][A.secondary].prefix;secondary_tok.strings.suffix=B.opt.citeAffixes[t][A.secondary].suffix;if(!secondary_tok.strings.prefix){secondary_tok.strings.prefix=" "}for(var N=secondary_tok.decorations.length-1;N>-1;N+=-1){if(["@quotes/true","@font-style/italic","@font-style/oblique","@font-weight/bold"].indexOf(secondary_tok.decorations[N].join("/"))>-1){secondary_tok.decorations=secondary_tok.decorations.slice(0,N).concat(secondary_tok.decorations.slice(N+1))}}if(I!=="en"&&secondary_tok.strings["text-case"]==="title"){secondary_tok.strings["text-case"]="passthrough"}B.output.append(H,secondary_tok);var K=B.output.current.value();var M=B.output.current.value().blobs.length-1;if(B.parallel.use_parallels){B.parallel.cite.front.push(w[0]+":secondary");B.parallel.cite[w[0]+":secondary"]={blobs:[[K,M]]}}}if(F){tertiary_tok=CSL.Util.cloneToken(P);tertiary_tok.strings.prefix=B.opt.citeAffixes[t][A.tertiary].prefix;tertiary_tok.strings.suffix=B.opt.citeAffixes[t][A.tertiary].suffix;if(!tertiary_tok.strings.prefix){tertiary_tok.strings.prefix=" "}for(var N=tertiary_tok.decorations.length-1;N>-1;N+=-1){if(["@quotes/true","@font-style/italic","@font-style/oblique","@font-weight/bold"].indexOf(tertiary_tok.decorations[N].join("/"))>-1){tertiary_tok.decorations=tertiary_tok.decorations.slice(0,N).concat(tertiary_tok.decorations.slice(N+1))}}if(O!=="en"&&tertiary_tok.strings["text-case"]==="title"){tertiary_tok.strings["text-case"]="passthrough"}B.output.append(F,tertiary_tok);var K=B.output.current.value();var M=B.output.current.value().blobs.length-1;if(B.parallel.use_parallels){B.parallel.cite.front.push(w[0]+":tertiary");B.parallel.cite[w[0]+":tertiary"]={blobs:[[K,M]]}}}B.output.closeLevel()}else{B.output.append(J,C)}return null}}this.getOutputFunction=g;function n(u){var r=u.match(/^!([-,_a-z]+)>>>/);if(r){var q=r[1].split(",");u=u.slice(r[0].length);for(var t=0,s=q.length;t<s;t+=1){if(a.tmp.done_vars.indexOf(q[t])===-1){a.tmp.done_vars.push(q[t])}}}return u}this.quashCheck=n};CSL.Token=function(b,a){this.name=b;this.strings={};this.strings.delimiter=undefined;this.strings.prefix="";this.strings.suffix="";this.decorations=[];this.variables=[];this.execs=[];this.tokentype=a;this.evaluator=false;this.tests=[];this.rawtests=[];this.succeed=false;this.fail=false;this.next=false};CSL.Util.cloneToken=function(d){var b,c,e,a;if("string"===typeof d){return d}b=new CSL.Token(d.name,d.tokentype);for(c in d.strings){if(d.strings.hasOwnProperty(c)){b.strings[c]=d.strings[c]}}if(d.decorations){b.decorations=[];for(e=0,a=d.decorations.length;e<a;e+=1){b.decorations.push(d.decorations[e].slice())}}if(d.variables){b.variables=d.variables.slice()}if(d.execs){b.execs=d.execs.slice();b.tests=d.tests.slice();b.rawtests=d.tests.slice()}return b};CSL.AmbigConfig=function(){this.maxvals=[];this.minval=1;this.names=[];this.givens=[];this.year_suffix=false;this.disambiguate=0};CSL.Blob=function(e,d,c){var a,f,b;this.levelname=c;if(d){this.strings={prefix:"",suffix:""};for(b in d.strings){if(d.strings.hasOwnProperty(b)){this.strings[b]=d.strings[b]}}this.decorations=[];if(d.decorations===undefined){a=0}else{a=d.decorations.length}for(f=0;f<a;f+=1){this.decorations.push(d.decorations[f].slice())}}else{this.strings={};this.strings.prefix="";this.strings.suffix="";this.strings.delimiter="";this.decorations=[]}if("string"===typeof e){this.blobs=e}else{if(e){this.blobs=[e]}else{this.blobs=[]}}this.alldecor=[this.decorations]};CSL.Blob.prototype.push=function(a){if("string"===typeof this.blobs){throw"Attempt to push blob onto string object"}else{if(false!==a){a.alldecor=a.alldecor.concat(this.alldecor);this.blobs.push(a)}}};CSL.NumericBlob=function(b,a,c){this.id=c;this.alldecor=[];this.num=b;this.blobs=b.toString();this.status=CSL.START;this.strings={};if(a){this.gender=a.gender;this.decorations=a.decorations;this.strings.prefix=a.strings.prefix;this.strings.suffix=a.strings.suffix;this.strings["text-case"]=a.strings["text-case"];this.successor_prefix=a.successor_prefix;this.range_prefix=a.range_prefix;this.splice_prefix=a.splice_prefix;this.formatter=a.formatter;if(!this.formatter){this.formatter=new CSL.Output.DefaultFormatter()}if(this.formatter){this.type=this.formatter.format(1)}}else{this.decorations=[];this.strings.prefix="";this.strings.suffix="";this.successor_prefix="";this.range_prefix="";this.splice_prefix="";this.formatter=new CSL.Output.DefaultFormatter()}};CSL.NumericBlob.prototype.setFormatter=function(a){this.formatter=a;this.type=this.formatter.format(1)};CSL.Output.DefaultFormatter=function(){};CSL.Output.DefaultFormatter.prototype.format=function(a){return a.toString()};CSL.NumericBlob.prototype.checkNext=function(a,b){if(b){this.status=CSL.START;if("object"===typeof a){if(a.num===(this.num+1)){a.status=CSL.SUCCESSOR}else{a.status=CSL.SEEN}}}else{if(!a||!a.num||this.type!==a.type||a.num!==(this.num+1)){if(this.status===CSL.SUCCESSOR_OF_SUCCESSOR){this.status=CSL.END}if("object"===typeof a){a.status=CSL.SEEN}}else{if(this.status===CSL.START||this.status===CSL.SEEN){a.status=CSL.SUCCESSOR}else{if(this.status===CSL.SUCCESSOR||this.status===CSL.SUCCESSOR_OF_SUCCESSOR){if(this.range_prefix){a.status=CSL.SUCCESSOR_OF_SUCCESSOR;this.status=CSL.SUPPRESS}else{a.status=CSL.SUCCESSOR}}}}}};CSL.NumericBlob.prototype.checkLast=function(a){if(this.status===CSL.SEEN||(a.num!==(this.num-1)&&this.status===CSL.SUCCESSOR)){this.status=CSL.SUCCESSOR;return true}return false};CSL.Util.fixDateNode=function(g,f,l){var b,o,n,a,r,k,v,q,c,e,u,d,t,p,j;this.build.date_key=true;b=this.sys.xml.getAttributeValue(l,"form");var s;if("accessed"===this.sys.xml.getAttributeValue(l,"variable")){s=this.opt["default-locale"][0]}else{s=this.sys.xml.getAttributeValue(l,"lingo")}if(!this.getDate(b)){return g}var h=this.sys.xml.getAttributeValue(l,"date-parts");o=this.sys.xml.getAttributeValue(l,"variable");q=this.sys.xml.getAttributeValue(l,"prefix");c=this.sys.xml.getAttributeValue(l,"suffix");p=this.sys.xml.getAttributeValue(l,"display");j=this.sys.xml.getAttributeValue(l,"cslid");n=this.sys.xml.nodeCopy(this.getDate(b,("accessed"===o)));this.sys.xml.setAttribute(n,"lingo",this.opt.lang);this.sys.xml.setAttribute(n,"form",b);this.sys.xml.setAttribute(n,"date-parts",h);this.sys.xml.setAttribute(n,"cslid",j);this.sys.xml.setAttribute(n,"variable",o);if(q){this.sys.xml.setAttribute(n,"prefix",q)}if(c){this.sys.xml.setAttribute(n,"suffix",c)}if(p){this.sys.xml.setAttribute(n,"display",p)}e=this.sys.xml.children(l);for(u in e){a=e[u];if("date-part"===this.sys.xml.nodename(a)){r=this.sys.xml.getAttributeValue(a,"name");d=this.sys.xml.attributes(a);for(k in d){if(d.hasOwnProperty(k)){if("@name"===k){continue}if(s&&s!==this.opt.lang){if(["@suffix","@prefix","@form"].indexOf(k)>-1){continue}}v=d[k];this.sys.xml.setAttributeOnNodeIdentifiedByNameAttribute(n,"date-part",r,k,v)}}}}if("year"===this.sys.xml.getAttributeValue(l,"date-parts")){this.sys.xml.deleteNodeByNameAttribute(n,"month");this.sys.xml.deleteNodeByNameAttribute(n,"day")}else{if("year-month"===this.sys.xml.getAttributeValue(l,"date-parts")){this.sys.xml.deleteNodeByNameAttribute(n,"day")}}return this.sys.xml.insertChildNodeAfter(g,l,f,n)};CSL.dateMacroAsSortKey=function(b,a){CSL.dateAsSortKey.call(this,b,a,true)};CSL.dateAsSortKey=function(a,f,c){var h,d,p,n,q,l,j,b,k;var g=this.variables[0];var o="empty";if(c){o="macro-with-date"}h=f[g];if("undefined"===typeof h){h={"date-parts":[[0]]};if(!h.year){a.tmp.empty_date=true}}if("undefined"===typeof this.dateparts){this.dateparts=["year","month","day"]}if(h.raw){h=a.fun.dateparser.parse(h.raw)}else{if(h["date-parts"]){h=a.dateParseArray(h)}}if("undefined"===typeof h){h={}}for(j=0,b=CSL.DATE_PARTS_INTERNAL.length;j<b;j+=1){d=CSL.DATE_PARTS_INTERNAL[j];p=0;n=d;if(n.slice(-4)==="_end"){n=n.slice(0,-4)}if(h[d]&&this.dateparts.indexOf(n)>-1){p=h[d]}if(d.slice(0,4)==="year"){q=CSL.Util.Dates[n].numeric(a,p);l="Y";if(q[0]==="-"){l="X";q=q.slice(1);q=9999-parseInt(q,10)}a.output.append(CSL.Util.Dates[d.slice(0,4)].numeric(a,(l+q)),o)}else{p=CSL.Util.Dates[n]["numeric-leading-zeros"](a,p);if(!p){p="00"}a.output.append(p,o)}}};CSL.Engine.prototype.dateParseArray=function(a){var l,q,n,h,c,f,e,o,k,p,s;l={};for(q in a){if(q==="date-parts"){c=a["date-parts"];if(c.length>1){if(c[0].length!==c[1].length){CSL.error("CSL data error: element mismatch in date range input.")}}f=["","_end"];for(var g=0,b=c.length;g<b;g+=1){for(var d=0,r=CSL.DATE_PARTS.length;d<r;d+=1){if("undefined"===typeof c[g][d]){l[(CSL.DATE_PARTS[d]+f[g])]=c[g][d]}else{l[(CSL.DATE_PARTS[d]+f[g])]=parseInt(c[g][d],10)}}}}else{if(a.hasOwnProperty(q)){if(q==="literal"&&"object"===typeof a.literal&&"string"===typeof a.literal.part){CSL.debug("Warning: fixing up weird literal date value");l.literal=a.literal.part}else{l[q]=a[q]}}}}return l};CSL.Util.Names={};CSL.Util.Names.compareNamesets=CSL.NameOutput.prototype._compareNamesets;CSL.Util.Names.unInitialize=function(g,c){var f,e,a,d,b;if(!c){return""}a=c.split(/(?:\-|\s+)/);d=c.match(/(\-|\s+)/g);b="";for(f=0,e=a.length;f<e;f+=1){if(CSL.ALL_ROMANESQUE_REGEXP.exec(a[f].slice(0,-1))&&a[f]&&a[f]!==a[f].toUpperCase()){a[f]=a[f].slice(0,1)+a[f].slice(1,2).toLowerCase()+a[f].slice(2)}b+=a[f];if(f<e-1){b+=d[f]}}return b};CSL.Util.Names.initializeWith=function(c,d,b,r){var p,e,l,u,g,h,k,t,o,q;if(!d){return""}if(["Lord","Lady"].indexOf(d)>-1||(!d.match(CSL.STARTSWITH_ROMANESQUE_REGEXP)&&!b.match("%s"))){return d}if(!b){b=""}var a=d;if(c.opt["initialize-with-hyphen"]===false){a=a.replace(/\-/g," ")}a=a.replace(/\s*\-\s*/g,"-").replace(/\s+/g," ");a=a.replace(/-([a-z])/g,"\u2013$1");k=a.match(/[\-\s]+/g);o=a.split(/[\-\s]+/);if(o.length===0){a=k}else{a=[o[0]];for(p=1,e=o.length;p<e;p+=1){a.push(k[p-1]);a.push(o[p])}}o=a;for(p=o.length-1;p>-1;p+=-1){if(o[p]&&o[p].slice(0,-1).indexOf(".")>-1){var f=o.slice(p+1);var s=o[p].slice(0,-1).split(".");o=o.slice(0,p);for(l=0,u=s.length;l<u;l+=1){o.push(s[l]+".");if(l<s.length-1){o.push(" ")}}o=o.concat(f)}}if(r){q=CSL.Util.Names.doNormalize(c,o,b)}else{q=CSL.Util.Names.doInitialize(c,o,b)}q=q.replace(/\u2013([a-z])/g,"-$1");return q};CSL.Util.Names.doNormalize=function(f,a,b,g){var e,d;var h=[];for(e=0,d=a.length;e<d;e+=1){if(a[e].length>1&&a[e].slice(-1)==="."){a[e]=a[e].slice(0,-1);h.push(true)}else{if(a[e].length===1&&a[e].toUpperCase()===a[e]){h.push(true)}else{h.push(false)}}}var c=[];for(e=0,d=a.length;e<d;e+=2){if(h[e]){if(e<a.length-2){a[e+1]="";if((!b||b.slice(-1)&&b.slice(-1)!==" ")&&a[e].length&&a[e].match(CSL.ALL_ROMANESQUE_REGEXP)&&(a[e].length>1||a[e+2].length>1)){a[e+1]=" "}a[e]=a[e]+b}if(e===a.length-1){a[e]=a[e]+b}}}return a.join("").replace(/\s+$/,"")};CSL.Util.Names.doInitialize=function(d,b,a,p){var o,e,h,k,t,l,f;for(o=0,e=b.length;o<e;o+=2){f=b[o];if(!f){continue}h=f.match(CSL.NAME_INITIAL_REGEXP);if(!h&&(!f.match(CSL.STARTSWITH_ROMANESQUE_REGEXP)&&f.length>1&&a.match("%s"))){h=f.match(/(.)(.*)/)}if(h&&h[1]===h[1].toUpperCase()){var g="";if(h[2]){var u="";l=h[2].split("");for(k=0,t=l.length;k<t;k+=1){var r=l[k];if(r===r.toUpperCase()){u+=r}else{break}}if(u.length<h[2].length){g=u.toLocaleLowerCase()}}b[o]=h[1].toLocaleUpperCase()+g;if(o<(e-1)){if(a.match("%s")){b[o]=a.replace("%s",b[o])}else{if(b[o+1].indexOf("-")>-1){b[o+1]=a+b[o+1]}else{b[o+1]=a}}}else{if(a.match("%s")){b[o]=a.replace("%s",b[o])}else{b.push(a)}}}else{if(f.match(CSL.ROMANESQUE_REGEXP)){b[o]=" "+f}}}var q=b.join("");q=q.replace(/\s+$/,"").replace(/\s*\-\s*/g,"-").replace(/\s+/g," ");return q};CSL.Util.Names.getRawName=function(b){var a=[];if(b.given){a.push(b.given)}if(b.family){a.push(b.family)}return a.join(" ")};CSL.Util.Dates={};CSL.Util.Dates.year={};CSL.Util.Dates.year["long"]=function(b,a){if(!a){if("boolean"===typeof a){a=""}else{a=0}}return a.toString()};CSL.Util.Dates.year.imperial=function(a,e,c,j){if(!e){if("boolean"===typeof e){e=""}else{e=0}}c=c?"_end":"";var f=a.tmp.date_object["month"+c];f=f?""+f:"1";while(f.length<2){f="0"+f}var g=a.tmp.date_object["day"+c];g=g?""+g:"1";while(g.length<2){g="0"+g}var b=parseInt(e+f+g,10);var h;var d;if(b>=18680908&&b<19120730){h="\u660e\u6cbb";d=1867}else{if(b>=19120730&&b<19261225){h="\u5927\u6b63";d=1911}else{if(b>=19261225&&b<19890108){h="\u662d\u548c";d=1925}else{if(b>=19890108){h="\u5e73\u6210";d=1988}}}}if(h&&d){if(!a.transform.abbrevs["default"]["number"][h]){a.transform.loadAbbreviation("default","number",h)}if(a.transform.abbrevs["default"]["number"][h]){h=a.transform.abbrevs["default"]["number"][h]}year=h+(e-d)}return year};CSL.Util.Dates.year["short"]=function(b,a){a=a.toString();if(a&&a.length===4){return a.substr(2)}};CSL.Util.Dates.year.numeric=function(c,b){var a,d;b=""+b;a=b.match(/([0-9]*)$/);if(a){d=b.slice(0,a[1].length*-1);b=a[1]}else{d=b;b=""}while(b.length<4){b="0"+b}return(d+b)};CSL.Util.Dates.normalizeMonth=function(c,a){var b;if(!c){c=0}c=""+c;if(!c.match(/^[0-9]+$/)){c=0}c=parseInt(c,10);if(a){var d={stub:"month-",num:c};if(d.num<1||d.num>20){d.num=0}else{if(d.num>16){d.stub="season-";d.num=d.num-16}else{if(d.num>12){d.stub="season-";d.num=d.num-12}}}b=d}else{if(c<1||c>12){c=0}b=c}return b};CSL.Util.Dates.month={};CSL.Util.Dates.month.numeric=function(b,a){var a=CSL.Util.Dates.normalizeMonth(a);if(!a){a=""}return a};CSL.Util.Dates.month["numeric-leading-zeros"]=function(b,a){var a=CSL.Util.Dates.normalizeMonth(a);if(!a){a=""}else{a=""+a;while(a.length<2){a="0"+a}}return a};CSL.Util.Dates.month["long"]=function(e,a,d,c){var b=CSL.Util.Dates.normalizeMonth(a,true);var a=b.num;if(!a){a=""}else{a=""+a;while(a.length<2){a="0"+a}a=e.getTerm(b.stub+a,"long",0,0,false,c)}return a};CSL.Util.Dates.month["short"]=function(e,a,d,c){var b=CSL.Util.Dates.normalizeMonth(a,true);var a=b.num;if(!a){a=""}else{a=""+a;while(a.length<2){a="0"+a}a=e.getTerm(b.stub+a,"short",0,0,false,c)}return a};CSL.Util.Dates.day={};CSL.Util.Dates.day.numeric=function(b,a){return a.toString()};CSL.Util.Dates.day["long"]=CSL.Util.Dates.day.numeric;CSL.Util.Dates.day["numeric-leading-zeros"]=function(b,a){if(!a){a=0}a=a.toString();while(a.length<2){a="0"+a}return a.toString()};CSL.Util.Dates.day.ordinal=function(c,a,b){return c.fun.ordinalizer.format(a,b)};CSL.Util.Sort={};CSL.Util.Sort.strip_prepositions=function(b){var a;if("string"===typeof b){a=b.toLocaleLowerCase();a=b.match(/^((a|an|the)\s+)/)}if(a){b=b.substr(a[1].length)}return b};CSL.Util.substituteStart=function(b,g){var a,h,d,c,e,j,f;c=function(o,k){for(var n=0,l=this.decorations.length;n<l;n+=1){if("@strip-periods"===this.decorations[n][0]&&"true"===this.decorations[n][1]){o.tmp.strip_periods+=1;break}}};this.execs.push(c);if(this.decorations&&(b.opt.development_extensions.csl_reverse_lookup_support||b.sys.csl_reverse_lookup_support)){this.decorations.reverse();this.decorations.push(["@showid","true",this.cslid]);this.decorations.reverse()}f=["number","date","names"];if(("text"===this.name&&!this.postponed_macro)||f.indexOf(this.name)>-1){a=function(n,k,l){if(n.tmp.element_trace.value()==="author"||"names"===this.name){if(l&&l["author-only"]){n.tmp.element_trace.push("do-not-suppress-me")}else{if(l&&l["suppress-author"]){}}}else{if(l&&l["author-only"]){n.tmp.element_trace.push("suppress-me")}else{if(l&&l["suppress-author"]){n.tmp.element_trace.push("do-not-suppress-me")}}}};this.execs.push(a)}h=this.strings.cls;this.strings.cls=false;if(b.build.render_nesting_level===0){if(b.build.area==="bibliography"&&b.bibliography.opt["second-field-align"]){d=new CSL.Token("group",CSL.START);d.decorations=[["@display","left-margin"]];c=function(l,k){if(!l.tmp.render_seen){d.strings.first_blob=k.id;l.output.startTag("bib_first",d)}};d.execs.push(c);g.push(d)}else{if(CSL.DISPLAY_CLASSES.indexOf(h)>-1){d=new CSL.Token("group",CSL.START);d.decorations=[["@display",h]];c=function(l,k){d.strings.first_blob=k.id;l.output.startTag("bib_first",d)};d.execs.push(c);g.push(d)}}b.build.cls=h}b.build.render_nesting_level+=1;if(b.build.substitute_level.value()===1){e=new CSL.Token("choose",CSL.START);CSL.Node.choose.build.call(e,b,g);j=new CSL.Token("if",CSL.START);c=function(k,l){if(b.tmp.can_substitute.value()){return true}return false};j.tests.push(c);j.test=b.fun.match.any(this,b,j.tests);g.push(j)}if(b.sys.variableWrapper&&this.variables_real&&this.variables_real.length){c=function(k,l,t){if(!k.tmp.just_looking&&!k.tmp.suppress_decorations){variable_entry=new CSL.Token("text",CSL.START);variable_entry.decorations=[["@showid","true"]];k.output.startTag("variable_entry",variable_entry);var p=null;if(t){p=t.position}if(!p){p=0}var u=["first","subsequent","ibid","ibid-with-locator"];var s=0;if(t&&t.noteIndex){s=t.noteIndex}var r=0;if(t&&t["first-reference-note-number"]){r=t["first-reference-note-number"]}var o=0;if(t&&t["citation-number"]){o=t["citation-number"]}var q=0;if(t&&t.index){q=t.index}var n={itemData:l,variableNames:this.variables,context:k.tmp.area,xclass:k.opt.xclass,position:u[p],"note-number":s,"first-reference-note-number":r,"citation-number":o,index:q,mode:k.opt.mode};k.output.current.value().params=n}};this.execs.push(c)}};CSL.Util.substituteEnd=function(a,e){var b,f,c,l,k,j,h,n,g;if(a.sys.variableWrapper&&(this.hasVariable||(this.variables_real&&this.variables_real.length))){b=function(p,o){if(!p.tmp.just_looking&&!p.tmp.suppress_decorations){p.output.endTag("variable_entry")}};this.execs.push(b)}b=function(r,o){for(var q=0,p=this.decorations.length;q<p;q+=1){if("@strip-periods"===this.decorations[q][0]&&"true"===this.decorations[q][1]){r.tmp.strip_periods+=-1;break}}};this.execs.push(b);a.build.render_nesting_level+=-1;if(a.build.render_nesting_level===0){if(a.build.cls){b=function(p,o){p.output.endTag("bib_first")};this.execs.push(b);a.build.cls=false}else{if(a.build.area==="bibliography"&&a.bibliography.opt["second-field-align"]){f=new CSL.Token("group",CSL.END);b=function(p,o){if(!p.tmp.render_seen){p.output.endTag()}};f.execs.push(b);e.push(f);c=new CSL.Token("group",CSL.START);c.decorations=[["@display","right-inline"]];b=function(p,o){if(!p.tmp.render_seen){p.tmp.render_seen=true;p.output.startTag("bib_other",c)}};c.execs.push(b);e.push(c)}}}if(a.build.substitute_level.value()===1){l=new CSL.Token("if",CSL.END);e.push(l);k=new CSL.Token("choose",CSL.END);CSL.Node.choose.build.call(k,a,e)}j="names"===this.name&&a.build.substitute_level.value()===0;h="string"===typeof a[a.build.area].opt["subsequent-author-substitute"];var d=a[a.build.area].opt["subsequent-author-substitute-rule"];if(j&&h){n=new CSL.Token("text",CSL.SINGLETON);b=function(t,q){var s,r;var v=!t.tmp.suppress_decorations;if(v&&t.tmp.area==="bibliography"&&t.tmp.subsequent_author_substitute_ok){if(t.tmp.rendered_name){if("partial-each"===d||"partial-first"===d){var u=true;var o=[];for(s=0,r=t.tmp.name_node.children.length;s<r;s+=1){var p=t.tmp.rendered_name[s];if(u&&t.tmp.last_rendered_name&&t.tmp.last_rendered_name.length>(s-1)&&p&&!p.localeCompare(t.tmp.last_rendered_name[s])){g=new CSL.Blob(t[t.tmp.area].opt["subsequent-author-substitute"]);t.tmp.name_node.children[s].blobs=[g];if("partial-first"===d){u=false}}else{u=false}o.push(p)}t.tmp.last_rendered_name=o}else{if("complete-each"===d){var o=t.tmp.rendered_name.join(",");if(o){if(!o.localeCompare(t.tmp.last_rendered_name)){for(s=0,r=t.tmp.name_node.children.length;s<r;s+=1){g=new CSL.Blob(t[t.tmp.area].opt["subsequent-author-substitute"]);t.tmp.name_node.children[s].blobs=[g]}}t.tmp.last_rendered_name=o}}else{var o=t.tmp.rendered_name.join(",");if(o){if(!o.localeCompare(t.tmp.last_rendered_name)){g=new CSL.Blob(t[t.tmp.area].opt["subsequent-author-substitute"]);if(t.tmp.label_blob){t.tmp.name_node.top.blobs=[g,t.tmp.label_blob]}else{t.tmp.name_node.top.blobs=[g]}}t.tmp.last_rendered_name=o}}}}}};n.execs.push(b);e.push(n)}if(("text"===this.name&&!this.postponed_macro)||["number","date","names"].indexOf(this.name)>-1){b=function(p,o){p.tmp.element_trace.pop()};this.execs.push(b)}};CSL.Util.padding=function(b){var a=b.match(/\s*(-{0,1}[0-9]+)/);if(a){b=parseInt(a[1],10);if(b<0){b=100000000000000000000+b}b=""+b;while(b.length<20){b="0"+b}}return b};CSL.Util.LongOrdinalizer=function(){};CSL.Util.LongOrdinalizer.prototype.init=function(a){this.state=a};CSL.Util.LongOrdinalizer.prototype.format=function(b,c){if(b<10){b="0"+b}var a=CSL.Engine.getField(CSL.LOOSE,this.state.locale[this.state.opt.lang].terms,"long-ordinal-"+b,"long",0,c);if(!a){a=this.state.fun.ordinalizer.format(b,c)}this.state.tmp.cite_renders_content=true;return a};CSL.Util.Ordinalizer=function(a){this.state=a;this.suffixes={}};CSL.Util.Ordinalizer.prototype.init=function(){if(!this.suffixes[this.state.opt.lang]){this.suffixes[this.state.opt.lang]={};for(var d=0,c=3;d<c;d+=1){var e=[undefined,"masculine","feminine"][d];this.suffixes[this.state.opt.lang][e]=[];for(var b=1;b<5;b+=1){var a=this.state.getTerm("ordinal-0"+b,"long",false,e);if("undefined"===typeof a){delete this.suffixes[this.state.opt.lang][e];break}this.suffixes[this.state.opt.lang][e].push(a)}}}};CSL.Util.Ordinalizer.prototype.format=function(d,h){var e;d=parseInt(d,10);e=""+d;var j="";var g=[];if(h){g.push(h)}g.push("neuter");if(this.state.locale[this.state.opt.lang].ord["1.0.1"]){j=this.state.getTerm("ordinal",false,0,h);var a;for(var c=0,b=g.length;c<b;c+=1){a=g[c];var f=this.state.locale[this.state.opt.lang].ord["1.0.1"];if(f["whole-number"][e]&&f["whole-number"][e][a]){j=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["whole-number"][e][a],false,0,h)}else{if(f["last-two-digits"][e.slice(e.length-2)]&&f["last-two-digits"][e.slice(e.length-2)][a]){j=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["last-two-digits"][e.slice(e.length-2)][a],false,0,h)}else{if(f["last-digit"][e.slice(e.length-1)]&&f["last-digit"][e.slice(e.length-1)][a]){j=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["last-digit"][e.slice(e.length-1)][a],false,0,h)}}}if(j){break}}}else{if(!h){h=undefined}this.state.fun.ordinalizer.init();if((d/10)%10===1||(d>10&&d<20)){j=this.suffixes[this.state.opt.lang][h][3]}else{if(d%10===1&&d%100!==11){j=this.suffixes[this.state.opt.lang][h][0]}else{if(d%10===2&&d%100!==12){j=this.suffixes[this.state.opt.lang][h][1]}else{if(d%10===3&&d%100!==13){j=this.suffixes[this.state.opt.lang][h][2]}else{j=this.suffixes[this.state.opt.lang][h][3]}}}}}e=e+=j;return e};CSL.Util.Romanizer=function(){};CSL.Util.Romanizer.prototype.format=function(d){var c,f,e,b,a;c="";if(d<6000){b=d.toString().split("");b.reverse();f=0;e=0;a=b.length;for(f=0;f<a;f+=1){e=parseInt(b[f],10);c=CSL.ROMAN_NUMERALS[f][e]+c}}return c};CSL.Util.Suffixator=function(a){if(!a){a=CSL.SUFFIX_CHARS}this.slist=a.split(",")};CSL.Util.Suffixator.prototype.format=function(b){var c;b+=1;var a="";do{c=((b%26)===0)?26:(b%26);a=this.slist[c-1]+a;b=(b-c)/26}while(b!==0);return a};CSL.Engine.prototype.processNumber=function(x,q,y,c){var l,w,A,o,z,t;var u=false;if(this.tmp.shadow_numbers[y]){if(this.tmp.shadow_numbers[y].numeric){for(var A=0,o=this.tmp.shadow_numbers[y].values.length;A<o;A+=2){this.tmp.shadow_numbers[y].values[A][2]=x}}return}this.tmp.shadow_numbers[y]={};this.tmp.shadow_numbers[y].values=[];this.tmp.shadow_numbers[y].plural=0;this.tmp.shadow_numbers[y].numeric=false;this.tmp.shadow_numbers[y].label=false;if(!q){return}var b=CSL.LangPrefsMap[y];if(b){var f=this.opt["cite-lang-prefs"][b][0];l=this.transform.getTextSubField(q,y,"locale-"+f,true);l=l.name}else{l=q[y]}if(l&&this.sys.getAbbreviation){l=(""+l).replace(/^\"/,"").replace(/\"$/,"");var p=this.transform.loadAbbreviation(q.jurisdiction,"number",l);if(this.transform.abbrevs[p].number[l]){l=this.transform.abbrevs[p].number[l]}else{if("undefined"!==typeof this.transform.abbrevs[p].number[l]){delete this.transform.abbrevs[p].number[l]}}}if("undefined"!==typeof l){if("number"===typeof l){l=""+l}this.tmp.shadow_numbers[y].label=y;if(l.slice(0,1)==='"'&&l.slice(-1)==='"'){l=l.slice(1,-1)}if(l&&["number-of-volumes","number-of-pages"].indexOf(y)>-1){var w=l.match(/[^0-9]*([0-9]+).*/);if(w){this.tmp.shadow_numbers[y].numeric=true;if(w[1]!=="1"){this.tmp.shadow_numbers[y].plural=1}}}if("locator"===y&&["bill","gazette","legislation","treaty"].indexOf(c)>-1){l=l.split(CSL.STATUTE_SUBDIV_PLAIN_REGEX)[0]}var a="page";if(["bill","gazette","legislation","legal_case","treaty"].indexOf(c)>-1&&y==="collection-number"){a="year"}if(["page","page-first"].indexOf(y)>-1){var w=l.split(" ")[0].match(CSL.STATUTE_SUBDIV_GROUPED_REGEX);if(w){if(this.opt.development_extensions.static_statute_locator){this.tmp.shadow_numbers[y].label=CSL.STATUTE_SUBDIV_STRINGS[w[0]]}var B=l.match(/[^ ]+\s+(.*)/);if(B){l=B[1]}}}var n=l.split(/(?:,\s+|\s*\\*[\-\u2013]+\s*|\s*&\s*)/);var w=l.match(/(,\s+|\s*\\*[\-\u2013]+\s*|\s*&\s*)/g);var s=[];for(var A=0,o=n.length-1;A<o;A+=1){s.push(n[A]);s.push(w[A])}s.push(n[n.length-1]);var k=0;var g=true;for(var A=0,o=s.length;A<o;A+=1){var h=((A%2)===0);if(h){if(s[A]){if(s[A].match(/(?:[0-9]|[xivcmlXIVCML])/)){if(s[A-1]&&s[A-1].match(/^\s*\\*[\-\u2013]+\s*$/)){var C=this.tmp.shadow_numbers[y].values.slice(-1);if(C[0][1].indexOf("\\")==-1){if(s[A-2]&&(""+s[A-2]).match(/(:?[a-zA-Z]*[0-9]+$|^[ivxlcmIVXLCM]+$)/)&&s[A].match(/(?:^[a-zA-Z]*[0-9]+|^[ivxlcmIVXLCM]+$)/)){var e=this.tmp.shadow_numbers[y].values.slice(-2);C[0][1]=this.getTerm(a+"-range-delimiter");if(this.opt[a+"-range-format"]){var d=this.fun[a+"_mangler"](e[0][1]+"-"+s[A]);d=d.split(this.getTerm(a+"-range-delimiter"));s[A]=d[1]}k=k+1}if(C[0][1].indexOf("--")>-1){C[0][1]=C[0][1].replace(/--*/,"\u2013")}}else{C[0][1]=C[0][1].replace(/\\/,"","g")}}else{if(s[A].indexOf(" ")===-1){k=k+1}}}var r=s[A].split(/\s+/);for(var z=0,t=r.length;z<t;z+=1){if(this.opt.development_extensions.strict_page_numbers&&y==="page"&&!r[z].match(/^-*[0-9]/)){g=false}else{if(!r[z].match(/[-0-9]/)){g=false}}}if(s[A].match(/^[1-9][0-9]*$/)){s[A]=parseInt(s[A],10);if(x&&"undefined"===typeof x.gender){x.gender=this.locale[this.opt.lang]["noun-genders"][y];if(!x.gender){x.gender=""}}this.tmp.shadow_numbers[y].values.push(["NumericBlob",s[A],x])}else{var v=s[A];this.tmp.shadow_numbers[y].values.push(["Blob",v,x])}}}else{if(s[A]){this.tmp.shadow_numbers[y].values.push(["Blob",s[A],undefined])}}}if(this.opt.development_extensions.strict_page_numbers&&y==="page"){if(l.indexOf(" ")===-1&&l.match(/^-*[0-9]/)){this.tmp.shadow_numbers[y].numeric=true}else{this.tmp.shadow_numbers[y].numeric=g}}else{if(l.indexOf(" ")===-1&&l.match(/[0-9]/)){this.tmp.shadow_numbers[y].numeric=true}else{this.tmp.shadow_numbers[y].numeric=g}}if(!this.tmp.shadow_numbers[y].numeric){this.transform.loadAbbreviation(q.jurisdiction,"number",l)}if(k>1){this.tmp.shadow_numbers[y].plural=1}if(q.force_pluralism===1){this.tmp.shadow_numbers[y].plural=1}else{if(q.force_pluralism===0){this.tmp.shadow_numbers[y].plural=0}}}};CSL.Util.PageRangeMangler={};CSL.Util.PageRangeMangler.getFunction=function(j,a){var g,k,r,p,t,c,d,f,q,l,o,x,u,A,w,h,n,z,v;var s=j.getTerm(a+"-range-delimiter");g=/([a-zA-Z]*)([0-9]+)\s*(?:\u2013|-)\s*([a-zA-Z]*)([0-9]+)/;p=function(b){r=b.length;for(k=1;k<r;k+=2){if("object"===typeof b[k]){b[k]=b[k].join("")}}var e=b.join("");e=e.replace(/([^\\])\-/g,"$1"+j.getTerm(a+"-range-delimiter"));return e};t=function(E){var b,C,D;var B="\\s+\\-\\s+";var G=s==="-"?"":s;var H=new RegExp("([^\\\\])[-"+G+"\\u2013]","g");E=E.replace(H,"$1 - ").replace(/\s+-\s+/g," - ");var F=new RegExp("([a-zA-Z]*[0-9]+"+B+"[a-zA-Z]*[0-9]+)","g");var e=new RegExp("[a-zA-Z]*[0-9]+"+B+"[a-zA-Z]*[0-9]+");b=E.match(F);C=E.split(e);if(C.length===0){D=b}else{D=[C[0]];for(k=1,r=C.length;k<r;k+=1){D.push(b[k-1].replace(/\s*\-\s*/,"-","g"));D.push(C[k])}}return D};c=function(b){b=""+b;l=t(b);r=l.length;for(k=1;k<r;k+=2){o=l[k].match(g);if(o){if(!o[3]||o[1]===o[3]){if(o[4].length<o[2].length){o[4]=o[2].slice(0,(o[2].length-o[4].length))+o[4]}if(parseInt(o[2],10)<parseInt(o[4],10)){o[3]=s+o[1];l[k]=o.slice(1)}}}if("string"===typeof l[k]){l[k]=l[k].replace("-",s,"g")}}return l};d=function(e,b,D){r=e.length;for(var C=1,B=e.length;C<B;C+=2){e[C][3]=f(e[C][1],e[C][3],b,D);if(e[C][2].slice(1)===e[C][0]){e[C][2]=s}}return p(e)};f=function(D,e,b,F){if(!b){b=0}x=(""+D).split("");u=(""+e).split("");A=u.slice();A.reverse();if(x.length===u.length){for(var C=0,B=x.length;C<B;C+=1){if(x[C]===u[C]&&A.length>b){A.pop()}else{if(b&&F&&A.length===3){var E=x.slice(0,C);E.reverse();A=A.concat(E)}break}}}A.reverse();return A.join("")};q=function(b){r=b.length;for(k=1;k<r;k+=2){if("object"===typeof b[k]){o=b[k];w=parseInt(o[1],10);h=parseInt(o[3],10);if(w>100&&w%100&&parseInt((w/100),10)===parseInt((h/100),10)){o[3]=""+(h%100)}else{if(w>=10000){o[3]=""+(h%1000)}}}if(o[2].slice(1)===o[0]){o[2]=s}}return p(b)};var y=function(E,C,e,D){var B;E=""+E;var b=c(E);var B=C(b,e,D);return B};if(!j.opt[a+"-range-format"]){n=function(b){return b}}else{if(j.opt[a+"-range-format"]==="expanded"){n=function(b){return y(b,p)}}else{if(j.opt[a+"-range-format"]==="minimal"){n=function(b){return y(b,d)}}else{if(j.opt[a+"-range-format"]==="minimal-two"){n=function(e,b){return y(e,d,2,b)}}else{if(j.opt[a+"-range-format"]==="chicago"){n=function(b){return y(b,q)}}}}}}return n};CSL.Util.FlipFlopper=function(f){var w,h,t,q,b,l,x,o,v,j,c,e,r,s,g,d,k,n;this.state=f;this.blob=false;this.quotechars=['"',"'"];w=[["<i>","</i>","italics","@font-style",["italic","normal","normal"],true],["<b>","</b>","bold","@font-weight",["bold","normal","normal"],true],["<sup>","</sup>","superscript","@vertical-align",["sup","sup","baseline"],true],["<sub>","</sub>","subscript","@vertical-align",["sub","sub","baseline"],true],["<sc>","</sc>","smallcaps","@font-variant",["small-caps","small-caps","normal"],true],['<span style="font-variant:small-caps;">',"</span>","smallcaps","@font-variant",["small-caps","normal","normal"],true],['<span class="nocase">',"</span>","passthrough","@passthrough",["true","true","true"],true],['<span class="nodecor">',"</span>","passthrough","@passthrough",["true","true","true"],true],['"','"',"quotes","@quotes",["true","inner","true"],"'"],[" '","'","quotes","@quotes",["inner","true","true"],'"']];for(h=0;h<2;h+=1){q=["-","-inner-"][h];b=[];var a=f.getTerm(("open"+q+"quote"));b.push(a);this.quotechars.push(a);var u=f.getTerm(("close"+q+"quote"));b.push(u);this.quotechars.push(u);b.push(("quotes"));b.push(("@quotes"));if("-"===q){b.push(["true","inner"])}else{b.push(["inner","true"])}b.push(true);if("-"===q){b.push(f.getTerm(("close-inner-quote")))}else{b.push(f.getTerm(("close-quote")))}w.push(b)}l=function(p){x=[];t=p.length;for(h=0;h<t;h+=1){o=p[h];if(x.indexOf(o[0])===-1){v="";if(["(",")","[","]"].indexOf(o[0])>-1){v="\\"}x.push(v+o[0])}if(x.indexOf(o[1])===-1){v="";if(["(",")","[","]"].indexOf(o[1])>-1){v="\\"}x.push(v+o[1])}}return x};k=l(w);n=[];for(h=0,t=k.length;h<t;h+=1){if(k[h]){n.push(k[h])}}k=n.slice();this.allTagsRexMatch=new RegExp("("+k.join("|")+")","g");this.allTagsRexSplit=new RegExp("(?:"+k.join("|")+")");j=function(p){c={};e={};r={};s={};g={};t=p.length;for(h=0;h<t;h+=1){c[p[h][1]]=true;e[p[h][1]]=p[h][5];r[p[h][0]]=p[h][1];s[p[h][0]]=[p[h][3],p[h][4]];g[p[h][3]]=[p[h][3],[p[h][4][2],p[h][1]]]}return[c,e,r,s,g]};d=j(w);this.closeTagsHash=d[0];this.flipTagsHash=d[1];this.openToCloseHash=d[2];this.openToDecorations=d[3];this.okReverseHash=d[4]};CSL.Util.FlipFlopper.prototype.init=function(b,a){this.txt_esc=CSL.getSafeEscape(this.state);if(!a){this.strs=this.getSplitStrings(b);this.blob=new CSL.Blob()}else{this.blob=a;this.strs=this.getSplitStrings(this.blob.blobs);this.blob.blobs=[]}this.blobstack=new CSL.Stack(this.blob)};CSL.Util.FlipFlopper.prototype._normalizeString=function(c){var b,a;c=c.replace(/\s+'\s+/g," ’ ");if(c.indexOf(this.quotechars[0])>-1){for(b=0,a=2;b<a;b+=1){if(this.quotechars[b+2]){c=c.replace(this.quotechars[b+2],this.quotechars[0])}}}if(c.indexOf(this.quotechars[1])>-1){for(b=0,a=2;b<a;b+=1){if(this.quotechars[b+4]){if(b===0){c=c.replace(this.quotechars[b+4]," "+this.quotechars[1])}else{c=c.replace(this.quotechars[b+4],this.quotechars[1])}}}}return c};CSL.Util.FlipFlopper.prototype.getSplitStrings=function(w){var v,h,x,d,f,n,g,q,A,r,b,B,u,o,k,F,j,z,t,y,s,l,C,a,E,D,c,p,e;w=this._normalizeString(w);p=w.match(this.allTagsRexMatch);v=w.split(this.allTagsRexSplit);e=[v[0]];for(h=1,x=v.length;h<x;h+=1){e.push(p[h-1]);e.push(v[h])}v=e.slice();x=v.length-2;for(h=x;h>0;h+=-2){if(v[(h-1)].slice((v[(h-1)].length-1))==="\\"){d=v[(h-1)].slice(0,(v[(h-1)].length-1))+v[h]+v[(h+1)];f=v.slice(0,(h-1));n=v.slice((h+2));f.push(d);v=f.concat(n)}}g=[];q=[];A=[];r=[];b=[];a=v.length-1;for(B=1;B<a;B+=2){F=v[B];if(this.closeTagsHash[F]){g.reverse();u=this.openToCloseHash[F];o=g.indexOf(F);k=A.indexOf(F);g.reverse();if(!u||(o>-1&&(o<k||k===-1))){j=false;E=g.length-1;for(z=E;z>-1;z+=-1){j=true;t=g[z];if(F===t){g.pop();q.pop();A.pop();r.pop();break}b.push(B)}if(!j){b.push(B)}continue}}if(this.openToCloseHash[F]){g.push(this.openToCloseHash[F]);q.push(F);A.push(this.flipTagsHash[F]);r.push(B)}}D=g.length-1;for(y=D;y>-1;y+=-1){g.pop();A.pop();q.pop();b.push(r.pop())}b.sort(function(H,G){if(H<G){return 1}else{if(H>G){return -1}}return 0});x=b.length;for(h=0;h<x;h+=1){c=b[h];f=v.slice(0,(c-1));n=v.slice((c+2));s=v[c];if(s.length&&s[0]!=="<"&&this.openToDecorations[s]&&this.quotechars.indexOf(s.replace(/\s+/g,""))===-1){C=this.openToDecorations[s];s=this.state.fun.decorate[C[0]][C[1][0]](this.state)}l=v[(c-1)]+s+v[(c+1)];f.push(l);v=f.concat(n)}x=v.length;for(h=0;h<x;h+=2){v[h]=v[h].replace("'","\u2019","g");v[h]=v[h].replace("  \u2019"," \u2019","g")}return v};CSL.Util.FlipFlopper.prototype.processTags=function(){var f,k,t,q,p,v,z,s,e,c,o,j,h,u,l,n,g,d,b,w,a,y,r,x;f=[];k=[];t=[];q=[];p="";if(this.strs.length===1){this.blob.blobs=this.strs[0]}else{if(this.strs.length>2){a=(this.strs.length-1);for(v=1;v<a;v+=2){z=this.strs[v];s=this.strs[(v-1)];if(s){e=new CSL.Blob(s);c=this.blobstack.value();c.push(e)}if(this.closeTagsHash[z]){f.reverse();o=this.openToCloseHash[z];j=f.indexOf(z);h=t.indexOf(z);f.reverse();if(!o||(j>-1&&(j<h||h===-1))){y=f.length;for(u=y;u>-1;u+=-1){l=f[u];if(z===l){f.pop();k.pop();t.pop();q.pop();this.blobstack.pop();break}}continue}}if(this.openToCloseHash[z]){f.push(this.openToCloseHash[z]);k.push(z);t.push(this.flipTagsHash[z]);c=this.blobstack.value();n=new CSL.Blob();c.push(n);g=this.addFlipFlop(n,this.openToDecorations[z]);if(z==='<span class="nodecor">'){d=this.state[this.state.tmp.area].opt.topdecor.concat(this.blob.alldecor).concat([[["@quotes","inner"]]]);y=d.length;for(u=0;u<y;u+=1){b=d[u];x=b.length;for(r=0;r<x;r+=1){w=b[r];if(["@font-style","@font-weight","@font-variant"].indexOf(w[0])>-1){g=this.addFlipFlop(n,this.okReverseHash[w[0]])}}}}q.push(this.state.fun.decorate[g[0]][g[1]](this.state));this.blobstack.push(n)}}if(this.strs.length>2){p=this.strs[(this.strs.length-1)];if(p){c=this.blobstack.value();e=new CSL.Blob(p);c.push(e)}}}}return this.blob};CSL.Util.FlipFlopper.prototype.addFlipFlop=function(b,j){var c,a,k,h,e,d,l,n,f,g;a=0;k=this.state[this.state.tmp.area].opt.topdecor.concat(b.alldecor).concat([[["@quotes","inner"]]]);h=k.length;for(c=0;c<h;c+=1){e=k[c];d=false;g=e.length-1;for(n=g;n>-1;n+=-1){l=e[n];if(l[0]===j[0]){if(l[1]===j[1][0]){a=1}d=true;break}}if(d){break}}f=[j[0],j[1][a]];b.decorations.reverse();b.decorations.push(f);b.decorations.reverse();return f};CSL.Output.Formatters={};CSL.getSafeEscape=function(b){if(["bibliography","citation"].indexOf(b.tmp.area)>-1){var a=[];if(b.opt.development_extensions.thin_non_breaking_space_html_hack&&b.opt.mode==="html"){a.push(function(c){return c.replace(/\u202f/g,'<span style="white-space:nowrap">&thinsp;</span>')})}if(a.length){return function(c){for(var e=0,d=a.length;e<d;e+=1){c=a[e](c)}return CSL.Output.Formats[b.opt.mode].text_escape(c)}}else{return CSL.Output.Formats[b.opt.mode].text_escape}}else{return function(c){return c}}};CSL.Output.Formatters.passthrough=function(b,a){return a};CSL.Output.Formatters.lowercase=function(b,a){var c=CSL.Output.Formatters.doppelString(a,CSL.TAG_USEALL);c.string=c.string.toLowerCase();return CSL.Output.Formatters.undoppelString(c)};CSL.Output.Formatters.uppercase=function(b,a){var c=CSL.Output.Formatters.doppelString(a,CSL.TAG_USEALL);c.string=c.string.toUpperCase();return CSL.Output.Formatters.undoppelString(c)};CSL.Output.Formatters["capitalize-first"]=function(b,a){var c=CSL.Output.Formatters.doppelString(a,CSL.TAG_ESCAPE);if(c.string.length){c.string=c.string.slice(0,1).toUpperCase()+c.string.substr(1);return CSL.Output.Formatters.undoppelString(c)}else{return""}};CSL.Output.Formatters.sentence=function(b,a){var c=CSL.Output.Formatters.doppelString(a,CSL.TAG_ESCAPE);c.string=c.string.slice(0,1).toUpperCase()+c.string.substr(1).toLowerCase();return CSL.Output.Formatters.undoppelString(c)};CSL.Output.Formatters["capitalize-all"]=function(e,b){var f=CSL.Output.Formatters.doppelString(b,CSL.TAG_ESCAPE);var a=f.string.split(" ");for(var d=0,c=a.length;d<c;d+=1){if(a[d].length>1){if(e.opt.development_extensions.allow_force_lowercase){a[d]=a[d].slice(0,1).toUpperCase()+a[d].substr(1).toLowerCase()}else{a[d]=a[d].slice(0,1).toUpperCase()+a[d].substr(1)}}else{if(a[d].length===1){a[d]=a[d].toUpperCase()}}}f.string=a.join(" ");return CSL.Output.Formatters.undoppelString(f)};CSL.Output.Formatters.title=function(f,a){var w,t,C,e,d,H,u,B,h,v,D,b,p,A,r,E,j,G,q,o,g;var s=f.locale[f.opt.lang].opts["skip-words"];if(!a){return""}var n=CSL.Output.Formatters.doppelString(a,CSL.TAG_ESCAPE);function c(I){var k=I.match(/([:?!]+\s+|-|^)(.)(.*)/);if(k){return k[1]+k[2].toUpperCase()+k[3]}return I}var w=n.string;var o=w.split(f.locale[f.opt.lang].opts["skip-words-regexp"]);for(z=1,l=o.length;z<l;z+=2){if(o[z].match(/^[:?!]/)){o[z]=c(o[z])}}if(!o[0]){o[1]=c(o[1])}if(o.length>2&&!o[o.length-1]){o[o.length-2]=c(o[o.length-2])}for(var z=0,l=o.length;z<l;z+=2){var t=o[z].split(/([:?!]*\s+|-)/);for(var y=0,x=t.length;y<x;y+=2){if(t[y].length!==0){u=t[y].toUpperCase();B=t[y].toLowerCase();if(t[y].match(/[0-9]/)){continue}if(t[y]===B){t[y]=c(t[y])}}}o[z]=t.join("")}n.string=o.join("");var F=CSL.Output.Formatters.undoppelString(n);return F};CSL.Output.Formatters.doppelString=function(c,g){var b,f,a;b={};b.array=g(c);b.string="";for(var e=0,d=b.array.length;e<d;e+=2){if(b.array[e-1]==="-"&&false){b.string+=" "+b.array[e]}else{b.string+=b.array[e]}}return b};CSL.Output.Formatters.undoppelString=function(e){var b,a,f;b="";for(var d=0,c=e.array.length;d<c;d+=1){if((d%2)){b+=e.array[d]}else{if(e.array[d-1]==="-"&&false){b+=e.string.slice(0,e.array[d].length+1).slice(1);e.string=e.string.slice(e.array[d].length+1)}else{b+=e.string.slice(0,e.array[d].length);e.string=e.string.slice(e.array[d].length)}}}return b};CSL.Output.Formatters.serializeItemAsRdf=function(a){return""};CSL.Output.Formatters.serializeItemAsRdfA=function(a){return""};CSL.demoteNoiseWords=function(e,d,c){var g=e.locale[e.opt.lang].opts["leading-noise-words"];if(d&&c){d=d.split(/\s+/);d.reverse();var f=[];for(var b=d.length-1;b>-1;b+=-1){if(g.indexOf(d[b].toLowerCase())>-1){f.push(d.pop())}else{break}}d.reverse();var h=d.join(" ");var a=f.join(" ");if("drop"===c||!a){d=h}else{if("demote"===c){d=[h,a].join(", ")}}}return d};CSL.Output.Formats=function(){};CSL.Output.Formats.prototype.html={text_escape:function(a){if(!a){a=""}return a.replace(/&/g,"&#38;").replace(/</g,"&#60;").replace(/>/g,"&#62;").replace("  ","&#160; ","g").replace(CSL.SUPERSCRIPTS_REGEXP,function(b){return"<sup>"+CSL.SUPERSCRIPTS[b]+"</sup>"})},bibstart:'<div class="csl-bib-body">\n',bibend:"</div>","@font-style/italic":"<i>%%STRING%%</i>","@font-style/oblique":"<em>%%STRING%%</em>","@font-style/normal":'<span style="font-style:normal;">%%STRING%%</span>',"@font-variant/small-caps":'<span style="font-variant:small-caps;">%%STRING%%</span>',"@passthrough/true":CSL.Output.Formatters.passthrough,"@font-variant/normal":'<span style="font-variant:normal;">%%STRING%%</span>',"@font-weight/bold":"<b>%%STRING%%</b>","@font-weight/normal":'<span style="font-weight:normal;">%%STRING%%</span>',"@font-weight/light":false,"@text-decoration/none":'<span style="text-decoration:none;">%%STRING%%</span>',"@text-decoration/underline":'<span style="text-decoration:underline;">%%STRING%%</span>',"@vertical-align/sup":"<sup>%%STRING%%</sup>","@vertical-align/sub":"<sub>%%STRING%%</sub>","@vertical-align/baseline":'<span style="baseline">%%STRING%%</span>',"@strip-periods/true":CSL.Output.Formatters.passthrough,"@strip-periods/false":CSL.Output.Formatters.passthrough,"@quotes/true":function(a,b){if("undefined"===typeof b){return a.getTerm("open-quote")}return a.getTerm("open-quote")+b+a.getTerm("close-quote")},"@quotes/inner":function(a,b){if("undefined"===typeof b){return"\u2019"}return a.getTerm("open-inner-quote")+b+a.getTerm("close-inner-quote")},"@quotes/false":false,"@cite/entry":function(a,b){return a.sys.wrapCitationEntry(b,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(b,c){var a="";if(b.sys.embedBibliographyEntry){a=b.sys.embedBibliographyEntry(this.item_id)+"\n"}return'  <div class="csl-entry">'+c+"</div>\n"+a},"@display/block":function(a,b){return'\n\n    <div class="csl-block">'+b+"</div>\n"},"@display/left-margin":function(a,b){return'\n    <div class="csl-left-margin">'+b+"</div>"},"@display/right-inline":function(a,b){return'<div class="csl-right-inline">'+b+"</div>\n  "},"@display/indent":function(a,b){return'<div class="csl-indent">'+b+"</div>\n  "},"@showid/true":function(e,f,b){if(!e.tmp.just_looking&&!e.tmp.suppress_decorations){if(b){return'<span class="'+e.opt.nodenames[b]+'" cslid="'+b+'">'+f+"</span>"}else{if("string"===typeof f){var d="";if(f){var a=f.match(CSL.VARIABLE_WRAPPER_PREPUNCT_REX);d=a[1];f=a[2]}var c="";if(f&&CSL.SWAPPING_PUNCTUATION.indexOf(f.slice(-1))>-1){c=f.slice(-1);f=f.slice(0,-1)}return e.sys.variableWrapper(this.params,d,f,c)}else{return f}}}else{return f}},"@URL/true":function(a,b){return'<a href="'+b+'">'+b+"</a>"},"@DOI/true":function(a,b){return'<a href="http://dx.doi.org/'+b+'">'+b+"</a>"}};CSL.Output.Formats.prototype.text={text_escape:function(a){if(!a){a=""}return a},bibstart:"",bibend:"","@font-style/italic":false,"@font-style/oblique":false,"@font-style/normal":false,"@font-variant/small-caps":false,"@passthrough/true":CSL.Output.Formatters.passthrough,"@font-variant/normal":false,"@font-weight/bold":false,"@font-weight/normal":false,"@font-weight/light":false,"@text-decoration/none":false,"@text-decoration/underline":false,"@vertical-align/baseline":false,"@vertical-align/sup":false,"@vertical-align/sub":false,"@strip-periods/true":CSL.Output.Formatters.passthrough,"@strip-periods/false":CSL.Output.Formatters.passthrough,"@quotes/true":function(a,b){if("undefined"===typeof b){return a.getTerm("open-quote")}return a.getTerm("open-quote")+b+a.getTerm("close-quote")},"@quotes/inner":function(a,b){if("undefined"===typeof b){return"\u2019"}return a.getTerm("open-inner-quote")+b+a.getTerm("close-inner-quote")},"@quotes/false":false,"@cite/entry":function(a,b){return a.sys.wrapCitationEntry(b,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(a,b){return b+"\n"},"@display/block":function(a,b){return"\n"+b},"@display/left-margin":function(a,b){return b},"@display/right-inline":function(a,b){return b},"@display/indent":function(a,b){return"\n    "+b},"@showid/true":function(b,c,a){return c},"@URL/true":function(a,b){return b},"@DOI/true":function(a,b){return b}};CSL.Output.Formats.prototype.rtf={text_escape:function(a){if(!a){a=""}return a.replace(/([\\{}])/g,"\\$1","g").replace(CSL.SUPERSCRIPTS_REGEXP,function(b){return"\\super "+CSL.SUPERSCRIPTS[b]+"\\nosupersub{}"}).replace(/[\u007F-\uFFFF]/g,function(b){return"\\uc0\\u"+b.charCodeAt(0).toString()+"{}"}).replace("\t","\\tab{}","g")},"@passthrough/true":CSL.Output.Formatters.passthrough,"@font-style/italic":"\\i %%STRING%%\\i0{}","@font-style/normal":"\\i0{}%%STRING%%\\i{}","@font-style/oblique":"\\i %%STRING%%\\i0{}","@font-variant/small-caps":"\\scaps %%STRING%%\\scaps0{}","@font-variant/normal":"\\scaps0{}%%STRING%%\\scaps{}","@font-weight/bold":"\\b %%STRING%%\\b0{}","@font-weight/normal":"\\b0{}%%STRING%%\\b{}","@font-weight/light":false,"@text-decoration/none":false,"@text-decoration/underline":"\\ul %%STRING%%\\ul0{}","@vertical-align/baseline":false,"@vertical-align/sup":"\\super %%STRING%%\\nosupersub{}","@vertical-align/sub":"\\sub %%STRING%%\\nosupersub{}","@strip-periods/true":CSL.Output.Formatters.passthrough,"@strip-periods/false":CSL.Output.Formatters.passthrough,"@quotes/true":function(a,b){if("undefined"===typeof b){return CSL.Output.Formats.rtf.text_escape(a.getTerm("open-quote"))}return CSL.Output.Formats.rtf.text_escape(a.getTerm("open-quote"))+b+CSL.Output.Formats.rtf.text_escape(a.getTerm("close-quote"))},"@quotes/inner":function(a,b){if("undefined"===typeof b){return CSL.Output.Formats.rtf.text_escape("\u2019")}return CSL.Output.Formats.rtf.text_escape(a.getTerm("open-inner-quote"))+b+CSL.Output.Formats.rtf.text_escape(a.getTerm("close-inner-quote"))},"@quotes/false":false,bibstart:"{\\rtf ",bibend:"}","@display/block":"\\line{}%%STRING%%\\line\r\n","@cite/entry":function(a,b){return b},"@cite/entry":function(a,b){return a.sys.wrapCitationEntry(b,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(a,b){return b},"@display/left-margin":function(a,b){return b+"\\tab "},"@display/right-inline":function(a,b){return b+"\\line\r\n"},"@display/indent":function(a,b){return"\n\\tab "+b+"\\line\r\n"},"@showid/true":function(e,f,b){if(!e.tmp.just_looking&&!e.tmp.suppress_decorations){var d="";if(f){var a=f.match(CSL.VARIABLE_WRAPPER_PREPUNCT_REX);d=a[1];f=a[2]}var c="";if(f&&CSL.SWAPPING_PUNCTUATION.indexOf(f.slice(-1))>-1){c=f.slice(-1);f=f.slice(0,-1)}return e.sys.variableWrapper(this.params,d,f,c)}else{return f}},"@URL/true":function(a,b){return b},"@DOI/true":function(a,b){return b}};CSL.Output.Formats=new CSL.Output.Formats();CSL.Registry=function(e){var f,a,b,d,c;this.debug=false;this.state=e;this.registry={};this.reflist=[];this.namereg=new CSL.Registry.NameReg(e);this.citationreg=new CSL.Registry.CitationReg(e);this.authorstrings={};this.mylist=[];this.myhash={};this.deletes=[];this.inserts=[];this.uncited={};this.refreshes={};this.akeys={};this.oldseq={};this.return_data={};this.ambigcites={};this.ambigresets={};this.sorter=new CSL.Registry.Comparifier(e,"bibliography_sort");this.getSortedIds=function(){b=[];for(d=0,c=this.reflist.length;d<c;d+=1){b.push(""+this.reflist[d].id)}return b};this.getSortedRegistryItems=function(){b=[];for(d=0,c=this.reflist.length;d<c;d+=1){b.push(this.reflist[d])}return b}};CSL.Registry.prototype.init=function(b,f){var e,d;this.oldseq={};if(f){this.uncited={};for(var e=0,d=b.length;e<d;e+=1){if(!this.myhash[b[e]]){this.mylist.push(""+b[e])}this.uncited[b[e]]=true;this.myhash[b[e]]=true}}else{for(var c in this.uncited){b.push(c)}var a={};for(e=b.length-1;e>-1;e+=-1){if(a[b[e]]){b=b.slice(0,e).concat(b.slice(e+1))}else{a[b[e]]=true}}this.mylist=[];for(var e=0,d=b.length;e<d;e+=1){this.mylist.push(""+b[e])}this.myhash=a}this.refreshes={};this.touched={};this.ambigsTouched={};this.ambigresets={}};CSL.Registry.prototype.dopurge=function(a){for(var b=this.mylist.length-1;b>-1;b+=-1){if(this.citationreg.citationsByItemId){if(!this.citationreg.citationsByItemId[this.mylist[b]]&&!a[this.mylist[b]]){delete this.myhash[this.mylist[b]];this.mylist=this.mylist.slice(0,b).concat(this.mylist.slice(b+1))}}}this.dodeletes(this.myhash)};CSL.Registry.prototype.dodeletes=function(a){var c,u,r,d,q,g,s,f,h;if("string"===typeof a){a={};a[a]=true}for(u in this.registry){if(!a[u]){if(this.uncited[u]){continue}c=this.namereg.delitems(u);for(s in c){this.refreshes[s]=true}r=this.registry[u].ambig;f=this.ambigcites[r].indexOf(u);if(f>-1){g=this.ambigcites[r].slice();this.ambigcites[r]=g.slice(0,f).concat(g.slice(f+1,g.length));this.ambigresets[r]=this.ambigcites[r].length}q=this.ambigcites[r].length;for(d=0;d<q;d+=1){h=""+this.ambigcites[r][d];this.refreshes[h]=true}if(this.registry[u].siblings){if(this.registry[u].siblings.length==1){var t=this.registry[u].siblings[0];this.registry[t].master=true;this.registry[t].siblings.pop();this.registry[t].parallel=false}else{if(this.registry[u].siblings.length>1){var p=[u];if(this.registry[u].master){var e=this.registry[u].siblings[0];var b=this.registry[e];b.master=true;b.parallel=false;p.push(e);for(var o=0,l=this.registry[u].siblings.length;o<l;o+=1){this.registry[this.registry[u].siblings[o]].parallel=e}}var n=[];for(var o=this.registry[u].siblings.length-1;o>-1;o+=-1){var j=this.registry[u].siblings.pop();if(p.indexOf(j)===-1){n.push(j)}}for(var o=n.length-1;o>-1;o+=-1){this.registry[u].siblings.push(n[o])}}}}delete this.registry[u];this.return_data.bibchange=true}}};CSL.Registry.prototype.doinserts=function(g){var l,p,r,c,h,b,o,e,q,d,n,f,a;if("string"===typeof g){g=[g]}for(f=0,a=g.length;f<a;f+=1){r=g[f];if(!this.registry[r]){c=this.state.retrieveItem(r);h=CSL.getAmbiguousCite.call(this.state,c);this.ambigsTouched[h]=true;if(!c.legislation_id){this.akeys[h]=true}b={id:""+r,seq:0,offset:0,sortkeys:false,ambig:false,rendered:false,disambig:false,ref:c};this.registry[r]=b;if(this.citationreg.citationsByItemId&&this.citationreg.citationsByItemId[r]){this.registry[r]["first-reference-note-number"]=this.citationreg.citationsByItemId[r][0].properties.noteIndex}o=CSL.getAmbigConfig.call(this.state);this.registerAmbigToken(h,r,o);this.touched[r]=true;this.return_data.bibchange=true}}};CSL.Registry.prototype.rebuildlist=function(){var c,a,d,b;this.reflist=[];if(this.state.opt.citation_number_sort_direction===CSL.DESCENDING&&this.state.opt.citation_number_sort_used){}a=this.mylist.length;for(d=0;d<a;d+=1){b=this.mylist[d];this.reflist.push(this.registry[b]);this.oldseq[b]=this.registry[b].seq;this.registry[b].seq=(d+1)}if(this.state.opt.citation_number_sort_direction===CSL.DESCENDING&&this.state.opt.citation_number_sort_used){}};CSL.Registry.prototype.dorefreshes=function(){var e,b,c,g,h,f;for(e in this.refreshes){b=this.registry[e];if(!b){continue}b.sortkeys=undefined;c=this.state.retrieveItem(e);var h=b.ambig;if("undefined"===typeof h){this.state.tmp.disambig_settings=false;h=CSL.getAmbiguousCite.call(this.state,c);f=CSL.getAmbigConfig.call(this.state);this.registerAmbigToken(h,e,f)}for(var a in this.ambigresets){if(this.ambigresets[a]===1){var d=this.ambigcites[h][0];var c=this.state.retrieveItem(d);this.registry[d].disambig=new CSL.AmbigConfig;this.state.tmp.disambig_settings=false;var h=CSL.getAmbiguousCite.call(this.state,c);var f=CSL.getAmbigConfig.call(this.state);this.registerAmbigToken(h,d,f)}}this.state.tmp.taintedItemIDs[e]=true;this.ambigsTouched[h]=true;if(!c.legislation_id){this.akeys[h]=true}this.touched[e]=true}};CSL.Registry.prototype.setdisambigs=function(){var f,c,b,e,a,d;this.leftovers=[];for(f in this.ambigsTouched){this.state.disambiguate.run(f)}this.ambigsTouched={};this.akeys={}};CSL.Registry.prototype.renumber=function(){var a,c,b;if(this.state.opt.citation_number_sort_direction===CSL.DESCENDING&&this.state.opt.citation_number_sort_used){}a=this.reflist.length;for(c=0;c<a;c+=1){b=this.reflist[c];b.seq=(c+1);if(this.state.opt.update_mode===CSL.NUMERIC&&b.seq!=this.oldseq[b.id]){this.state.tmp.taintedItemIDs[b.id]=true}if(this.state.opt.bib_mode===CSL.NUMERIC&&b.seq!=this.oldseq[b.id]){this.return_data.bibchange=true}}if(this.state.opt.citation_number_sort_direction===CSL.DESCENDING&&this.state.opt.citation_number_sort_used){this.reflist.reverse()}};CSL.Registry.prototype.setsortkeys=function(){var c;for(var b=0,a=this.mylist.length;b<a;b+=1){var c=this.mylist[b];if(this.touched[c]||this.state.tmp.taintedItemIDs[c]||!this.registry[c].sortkeys){this.registry[c].sortkeys=CSL.getSortKeys.call(this.state,this.state.retrieveItem(c),"bibliography_sort")}}};CSL.Registry.prototype.sorttokens=function(){this.reflist.sort(this.sorter.compareKeys)};CSL.Registry.Comparifier=function(f,d){var b,a,g,e;var c=CSL.getSortCompare(f.opt["default-locale-sort"]);b=f[d].opt.sort_directions;this.compareKeys=function(j,h){a=j.sortkeys?j.sortkeys.length:0;for(g=0;g<a;g+=1){var k=0;if(j.sortkeys[g]===h.sortkeys[g]){k=0}else{if("undefined"===typeof j.sortkeys[g]){k=b[g][1]}else{if("undefined"===typeof h.sortkeys[g]){k=b[g][0]}else{k=c(j.sortkeys[g],h.sortkeys[g])}}}if(0<k){return b[g][1]}else{if(0>k){return b[g][0]}}}if(j.seq>h.seq){return 1}else{if(j.seq<h.seq){return -1}}return 0};e=this.compareKeys;this.compareCompositeKeys=function(j,h){return e(j[1],h[1])}};CSL.Registry.prototype.compareRegistryTokens=function(d,c){if(d.seq>c.seq){return 1}else{if(d.seq<c.seq){return -1}}return 0};CSL.Registry.prototype.registerAmbigToken=function(k,b,e){if(this.registry[b]&&this.registry[b].disambig&&this.registry[b].disambig.names){for(var h=0,c=e.names.length;h<c;h+=1){var d=e.names[h];var a=this.registry[b].disambig.names[h];if(d!==a){this.state.tmp.taintedItemIDs[b]=true}else{if(e.givens[h]){for(var g=0,o=e.givens[h].length;g<o;g+=1){var l=e.givens[h][g];var f=this.registry[b].disambig.givens[h][g];if(l!==f){this.state.tmp.taintedItemIDs[b]=true}}}}}}if(!this.ambigcites[k]){this.ambigcites[k]=[]}if(this.ambigcites[k].indexOf(""+b)===-1){this.ambigcites[k].push(""+b)}this.registry[b].ambig=k;var n=false;this.registry[b].disambig=CSL.cloneAmbigConfig(e)};CSL.getSortKeys=function(b,f){var e,h,d,c,a,g;e=this.tmp.area;h=this.tmp.extension;d=CSL.Util.Sort.strip_prepositions;this.tmp.area=f;this.tmp.extension="_sort";this.tmp.disambig_override=true;this.tmp.disambig_request=false;c=this.parallel.use_parallels;this.parallel.use_parallels=false;this.tmp.suppress_decorations=true;CSL.getCite.call(this,b);this.tmp.suppress_decorations=false;this.parallel.use_parallels=c;this.tmp.disambig_override=false;a=this[f].keys.length;for(g=0;g<a;g+=1){this[f].keys[g]=d(this[f].keys[g])}this.tmp.area=e;this.tmp.extension=h;return this[f].keys};CSL.Registry.NameReg=function(b){var o,k,a,r,n,h,f,t,d,j,u,e,c,p,l,v,s,q,g;this.state=b;this.namereg={};this.nameind={};this.nameindpkeys={};this.itemkeyreg={};u=function(w){if(!w){w=""}return w.replace("."," ","g").replace(/\s+/g," ").replace(/\s+$/,"")};e=function(z,y,x){o=u(x.family);a=u(x.given);var w=a.match(/[,\!]* ([^,]+)$/);if(w&&w[1]===w[1].toLowerCase()){a=a.replace(/[,\!]* [^,]+$/,"")}k=CSL.Util.Names.initializeWith(z,a,"%s");if(z.citation.opt["givenname-disambiguation-rule"]==="by-cite"){o=""+y+o}};c=function(H,F,G,y,w,x){var E,B,D,z;if(b.tmp.area.slice(0,12)==="bibliography"&&!w){if("string"===typeof x){return 1}else{return 2}}var C=b.nameOutput.getName(F,"locale-translit",true);F=C.name;e(this.state,""+H,F);z=2;h=b.opt["disambiguate-add-givenname"];f=b.citation.opt["givenname-disambiguation-rule"];var A=f;if(f==="by-cite"){f="all-names"}if("short"===w){z=0}else{if("string"===typeof x){z=1}}if("undefined"===typeof this.namereg[o]||"undefined"===typeof this.namereg[o].ikey[k]){return z}if(A==="by-cite"&&z<=y){return y}if(!h){return z}if("string"===typeof f&&f.slice(0,12)==="primary-name"&&G>0){return z}if(!f||f==="all-names"||f==="primary-name"){if(this.namereg[o].count>1){z=1}if((this.namereg[o].ikey&&this.namereg[o].ikey[k].count>1)||(this.namereg[o].count>1&&"string"!==typeof x)){z=2}}else{if(f==="all-names-with-initials"||f==="primary-name-with-initials"){if(this.namereg[o].count>1){z=1}else{z=0}}}if(!b.registry.registry[H]){if(w=="short"){return 0}else{if("string"==typeof x){return 1}}}else{return z}};p=function(x){var G,F,E,y,w,z,C,B,D,A;if("string"===typeof x||"number"===typeof x){x=[""+x]}t={};E=x.length;for(F=0;F<E;F+=1){z=""+x[F];if(!this.nameind[z]){continue}for(C in this.nameind[z]){if(this.nameind[z].hasOwnProperty(C)){v=C.split("::");o=v[0];k=v[1];a=v[2];if("undefined"===typeof this.namereg[o]){continue}j=this.namereg[o].items;if(a&&this.namereg[o].ikey[k]&&this.namereg[o].ikey[k].skey[a]){s=this.namereg[o].ikey[k].skey[a].items;w=s.indexOf(""+z);if(w>-1){this.namereg[o].ikey[k].skey[a].items=s.slice(0,w).concat(s.slice([(w+1)]))}if(this.namereg[o].ikey[k].skey[a].items.length===0){delete this.namereg[o].ikey[k].skey[a];this.namereg[o].ikey[k].count+=-1;if(this.namereg[o].ikey[k].count<2){for(q=0,g=this.namereg[o].ikey[k].items.length;q<g;q+=1){b.tmp.taintedItemIDs[this.namereg[o].ikey[k].items[q]]=true}}}}if(k&&this.namereg[o].ikey[k]){w=this.namereg[o].ikey[k].items.indexOf(""+z);if(w>-1){j=this.namereg[o].ikey[k].items.slice();this.namereg[o].ikey[k].items=j.slice(0,w).concat(j.slice([w+1]))}if(this.namereg[o].ikey[k].items.length===0){delete this.namereg[o].ikey[k];this.namereg[o].count+=-1;if(this.namereg[o].count<2){for(q=0,g=this.namereg[o].items.length;q<g;q+=1){b.tmp.taintedItemIDs[this.namereg[o].items[q]]=true}}}}if(o){w=this.namereg[o].items.indexOf(""+z);if(w>-1){j=this.namereg[o].items.slice();this.namereg[o].items=j.slice(0,w).concat(j.slice([w+1],j.length))}if(this.namereg[o].items.length<2){delete this.namereg[o]}}delete this.nameind[z][C]}}delete this.nameind[z];delete this.nameindpkeys[z]}return t};l=function(x,w,B){var A,z;var y=b.nameOutput.getName(w,"locale-translit",true);w=y.name;if(b.citation.opt["givenname-disambiguation-rule"]&&b.citation.opt["givenname-disambiguation-rule"].slice(0,8)==="primary-"&&B!==0){return}e(this.state,""+x,w);if(o){if("undefined"===typeof this.namereg[o]){this.namereg[o]={};this.namereg[o].count=0;this.namereg[o].ikey={};this.namereg[o].items=[x]}else{if(this.namereg[o].items.indexOf(x)===-1){this.namereg[o].items.push(x)}}}if(o&&k){if("undefined"===typeof this.namereg[o].ikey[k]){this.namereg[o].ikey[k]={};this.namereg[o].ikey[k].count=0;this.namereg[o].ikey[k].skey={};this.namereg[o].ikey[k].items=[x];this.namereg[o].count+=1;if(this.namereg[o].count===2){for(A=0,z=this.namereg[o].items.length;A<z;A+=1){b.tmp.taintedItemIDs[this.namereg[o].items[A]]=true}}}else{if(this.namereg[o].ikey[k].items.indexOf(x)===-1){this.namereg[o].ikey[k].items.push(x)}}}if(o&&k&&a){if("undefined"===typeof this.namereg[o].ikey[k].skey[a]){this.namereg[o].ikey[k].skey[a]={};this.namereg[o].ikey[k].skey[a].items=[x];this.namereg[o].ikey[k].count+=1;if(this.namereg[o].ikey[k].count===2){for(A=0,z=this.namereg[o].ikey[k].items.length;A<z;A+=1){b.tmp.taintedItemIDs[this.namereg[o].ikey[k].items[A]]=true}}}else{if(this.namereg[o].ikey[k].skey[a].items.indexOf(x)===-1){this.namereg[o].ikey[k].skey[a].items.push(x)}}}if("undefined"===typeof this.nameind[x]){this.nameind[x]={};this.nameindpkeys[x]={}}if(o){this.nameind[x][o+"::"+k+"::"+a]=true;this.nameindpkeys[x][o]=this.namereg[o]}};this.addname=l;this.delitems=p;this.evalname=c};CSL.Registry.CitationReg=function(a){this.citationById={};this.citationByIndex=[]};CSL.Disambiguation=function(a){this.state=a;this.sys=this.state.sys;this.registry=a.registry.registry;this.ambigcites=a.registry.ambigcites;this.configModes();this.debug=false};CSL.Disambiguation.prototype.run=function(a){if(!this.modes.length){return}this.akey=a;if(this.initVars(a)){this.runDisambig()}};CSL.Disambiguation.prototype.runDisambig=function(){var h,a,b,f,e,d,g;this.initGivens=true;while(this.lists.length){this.gnameset=0;this.gname=0;this.clashes=[1,0];while(this.lists[0][1].length){this.listpos=0;if(!this.base){this.base=this.lists[0][0]}var c=[];g=this.incrementDisambig();this.scanItems(this.lists[0]);this.evalScan(g)}this.lists=this.lists.slice(1)}};CSL.Disambiguation.prototype.scanItems=function(f){var h,e,c,a,k,g,b;this.Item=f[1][0];this.ItemCite=CSL.getAmbiguousCite.call(this.state,this.Item,this.base,true);this.scanlist=f[1];this.partners=[];this.partners.push(this.Item);this.nonpartners=[];var j=0;for(h=1,e=f[1].length;h<e;h+=1){a=f[1][h];var d=CSL.getAmbiguousCite.call(this.state,a,this.base,true);if(this.ItemCite===d){j+=1;this.partners.push(a)}else{this.nonpartners.push(a)}}this.clashes[0]=this.clashes[1];this.clashes[1]=j};CSL.Disambiguation.prototype.evalScan=function(a){this[this.modes[this.modeindex]](a);if(a){if(this.modeindex<this.modes.length-1){this.modeindex+=1}else{this.lists[this.listpos+1]=[this.base,[]]}}};CSL.Disambiguation.prototype.disNames=function(f){var e,a,d,c,b;if(this.clashes[1]===0&&this.nonpartners.length===1){this.captureStepToBase();this.state.registry.registerAmbigToken(this.akey,""+this.nonpartners[0].id,this.betterbase);this.state.registry.registerAmbigToken(this.akey,""+this.partners[0].id,this.betterbase);this.lists[this.listpos]=[this.betterbase,[]]}else{if(this.clashes[1]===0){this.captureStepToBase();this.state.registry.registerAmbigToken(this.akey,""+this.partners[0].id,this.betterbase);this.lists[this.listpos]=[this.betterbase,this.nonpartners];if(this.nonpartners.length){this.initGivens=true}}else{if(this.nonpartners.length===1){this.captureStepToBase();this.state.registry.registerAmbigToken(this.akey,""+this.nonpartners[0].id,this.betterbase);this.lists[this.listpos]=[this.betterbase,this.partners]}else{if(this.clashes[1]<this.clashes[0]){this.captureStepToBase();this.lists[this.listpos]=[this.betterbase,this.partners];this.lists.push([this.betterbase,this.nonpartners])}else{if(f){this.lists[this.listpos]=[this.betterbase,this.nonpartners];this.lists.push([this.betterbase,this.partners]);if(this.modeindex===this.modes.length-1){for(c=0,b=this.partners.length;c<b;c+=1){this.state.registry.registerAmbigToken(this.akey,""+this.partners[c].id,this.betterbase)}this.lists[this.listpos]=[this.betterbase,[]]}}}}}}};CSL.Disambiguation.prototype.disExtraText=function(){var g,a,f;var b=false;if(this.clashes[1]===0&&this.nonpartners.length<2){b=true}if(!b&&(!this.base.disambiguate||this.state.tmp.disambiguate_count!==this.state.tmp.disambiguate_maxMax)){this.modeindex=0;this.base.disambiguate=this.state.tmp.disambiguate_count;this.betterbase.disambiguate=this.state.tmp.disambiguate_count;if(!this.base.disambiguate){this.initGivens=true;this.base.disambiguate=1;for(var d=0,c=this.lists[this.listpos][1].length;d<c;d+=1){this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][d].id]=true}}else{this.disNames()}}else{if(b||this.state.tmp.disambiguate_count===this.state.tmp.disambiguate_maxMax){if(b||this.modeindex===this.modes.length-1){var e=this.lists[this.listpos][0];for(var d=0,c=this.lists[this.listpos][1].length;d<c;d+=1){this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][d].id]=true;this.state.registry.registerAmbigToken(this.akey,""+this.lists[this.listpos][1][d].id,e)}this.lists[this.listpos]=[this.betterbase,[]]}else{this.modeindex=this.modes.length-1;var e=this.lists[this.listpos][0];e.disambiguate=true;for(var d=0,c=this.lists[this.listpos][1].length;d<c;d+=1){this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][d].id]=true;this.state.registry.registerAmbigToken(this.akey,""+this.lists[this.listpos][1][d].id,e)}}}}};CSL.Disambiguation.prototype.disYears=function(){var l,h,k,e,o;k=[];var a=this.lists[this.listpos][0];if(this.clashes[1]){for(var g=0,c=this.state.registry.mylist.length;g<c;g+=1){var d=this.state.registry.mylist[g];for(var f=0,n=this.lists[this.listpos][1].length;f<n;f+=1){var e=this.lists[this.listpos][1][f];if(e.id==d){k.push(this.registry[e.id]);break}}}}k.sort(this.state.registry.sorter.compareKeys);for(l=0,h=k.length;l<h;l+=1){a.year_suffix=""+l;var b=this.state.registry.registry[k[l].id].disambig;this.state.registry.registerAmbigToken(this.akey,""+k[l].id,a);if(CSL.ambigConfigDiff(b,a)){this.state.tmp.taintedItemIDs[k[l].id]=true}}this.lists[this.listpos]=[this.betterbase,[]]};CSL.Disambiguation.prototype.incrementDisambig=function(){var e;if(this.initGivens){this.initGivens=false;return false}var d=false;var f=true;var a=true;if("disNames"===this.modes[this.modeindex]){f=false;if("number"!==typeof this.givensMax){f=true}var c=false;if("number"!==typeof this.namesMax){c=true}if("number"===typeof this.givensMax){if(this.base.givens.length&&this.base.givens[this.gnameset][this.gname]<this.givensMax){this.base.givens[this.gnameset][this.gname]+=1}else{f=true}}if("number"===typeof this.namesMax&&f){if(this.state.opt["disambiguate-add-names"]){c=false;if(this.gname<this.namesMax){this.base.names[this.gnameset]+=1;this.gname+=1}else{c=true}}else{c=true}}if("number"===typeof this.namesetsMax&&c){if(this.gnameset<this.namesetsMax){this.gnameset+=1;this.base.names[this.gnameset]=1;this.gname=0}else{var b=true}}if(("number"!==typeof this.namesetsMax||this.namesetsMax===-1||this.gnameset===this.namesetsMax)&&(!this.state.opt["disambiguate-add-names"]||"number"!==typeof this.namesMax||this.gname===this.namesMax)&&("number"!=typeof this.givensMax||"undefined"===typeof this.base.givens[this.gnameset]||"undefined"===typeof this.base.givens[this.gnameset][this.gname]||this.base.givens[this.gnameset][this.gname]===this.givensMax)){d=true}}else{if("disExtraText"===this.modes[this.modeindex]){this.base.disambiguate+=1;this.betterbase.disambiguate+=1}}return d};CSL.Disambiguation.prototype.initVars=function(g){var f,b,a,h,j;this.lists=[];this.base=false;this.betterbase=false;this.akey=g;this.maxNamesByItemId={};h=[];a=this.ambigcites[g];if(!a||!a.length){return false}var e=false;var d=this.state.retrieveItem(""+a[0]);this.getCiteData(d);this.base=CSL.getAmbigConfig.call(this.state);if(a&&a.length>1){h.push([this.maxNamesByItemId[d.id],d]);for(f=1,b=a.length;f<b;f+=1){d=this.state.retrieveItem(""+a[f]);this.getCiteData(d,this.base);h.push([this.maxNamesByItemId[d.id],d])}h.sort(function(l,k){if(l[0]>k[0]){return 1}else{if(l[0]<k[0]){return -1}else{if(l[1].id>k[1].id){return 1}else{if(l[1].id<k[1].id){return -1}else{return 0}}}}});j=[];for(f=0,b=h.length;f<b;f+=1){j.push(h[f][1])}this.lists.push([this.base,j]);this.Item=this.lists[0][1][0]}else{this.Item=this.state.retrieveItem(""+a[0])}this.modeindex=0;if(this.state.citation.opt["disambiguate-add-names"]||true){this.namesMax=this.maxNamesByItemId[this.Item.id][0]}else{var c=this.base.names[0];for(var f=1,b=this.base.names.length;f<b;f+=1){c=Math.max(c,this.base.names.names[f])}}this.padBase(this.base);this.padBase(this.betterbase);this.base.year_suffix=false;this.base.disambiguate=false;this.betterbase.year_suffix=false;this.betterbase.disambiguate=false;if(this.state.citation.opt["givenname-disambiguation-rule"]==="by-cite"&&this.state.opt["disambiguate-add-givenname"]){this.givensMax=2}return true};CSL.Disambiguation.prototype.padBase=function(e){for(var d=0,c=e.names.length;d<c;d+=1){if(!e.givens[d]){e.givens[d]=[]}for(var b=0,a=e.names[d];b<a;b+=1){if(!e.givens[d][b]){e.givens[d][b]=0}}}};CSL.Disambiguation.prototype.configModes=function(){var a,b;this.modes=[];a=this.state.opt["disambiguate-add-givenname"];b=this.state.citation.opt["givenname-disambiguation-rule"];if(this.state.opt["disambiguate-add-names"]||(a&&b==="by-cite")){this.modes.push("disNames")}if(this.state.opt.has_disambiguate){this.modes.push("disExtraText")}if(this.state.opt["disambiguate-add-year-suffix"]){this.modes.push("disYears")}};CSL.Disambiguation.prototype.getCiteData=function(c,f){if(!this.maxNamesByItemId[c.id]){CSL.getAmbiguousCite.call(this.state,c,f);f=CSL.getAmbigConfig.call(this.state);this.maxNamesByItemId[c.id]=CSL.getMaxVals.call(this.state);this.state.registry.registry[c.id].disambig.givens=this.state.tmp.disambig_settings.givens.slice();for(var e=0,d=this.state.registry.registry[c.id].disambig.givens.length;e<d;e+=1){this.state.registry.registry[c.id].disambig.givens[e]=this.state.tmp.disambig_settings.givens[e].slice()}this.namesetsMax=this.state.registry.registry[c.id].disambig.names.length-1;if(!this.base){this.base=f;this.betterbase=CSL.cloneAmbigConfig(f)}if(f.names.length<this.base.names.length){this.base=f}var g=false;for(var e=0,d=f.names.length;e<d;e+=1){if(f.names[e]>this.base.names[e]){this.base.givens[e]=f.givens[e].slice();this.base.names[e]=f.names[e];this.betterbase.names=this.base.names.slice();this.betterbase.givens=this.base.givens.slice();this.padBase(this.base);this.padBase(this.betterbase)}}this.betterbase.givens=this.base.givens.slice();for(var b=0,a=this.base.givens.length;b<a;b+=1){this.betterbase.givens[b]=this.base.givens[b].slice()}}};CSL.Disambiguation.prototype.captureStepToBase=function(){if(this.state.citation.opt["givenname-disambiguation-rule"]==="by-cite"&&this.base.givens&&this.base.givens.length){if("undefined"!==typeof this.base.givens[this.gnameset][this.gname]){this.betterbase.givens[this.gnameset][this.gname]=this.base.givens[this.gnameset][this.gname]}}this.betterbase.names[this.gnameset]=this.base.names[this.gnameset]};